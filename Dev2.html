<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Champs Lexicaux - Multijoueur</title>
  <style>
    :root{
      --bg1:#6a11cb; --bg2:#2575fc;
      --card: rgba(255,255,255,.12);
      --glass: blur(12px);
      --txt:#fff; --accent:#fff; --brand:#2575fc;
      --ok:#00e676; --ko:#ff5252;
      --player1: #FF6B6B;
      --player2: #4ECDC4;
      --player3: #FFD166;
      --player4: #06D6A0;
    }
    *{box-sizing:border-box; margin:0; padding:0;}
    body{
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(270deg, var(--bg1), var(--bg2), var(--bg1));
      background-size: 600% 600%;
      animation: gradientAnimation 15s ease infinite;
      color: var(--txt);
      min-height: 100vh;
      padding: 12px;
    }
    @keyframes gradientAnimation{
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }
    
    /* Modal Admin */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      z-index: 2000;
      padding: 20px;
      overflow-y: auto;
    }
    
    .modal-content {
      background: #1a1a2e;
      border-radius: 20px;
      padding: 25px;
      max-width: 900px;
      margin: 0 auto;
      border: 2px solid #d4af37;
      position: relative;
      color: white;
    }
    
    .close-modal {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      color: #ff6b6b;
      font-size: 1.8rem;
      cursor: pointer;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      color: #a0c8ff;
      font-weight: 600;
    }
    
    .form-input {
      width: 100%;
      padding: 14px;
      border-radius: 10px;
      border: 2px solid rgba(212, 175, 55, 0.4);
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 1rem;
    }
    
    .submit-button {
      width: 100%;
      padding: 16px;
      background: linear-gradient(90deg, #1e90ff, #0d47a1);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      margin-top: 20px;
      transition: all 0.3s ease;
    }
    
    .hidden {
      display: none !important;
    }
    
    /* Container principal */
    .container{
      background: var(--card);
      backdrop-filter: var(--glass);
      width: min(1200px, 94vw);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 8px 32px rgba(0,0,0,.25);
      animation: fadeIn .9s ease;
      margin: 20px auto;
    }
    @keyframes fadeIn{from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:translateY(0)}}
    
    /* √âcrans */
    .screen {
      display: none;
    }
    
    .screen.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }
    
    /* Header */
    header{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    h1{
      font-weight:800;
      margin:0;
      font-size: clamp(26px, 3.4vw, 40px);
      text-shadow: 0 3px 8px rgba(0,0,0,.3);
      letter-spacing:.3px;
    }
    .admin-btn {
      background-color: #ff6b6b;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      font-size: 1rem;
      white-space: nowrap;
    }
    
    .admin-btn:hover {
      background-color: #ff5252;
      transform: scale(1.05);
    }
    
    /* √âcran de connexion */
    .login-screen {
      text-align: center;
      padding: 40px 20px;
    }
    
    .login-title {
      font-size: 2.5rem;
      margin-bottom: 10px;
      color: white;
    }
    
    .login-subtitle {
      font-size: 1.2rem;
      margin-bottom: 40px;
      opacity: 0.9;
    }
    
    .player-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }
    
    .player-card {
      background: rgba(255,255,255,0.1);
      border-radius: 15px;
      padding: 30px 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      text-align: center;
    }
    
    .player-card:hover {
      background: rgba(255,255,255,0.15);
      transform: translateY(-5px);
    }
    
    .player-card.selected {
      background: rgba(255,255,255,0.2);
      border-color: var(--brand);
      box-shadow: 0 0 20px rgba(37, 117, 252, 0.3);
    }
    
    .player-icon {
      font-size: 3rem;
      margin-bottom: 15px;
      color: var(--brand);
    }
    
    .player-name {
      font-weight: bold;
      font-size: 1.5rem;
      margin-bottom: 10px;
    }
    
    .player-role {
      font-size: 1rem;
      opacity: 0.8;
    }
    
    /* √âcran de salon */
    .lobby-screen {
      padding: 20px;
    }
    
    .game-code-section {
      background: rgba(0,0,0,0.2);
      border-radius: 15px;
      padding: 25px;
      text-align: center;
      margin-bottom: 30px;
    }
    
    .game-code {
      font-size: 3rem;
      font-weight: bold;
      letter-spacing: 10px;
      color: #f7ef8a;
      background: rgba(0,0,0,0.3);
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      font-family: 'Courier New', monospace;
    }
    
    .copy-btn {
      background: var(--brand);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }
    
    .players-list {
      margin: 30px 0;
    }
    
    .players-title {
      font-size: 1.5rem;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .players-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }
    
    .player-item {
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 15px;
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .player-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--brand);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: bold;
    }
    
    .player-info {
      flex: 1;
    }
    
    .player-name-lobby {
      font-weight: bold;
      font-size: 1.2rem;
    }
    
    .player-status {
      font-size: 0.9rem;
      opacity: 0.8;
    }
    
    .player-item.host .player-avatar {
      background: var(--player1);
    }
    
    .player-item.guest .player-avatar {
      background: var(--player2);
    }
    
    .player-item.joined .player-status {
      color: #00e676;
    }
    
    /* √âcran de jeu */
    .game-screen {
      padding: 20px;
    }
    
    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .player-scores {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .player-score {
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 10px 20px;
      min-width: 120px;
    }
    
    .player-score.host {
      border-left: 4px solid var(--player1);
    }
    
    .player-score.guest {
      border-left: 4px solid var(--player2);
    }
    
    .score-name {
      font-size: 0.9rem;
      opacity: 0.8;
    }
    
    .score-value {
      font-size: 1.8rem;
      font-weight: bold;
    }
    
    /* Zone d'affichage */
    .display{
      margin: 30px 0;
      text-align: center;
    }
    #prefixDisplay{
      font-size: clamp(36px, 5vw, 64px);
      font-weight:900;
      letter-spacing:.18em;
      text-shadow: 0 3px 8px rgba(0,0,0,.28);
      margin-bottom: 20px;
    }
    #definitionDisplay{
      font-size: clamp(18px, 2.2vw, 22px);
      line-height:1.6;
      background: rgba(0,0,0,.16);
      border-radius:14px;
      padding: 30px;
      min-height: 150px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto;
      max-width: 800px;
    }
    
    /* Chronom√®tre */
    .chrono-section {
      background: rgba(0,0,0,0.2);
      border-radius: 15px;
      padding: 25px;
      margin: 30px auto;
      text-align: center;
      max-width: 600px;
    }
    
    .chrono-label {
      font-size: 1.5rem;
      margin-bottom: 20px;
      color: #fff;
      font-weight: 600;
    }
    
    #chrono {
      font-size: 5rem;
      font-weight: bold;
      color: #fff;
      background: rgba(0,0,0,0.3);
      border-radius: 15px;
      padding: 30px 50px;
      display: inline-block;
      min-width: 250px;
      transition: all 0.3s ease;
      font-family: 'Courier New', monospace;
      margin: 10px 0;
    }
    #chrono.warning {
      color: #ff9800;
      animation: pulse 1s infinite;
    }
    #chrono.danger {
      color: #ff5252;
      animation: pulse 0.5s infinite;
    }
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }
    
    /* Zone de r√©ponse */
    .answer-section {
      margin: 30px auto;
      max-width: 600px;
    }
    
    #answer{
      font-size:1.3rem;
      padding:18px 25px;
      border-radius:12px;
      border:none;
      width:100%;
      background:#fff;
      color:#222;
      outline:none;
      transition:.25s;
      margin: 0;
      text-align: center;
    }
    #answer:focus{
      box-shadow:0 0 20px var(--brand);
      caret-color:var(--brand);
    }
    
    /* Contr√¥les */
    .controls-section {
      margin: 30px auto;
      max-width: 800px;
    }
    
    .controls{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 12px;
    }
    button{
      padding: 16px;
      font-size: 1.1rem;
      font-weight: 700;
      border-radius: 14px;
      border: none;
      cursor: pointer;
      background: #fff;
      color: var(--brand);
      transition: .25s;
      box-shadow: 0 4px 10px rgba(0,0,0,.1);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    button:hover{
      background: var(--brand);
      color: #fff;
      box-shadow: 0 0 15px #ffffff99, 0 0 20px #2575fcaa;
      transform: translateY(-2px);
    }
    button:disabled{
      opacity: .55;
      cursor: not-allowed;
      transform: none !important;
    }
    
    /* Message */
    #message{
      min-height: 50px;
      font-size: 1.2rem;
      font-weight: 700;
      text-align: center;
      margin: 20px 0;
      padding: 15px;
      border-radius: 10px;
      background: rgba(0,0,0,0.1);
    }
    
    /* √âcran de r√©sultats */
    .results-screen {
      padding: 40px 20px;
      text-align: center;
    }
    
    .results-title {
      font-size: 2.5rem;
      margin-bottom: 30px;
      color: #f7ef8a;
    }
    
    .final-scores {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin: 40px 0;
      max-width: 800px;
      margin: 40px auto;
    }
    
    .final-score {
      background: rgba(255,255,255,0.1);
      border-radius: 15px;
      padding: 25px;
      position: relative;
      border: 3px solid transparent;
    }
    
    .final-score.winner {
      border-color: #f7ef8a;
      background: rgba(247, 239, 138, 0.1);
    }
    
    .winner-badge {
      position: absolute;
      top: -15px;
      left: 50%;
      transform: translateX(-50%);
      background: #f7ef8a;
      color: #1a1a2e;
      padding: 5px 15px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 0.9rem;
    }
    
    .final-player-name {
      font-size: 1.8rem;
      margin-bottom: 15px;
      font-weight: bold;
    }
    
    .final-score-value {
      font-size: 3rem;
      font-weight: bold;
      margin: 15px 0;
    }
    
    .final-accuracy {
      font-size: 1.1rem;
      opacity: 0.9;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .player-cards {
        grid-template-columns: 1fr;
      }
      
      .players-grid {
        grid-template-columns: 1fr;
      }
      
      .controls {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .game-code {
        font-size: 2rem;
        letter-spacing: 5px;
      }
      
      #chrono {
        font-size: 3.5rem;
        padding: 20px 30px;
      }
      
      .player-scores {
        flex-direction: column;
        gap: 10px;
      }
      
      .player-score {
        min-width: auto;
      }
    }
    
    @media (max-width: 480px) {
      .controls {
        grid-template-columns: 1fr;
      }
      
      .player-card {
        padding: 20px 15px;
      }
      
      h1 {
        font-size: 1.8rem;
      }
    }
  </style>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <!-- Modal Admin -->
  <div class="modal-overlay" id="adminModal">
    <div class="modal-content">
      <button class="close-modal" id="closeAdminModal">&times;</button>
      
      <h2><i class="fas fa-lock"></i> PANEL ADMIN - MULTIJOUEUR</h2>
      
      <div id="passwordSection">
        <p style="color: #a0c8ff; text-align: center; margin-bottom: 20px;">
          Acc√®s r√©serv√© √† l'administrateur
        </p>
        <div class="form-group">
          <input type="password" id="adminPassword" 
                 placeholder="Entrez le mot de passe administrateur"
                 class="form-input">
        </div>
        <button id="loginButton" class="submit-button">
          <i class="fas fa-sign-in-alt"></i> SE CONNECTER
        </button>
      </div>
      
      <div id="adminPanel" class="hidden">
        <h3 style="color: #f7ef8a; text-align: center; margin-bottom: 20px;">
          Statistiques Multijoueur
        </h3>
        <div style="text-align: center; padding: 40px;">
          <i class="fas fa-gamepad fa-4x" style="color: #a0c8ff; margin-bottom: 20px;"></i>
          <p>Panel admin en d√©veloppement...</p>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <header>
      <h1><i class="fas fa-users"></i> Champs Lexicaux - Multijoueur</h1>
      <div class="status">
        <span id="connectionStatus" class="pill">
          <i class="fas fa-wifi"></i> Connect√©
        </span>
        <button class="admin-btn" id="adminButton">
          <i class="fas fa-lock"></i> Admin
        </button>
      </div>
    </header>

    <!-- √âcran de connexion -->
    <div id="loginScreen" class="screen active">
      <div class="login-screen">
        <h2 class="login-title">Choisis ton personnage</h2>
        <p class="login-subtitle">Rejoins une partie ou cr√©e-en une nouvelle</p>
        
        <div class="player-cards">
          <div class="player-card selected" data-player="moise">
            <div class="player-icon">
              <i class="fas fa-user-graduate"></i>
            </div>
            <div class="player-name">Mo√Øse</div>
            <div class="player-role">Niveau Avanc√©</div>
          </div>
          
          <div class="player-card" data-player="credo">
            <div class="player-icon">
              <i class="fas fa-user-tie"></i>
            </div>
            <div class="player-name">Credo</div>
            <div class="player-role">Niveau Expert</div>
          </div>
          
          <div class="player-card" data-player="aubaine">
            <div class="player-icon">
              <i class="fas fa-user-ninja"></i>
            </div>
            <div class="player-name">Aubaine</div>
            <div class="player-role">Niveau Ma√Ætre</div>
          </div>
        </div>
        
        <div style="max-width: 500px; margin: 40px auto;">
          <button id="btnCreateGame" class="submit-button" style="background: linear-gradient(90deg, #4CAF50, #2E7D32);">
            <i class="fas fa-plus-circle"></i> CR√âER UNE PARTIE
          </button>
          
          <div style="margin: 20px 0; text-align: center; color: rgba(255,255,255,0.7);">
            OU
          </div>
          
          <div class="form-group">
            <input type="text" id="gameCodeInput" 
                   placeholder="Entre le code de la partie"
                   class="form-input" style="text-align: center;">
          </div>
          
          <button id="btnJoinGame" class="submit-button" style="background: linear-gradient(90deg, #2196F3, #0D47A1);">
            <i class="fas fa-sign-in-alt"></i> REJOINDRE UNE PARTIE
          </button>
        </div>
      </div>
    </div>

    <!-- √âcran du salon d'attente -->
    <div id="lobbyScreen" class="screen">
      <div class="lobby-screen">
        <div class="game-code-section">
          <h3><i class="fas fa-door-open"></i> Salon d'attente</h3>
          <p>Partage ce code avec ton ami :</p>
          <div class="game-code" id="gameCodeDisplay">ABC123</div>
          <button class="copy-btn" id="copyCodeBtn">
            <i class="far fa-copy"></i> Copier le code
          </button>
          <p style="margin-top: 15px; opacity: 0.8;">
            En attente des autres joueurs...
          </p>
        </div>
        
        <div class="players-list">
          <h4 class="players-title"><i class="fas fa-users"></i> Joueurs connect√©s</h4>
          <div class="players-grid" id="playersList">
            <!-- Les joueurs appara√Ætront ici -->
          </div>
        </div>
        
        <div style="text-align: center; margin-top: 40px;">
          <button id="btnStartGame" class="submit-button" style="background: linear-gradient(90deg, #FF9800, #F57C00);">
            <i class="fas fa-play"></i> COMMENCER LA PARTIE
          </button>
          <button id="btnLeaveLobby" class="submit-button" style="background: rgba(255,255,255,0.1); margin-top: 15px;">
            <i class="fas fa-sign-out-alt"></i> QUITTER LE SALON
          </button>
        </div>
      </div>
    </div>

    <!-- √âcran de jeu -->
    <div id="gameScreen" class="screen">
      <div class="game-screen">
        <div class="game-header">
          <div class="player-scores" id="playerScores">
            <!-- Scores des joueurs appara√Ætront ici -->
          </div>
          <div class="game-info">
            <div class="pill">
              <i class="fas fa-code"></i> 
              <span id="currentGameCode">ABC123</span>
            </div>
          </div>
        </div>
        
        <div class="display">
          <div id="prefixDisplay">‚Äì ‚Äì</div>
          <div id="definitionDisplay">
            La partie va commencer...
          </div>
        </div>

        <div class="chrono-section">
          <div class="chrono-label">
            <i class="fas fa-clock"></i> TEMPS RESTANT
          </div>
          <div id="chrono">20</div>
        </div>

        <div class="answer-section">
          <input type="text" id="answer" placeholder="√âcris le mot correct et appuie sur Entr√©e‚Ä¶" autocomplete="off" />
        </div>

        <div id="message" aria-live="polite"></div>

        <div class="controls-section">
          <div class="controls">
            <button id="btnRepeat">
              <i class="fas fa-redo"></i> R√©p√©ter
            </button>
            <button id="btnLeaveGame" style="background: rgba(255,107,107,0.2); color: #FF6B6B;">
              <i class="fas fa-sign-out-alt"></i> Quitter
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- √âcran de r√©sultats -->
    <div id="resultsScreen" class="screen">
      <div class="results-screen">
        <h2 class="results-title">R√©sultats de la partie</h2>
        
        <div class="final-scores" id="finalScores">
          <!-- R√©sultats finaux appara√Ætront ici -->
        </div>
        
        <div style="margin-top: 50px;">
          <button id="btnNewGame" class="submit-button" style="background: linear-gradient(90deg, #9C27B0, #6A1B9A);">
            <i class="fas fa-plus-circle"></i> NOUVELLE PARTIE
          </button>
          <button id="btnBackToLobby" class="submit-button" style="background: rgba(255,255,255,0.1); margin-top: 15px;">
            <i class="fas fa-home"></i> RETOUR AU MENU
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBPBq1uT7lbL9Xp_neAJh2lSe0MRErlYdo",
      authDomain: "evoir-1.firebaseapp.com",
      projectId: "evoir-1",
      storageBucket: "evoir-1.firebasestorage.app",
      messagingSenderId: "504718469638",
      appId: "1:504718469638:web:72707fd51d0ce6ff773187",
      measurementId: "G-ZXPC2SKJHT"
    };

    // Initialize Firebase
    try {
      firebase.initializeApp(firebaseConfig);
    } catch (error) {
      console.log("Firebase d√©j√† initialis√©");
    }
    
    const db = firebase.firestore();

    // Admin credentials
    const ADMIN_PASSWORD = "legende360@";

    // Donn√©es : champs lexicaux
    const FIELDS = {
      "Pr": [
        {mot:"Pr√©cision", def:"Le fait de donner des d√©tails exacts et pr√©cis sur quelque chose."},
        {mot:"Profond", def:"Qui se rapporte √† la profondeur ou √† une intensit√© importante."},
        {mot:"Profession", def:"Domaine d'activit√© ou m√©tier dans lequel une personne travaille."},
        {mot:"Progr√®s", def:"Avancement ou am√©lioration dans une situation ou un domaine."},
        {mot:"Promesse", def:"Engagement ou parole donn√©e de faire quelque chose."},
        {mot:"Proverbe", def:"Expression populaire qui contient une sagesse ou un conseil."},
        {mot:"Pr√©cieux", def:"Qui a une grande valeur ou importance."},
        {mot:"Pr√©paration", def:"Action de se pr√©parer en vue d'une activit√©."},
        {mot:"Pr√©caution", def:"Mesure prise pour √©viter un danger ou un probl√®me."},
        {mot:"Privil√®ge", def:"Avantage ou droit sp√©cial accord√© √† certaines personnes."}
      ],
      "Se": [
        {mot:"Sensation", def:"Perception ou ressenti d'un stimulus par les sens."},
        {mot:"S√©duction", def:"Charme ou pouvoir d'attraction envers quelqu'un."},
        {mot:"S√©r√©nit√©", def:"√âtat de calme et de tranquillit√©."},
        {mot:"Secret", def:"Quelque chose qui est cach√© ou inconnu du public."},
        {mot:"S√©paration", def:"Acte de se s√©parer ou de se diviser."},
        {mot:"S√©rieux", def:"√âtat de responsabilit√© et de gravit√©."},
        {mot:"Sentiment", def:"√âmotion ou affection ressentie envers quelqu'un ou quelque chose."},
        {mot:"Service", def:"Action d'aider ou d'assister quelqu'un."},
        {mot:"Seconde", def:"Unit√© de temps ou rang apr√®s la premi√®re."},
        {mot:"Septi√®me", def:"Position dans une s√©rie apr√®s le sixi√®me."}
      ],
      "Tr": [
        {mot:"Transformation", def:"Changement ou m√©tamorphose d'une chose en une autre."},
        {mot:"Tristesse", def:"√âtat de chagrin ou de m√©lancolie."},
        {mot:"Travail", def:"Emploi ou activit√© professionnelle."},
        {mot:"Traitement", def:"Action de soigner ou de proc√©der √† une proc√©dure m√©dicale."},
        {mot:"Tradition", def:"Coutume transmise de g√©n√©ration en g√©n√©ration."},
        {mot:"Trag√©die", def:"Drame qui provoque de la tristesse ou du d√©sespoir."},
        {mot:"Trenti√®me", def:"Position dans une s√©rie apr√®s le vingt-neuvi√®me."},
        {mot:"Triomphe", def:"Victoire √©clatante √† l'issue d'une lutte."},
        {mot:"Transparence", def:"Clart√© d'une substance ou d'une situation."},
        {mot:"Tr√©sor", def:"Richesse ou bien pr√©cieux √† valeur sentimentale ou mat√©rielle."}
      ],
      "Ac": [
        {mot:"Accompagnement", def:"Soutien ou aide fournie √† quelqu'un."},
        {mot:"Acc√®s", def:"Possibilit√© d'entrer dans un lieu ou d'obtenir quelque chose."},
        {mot:"Action", def:"Acte de faire quelque chose."},
        {mot:"Activit√©", def:"Occupation ou exercice d'une action."},
        {mot:"Achat", def:"Acquisition d'un bien."},
        {mot:"Accident", def:"√âv√©nement impr√©vu, souvent tragique."},
        {mot:"Accord", def:"Entente ou consensus entre plusieurs personnes."},
        {mot:"Acquisition", def:"Obtention d'une chose."},
        {mot:"Acteur", def:"Personne qui joue un r√¥le au th√©√¢tre ou au cin√©ma."},
        {mot:"Acclamation", def:"Applaudissements ou √©loges enthousiastes."}
      ]
    };

    // Variables globales
    let currentUser = {
      id: null,
      name: "moise",
      isHost: false,
      playerColor: "#FF6B6B"
    };
    
    let currentGame = {
      id: null,
      code: null,
      players: [],
      status: "waiting",
      currentWordIndex: 0,
      currentPrefix: null,
      scores: {},
      timeLeft: 20,
      gameStarted: false,
      chronoInterval: null
    };
    
    let gameListener = null;
    let localChronoTimer = null;
    let speechRate = 1;

    // G√©n√©rer un code de jeu
    function generateGameCode() {
      const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
      let code = '';
      for (let i = 0; i < 6; i++) {
        code += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return code;
    }

    // Normaliser le texte
    function normalize(s) {
      if (!s) return '';
      return s
        .toLowerCase()
        .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
        .replace(/[^a-z\-' ]/g,'')
        .trim();
    }

    // Gestion des √©crans
    function showScreen(screenId) {
      console.log("Changement d'√©cran:", screenId);
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      const screenElement = document.getElementById(screenId);
      if (screenElement) {
        screenElement.classList.add('active');
      }
    }

    // Initialisation
    document.addEventListener('DOMContentLoaded', function() {
      console.log("Page charg√©e");
      
      // S√©lection du joueur
      document.querySelectorAll('.player-card').forEach(card => {
        card.addEventListener('click', function() {
          document.querySelectorAll('.player-card').forEach(c => {
            c.classList.remove('selected');
          });
          this.classList.add('selected');
          currentUser.name = this.getAttribute('data-player');
          console.log("Joueur s√©lectionn√©:", currentUser.name);
        });
      });

      // Cr√©er une partie
      document.getElementById('btnCreateGame').addEventListener('click', createGame);
      
      // Rejoindre une partie
      document.getElementById('btnJoinGame').addEventListener('click', joinGame);
      
      // Copier le code
      document.getElementById('copyCodeBtn').addEventListener('click', copyGameCode);
      
      // D√©marrer la partie
      document.getElementById('btnStartGame').addEventListener('click', startGame);
      
      // Quitter le salon
      document.getElementById('btnLeaveLobby').addEventListener('click', leaveLobby);
      
      // Quitter la partie
      document.getElementById('btnLeaveGame').addEventListener('click', leaveGame);
      
      // Nouvelle partie
      document.getElementById('btnNewGame').addEventListener('click', newGame);
      
      // Retour au menu
      document.getElementById('btnBackToLobby').addEventListener('click', () => {
        showScreen('loginScreen');
      });
      
      // R√©p√©ter
      document.getElementById('btnRepeat').addEventListener('click', repeatWord);
      
      // R√©pondre avec Entr√©e
      document.getElementById('answer').addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
          submitAnswer();
        }
      });

      // Admin panel
      setupAdminPanel();
    });

    // Cr√©er une nouvelle partie
    async function createGame() {
      try {
        console.log("Cr√©ation d'une partie...");
        const gameCode = generateGameCode();
        currentUser.id = Date.now().toString() + Math.random().toString(36).substr(2, 5);
        currentUser.isHost = true;
        currentUser.playerColor = "#FF6B6B";
        
        currentGame = {
          id: gameCode,
          code: gameCode,
          players: [{
            id: currentUser.id,
            name: currentUser.name,
            isHost: true,
            score: 0,
            playerColor: "#FF6B6B",
            joinedAt: new Date().toISOString()
          }],
          status: "waiting",
          currentWordIndex: 0,
          currentPrefix: null,
          scores: {
            [currentUser.id]: 0
          },
          hostId: currentUser.id,
          timeLeft: 20,
          gameStarted: false,
          currentWord: null,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        console.log("Sauvegarde dans Firebase...");
        // Sauvegarder dans Firebase
        await db.collection('multiplayer_games').doc(gameCode).set(currentGame);
        
        // Afficher le salon
        document.getElementById('gameCodeDisplay').textContent = gameCode;
        document.getElementById('currentGameCode').textContent = gameCode;
        updatePlayersList();
        showScreen('lobbyScreen');
        
        // √âcouter les changements
        listenToGameChanges();
        
        console.log("Partie cr√©√©e avec code:", gameCode);
        
      } catch (error) {
        console.error("Erreur cr√©ation partie:", error);
        alert("Erreur lors de la cr√©ation de la partie: " + error.message);
      }
    }

    // Rejoindre une partie existante
    async function joinGame() {
      const gameCode = document.getElementById('gameCodeInput').value.trim().toUpperCase();
      
      if (!gameCode || gameCode.length !== 6) {
        alert("Code invalide. Le code doit faire 6 caract√®res (ex: ABC123).");
        return;
      }
      
      try {
        console.log("Tentative de rejoindre partie:", gameCode);
        const gameDoc = await db.collection('multiplayer_games').doc(gameCode).get();
        
        if (!gameDoc.exists) {
          alert("Aucune partie trouv√©e avec ce code.");
          return;
        }
        
        const gameData = gameDoc.data();
        console.log("Donn√©es de la partie:", gameData);
        
        if (gameData.status !== "waiting") {
          alert("Cette partie a d√©j√† commenc√©.");
          return;
        }
        
        if (gameData.players && gameData.players.length >= 4) {
          alert("Cette partie est compl√®te (4 joueurs maximum).");
          return;
        }
        
        currentUser.id = Date.now().toString() + Math.random().toString(36).substr(2, 5);
        currentUser.isHost = false;
        currentUser.playerColor = "#4ECDC4";
        currentGame.id = gameCode;
        currentGame.code = gameCode;
        
        // Ajouter le joueur √† la partie
        const newPlayer = {
          id: currentUser.id,
          name: currentUser.name,
          isHost: false,
          score: 0,
          playerColor: "#4ECDC4",
          joinedAt: new Date().toISOString()
        };
        
        await db.collection('multiplayer_games').doc(gameCode).update({
          players: firebase.firestore.FieldValue.arrayUnion(newPlayer),
          [`scores.${currentUser.id}`]: 0,
          lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        // Afficher le salon
        document.getElementById('gameCodeDisplay').textContent = gameCode;
        document.getElementById('currentGameCode').textContent = gameCode;
        showScreen('lobbyScreen');
        
        // √âcouter les changements
        listenToGameChanges();
        
        console.log("Joueur rejoint avec succ√®s");
        
      } catch (error) {
        console.error("Erreur rejoindre partie:", error);
        alert("Erreur lors de la connexion √† la partie: " + error.message);
      }
    }

    // √âcouter les changements de la partie
    function listenToGameChanges() {
      if (gameListener) {
        console.log("D√©sabonnement ancien listener");
        gameListener();
      }
      
      console.log("√âcoute des changements pour la partie:", currentGame.code);
      gameListener = db.collection('multiplayer_games').doc(currentGame.code)
        .onSnapshot((doc) => {
          if (doc.exists) {
            const gameData = doc.data();
            console.log("Mise √† jour re√ßue:", gameData);
            
            // Mettre √† jour l'√©tat local
            currentGame = { ...currentGame, ...gameData };
            
            // Mettre √† jour l'affichage
            updatePlayersList();
            updateScoresDisplay();
            
            // G√©rer les changements d'√©tat
            if (gameData.status === "playing" && !currentGame.gameStarted) {
              console.log("La partie commence !");
              currentGame.gameStarted = true;
              showScreen('gameScreen');
              startGameRound();
            } else if (gameData.status === "finished") {
              console.log("La partie est termin√©e");
              showResults();
            } else if (gameData.status === "playing") {
              // Mettre √† jour l'affichage du jeu en cours
              updateGameDisplay();
            }
          } else {
            console.log("La partie n'existe plus");
            alert("La partie a √©t√© supprim√©e par l'h√¥te.");
            resetGame();
            showScreen('loginScreen');
          }
        }, (error) => {
          console.error("Erreur √©coute Firebase:", error);
        });
    }

    // Mettre √† jour la liste des joueurs
    function updatePlayersList() {
      const playersList = document.getElementById('playersList');
      if (!playersList) return;
      
      playersList.innerHTML = '';
      
      if (currentGame.players && Array.isArray(currentGame.players)) {
        currentGame.players.forEach(player => {
          const playerDiv = document.createElement('div');
          playerDiv.className = `player-item ${player.isHost ? 'host' : 'guest'} ${player.id === currentUser.id ? 'joined' : ''}`;
          
          const firstLetter = player.name.charAt(0).toUpperCase();
          const playerColor = player.playerColor || (player.isHost ? '#FF6B6B' : '#4ECDC4');
          
          playerDiv.innerHTML = `
            <div class="player-avatar" style="background: ${playerColor}">
              ${firstLetter}
            </div>
            <div class="player-info">
              <div class="player-name-lobby">${player.name}</div>
              <div class="player-status">
                ${player.id === currentUser.id ? '‚úì Vous' : 'En attente...'}
                ${player.isHost ? ' (H√¥te)' : ''}
              </div>
            </div>
          `;
          
          playersList.appendChild(playerDiv);
        });
      }
      
      // Afficher/masquer le bouton "Commencer"
      const startBtn = document.getElementById('btnStartGame');
      if (startBtn) {
        startBtn.style.display = currentUser.isHost ? 'block' : 'none';
      }
    }

    // Mettre √† jour l'affichage des scores
    function updateScoresDisplay() {
      const scoresDiv = document.getElementById('playerScores');
      if (!scoresDiv) return;
      
      scoresDiv.innerHTML = '';
      
      if (currentGame.players && Array.isArray(currentGame.players)) {
        currentGame.players.forEach(player => {
          const scoreDiv = document.createElement('div');
          scoreDiv.className = `player-score ${player.isHost ? 'host' : 'guest'}`;
          const score = currentGame.scores ? (currentGame.scores[player.id] || 0) : 0;
          const playerColor = player.playerColor || (player.isHost ? '#FF6B6B' : '#4ECDC4');
          
          scoreDiv.innerHTML = `
            <div class="score-name">${player.name}</div>
            <div class="score-value">${score}</div>
          `;
          scoreDiv.style.borderLeftColor = playerColor;
          
          scoresDiv.appendChild(scoreDiv);
        });
      }
    }

    // Mettre √† jour l'affichage du jeu
    function updateGameDisplay() {
      if (!currentGame.currentPrefix || currentGame.status !== "playing") return;
      
      const prefix = currentGame.currentPrefix;
      const wordIndex = currentGame.currentWordIndex || 0;
      const words = FIELDS[prefix];
      
      if (wordIndex >= words.length) {
        // Fin du jeu
        endGame();
        return;
      }
      
      const currentWord = words[wordIndex];
      
      // Mettre √† jour l'affichage
      document.getElementById('prefixDisplay').textContent = prefix;
      document.getElementById('definitionDisplay').textContent = currentWord.def;
      
      // R√©initialiser le champ de r√©ponse
      document.getElementById('answer').value = '';
      document.getElementById('answer').disabled = false;
      
      // Mettre √† jour le chrono
      if (currentGame.timeLeft !== undefined) {
        updateChronoDisplay(currentGame.timeLeft);
      }
    }

    // D√©marrer la partie (seulement l'h√¥te)
    async function startGame() {
      if (!currentUser.isHost) {
        alert("Seul l'h√¥te peut d√©marrer la partie.");
        return;
      }
      
      if (!currentGame.players || currentGame.players.length < 2) {
        alert("Attendez qu'au moins un autre joueur rejoigne la partie.");
        return;
      }
      
      try {
        // S√©lectionner un champ lexical al√©atoire
        const prefixes = Object.keys(FIELDS);
        const randomPrefix = prefixes[Math.floor(Math.random() * prefixes.length)];
        const words = FIELDS[randomPrefix];
        const firstWord = words[0];
        
        await db.collection('multiplayer_games').doc(currentGame.code).update({
          status: "playing",
          currentPrefix: randomPrefix,
          currentWordIndex: 0,
          currentWord: firstWord,
          timeLeft: 20,
          gameStarted: true,
          startedAt: firebase.firestore.FieldValue.serverTimestamp(),
          lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        console.log("Partie d√©marr√©e avec pr√©fixe:", randomPrefix);
        
      } catch (error) {
        console.error("Erreur d√©marrage partie:", error);
        alert("Erreur lors du d√©marrage de la partie: " + error.message);
      }
    }

    // D√©marrer un tour de jeu
    function startGameRound() {
      console.log("D√©but d'un tour de jeu");
      
      if (!currentGame.currentPrefix) {
        console.error("Pas de pr√©fixe d√©fini");
        return;
      }
      
      const prefix = currentGame.currentPrefix;
      const wordIndex = currentGame.currentWordIndex || 0;
      const words = FIELDS[prefix];
      
      if (wordIndex >= words.length) {
        // Fin du jeu
        endGame();
        return;
      }
      
      const currentWord = words[wordIndex];
      
      // Mettre √† jour l'affichage
      document.getElementById('prefixDisplay').textContent = prefix;
      document.getElementById('definitionDisplay').textContent = currentWord.def;
      document.getElementById('answer').value = '';
      document.getElementById('answer').disabled = false;
      document.getElementById('answer').focus();
      document.getElementById('message').innerHTML = '';
      document.getElementById('message').style.color = '';
      
      // Lire la d√©finition
      speak(`Toutes les bonnes r√©ponses commencent par les lettres : ${prefix}. D√©finition : ${currentWord.def}`);
      
      // D√©marrer le chrono local
      startLocalChrono();
    }

    // Gestion du chronom√®tre local
    function startLocalChrono() {
      if (localChronoTimer) clearInterval(localChronoTimer);
      
      let timeLeft = 20;
      updateChronoDisplay(timeLeft);
      
      localChronoTimer = setInterval(async () => {
        timeLeft--;
        updateChronoDisplay(timeLeft);
        
        // Mettre √† jour Firebase p√©riodiquement
        if (currentUser.isHost && timeLeft % 5 === 0) {
          await updateGameTime(timeLeft);
        }
        
        if (timeLeft <= 0) {
          clearInterval(localChronoTimer);
          await handleTimeUp();
        }
      }, 1000);
    }

    function updateChronoDisplay(timeLeft) {
      const chrono = document.getElementById('chrono');
      if (!chrono) return;
      
      if (timeLeft !== undefined) {
        chrono.textContent = timeLeft;
        chrono.className = '';
        if (timeLeft <= 5) {
          chrono.className = "danger";
        } else if (timeLeft <= 10) {
          chrono.className = "warning";
        }
      }
    }

    async function updateGameTime(timeLeft) {
      try {
        await db.collection('multiplayer_games').doc(currentGame.code).update({
          timeLeft: timeLeft,
          lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
        });
      } catch (error) {
        console.error("Erreur mise √† jour temps:", error);
      }
    }

    async function handleTimeUp() {
      const wordIndex = currentGame.currentWordIndex || 0;
      const prefix = currentGame.currentPrefix;
      const words = FIELDS[prefix];
      const currentWord = words[wordIndex];
      
      // Afficher le message temps √©coul√©
      document.getElementById('message').innerHTML = `‚è∞ Temps √©coul√© ! Le mot √©tait : <strong>${currentWord.mot}</strong>`;
      document.getElementById('message').style.color = "#ff5252";
      speak(`Temps √©coul√© ! Le mot √©tait : ${currentWord.mot}`);
      
      // D√©sactiver l'entr√©e
      document.getElementById('answer').disabled = true;
      
      // Passer au mot suivant apr√®s un d√©lai
      setTimeout(async () => {
        if (currentUser.isHost) {
          const nextWordIndex = wordIndex + 1;
          const nextWord = words[nextWordIndex];
          
          await db.collection('multiplayer_games').doc(currentGame.code).update({
            currentWordIndex: nextWordIndex,
            timeLeft: 20,
            currentWord: nextWord,
            lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
          });
        }
      }, 3000);
    }

    // Soumettre une r√©ponse
    async function submitAnswer() {
      const answerInput = document.getElementById('answer');
      const userAnswer = normalize(answerInput.value);
      
      if (!userAnswer) {
        alert("Veuillez entrer une r√©ponse.");
        return;
      }
      
      if (answerInput.disabled) {
        alert("Temps √©coul√© ! Attendez le prochain mot.");
        return;
      }
      
      const wordIndex = currentGame.currentWordIndex || 0;
      const prefix = currentGame.currentPrefix;
      const words = FIELDS[prefix];
      
      if (wordIndex >= words.length) {
        alert("La partie est termin√©e !");
        return;
      }
      
      const currentWord = words[wordIndex];
      const correctAnswer = normalize(currentWord.mot);
      
      // V√©rifier la r√©ponse
      const isCorrect = userAnswer === correctAnswer && userAnswer.startsWith(normalize(prefix));
      
      // Mettre √† jour le score
      let newScore = (currentGame.scores[currentUser.id] || 0);
      if (isCorrect) {
        newScore++;
      }
      
      try {
        await db.collection('multiplayer_games').doc(currentGame.code).update({
          [`scores.${currentUser.id}`]: newScore,
          lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        // Afficher le r√©sultat
        const message = document.getElementById('message');
        if (isCorrect) {
          message.innerHTML = `‚úÖ <strong>Correct !</strong> +1 point pour ${currentUser.name}`;
          message.style.color = "#00e676";
          speak("Correct !");
        } else {
          message.innerHTML = `‚ùå <strong>Incorrect.</strong> Le mot √©tait : ${currentWord.mot}`;
          message.style.color = "#ff5252";
          speak(`Incorrect. Le mot √©tait : ${currentWord.mot}`);
        }
        
        // D√©sactiver l'entr√©e
        answerInput.disabled = true;
        
        // Arr√™ter le chrono local
        if (localChronoTimer) {
          clearInterval(localChronoTimer);
          localChronoTimer = null;
        }
        
        // Si c'est l'h√¥te, passer au mot suivant apr√®s un d√©lai
        if (currentUser.isHost) {
          setTimeout(async () => {
            const nextWordIndex = wordIndex + 1;
            const nextWord = words[nextWordIndex];
            
            if (nextWordIndex < words.length) {
              await db.collection('multiplayer_games').doc(currentGame.code).update({
                currentWordIndex: nextWordIndex,
                timeLeft: 20,
                currentWord: nextWord,
                lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
              });
            } else {
              // Fin du jeu
              await endGame();
            }
          }, 2000);
        }
        
      } catch (error) {
        console.error("Erreur soumission r√©ponse:", error);
        alert("Erreur lors de l'envoi de la r√©ponse: " + error.message);
      }
    }

    // Terminer la partie
    async function endGame() {
      try {
        await db.collection('multiplayer_games').doc(currentGame.code).update({
          status: "finished",
          finishedAt: firebase.firestore.FieldValue.serverTimestamp(),
          lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
        });
      } catch (error) {
        console.error("Erreur fin de partie:", error);
      }
    }

    // Afficher les r√©sultats finaux
    function showResults() {
      console.log("Affichage des r√©sultats");
      showScreen('resultsScreen');
      
      const finalScores = document.getElementById('finalScores');
      if (!finalScores) return;
      
      finalScores.innerHTML = '';
      
      if (currentGame.players && currentGame.scores) {
        // Trouver le gagnant
        let winner = null;
        let highestScore = -1;
        
        currentGame.players.forEach(player => {
          const score = currentGame.scores[player.id] || 0;
          if (score > highestScore) {
            highestScore = score;
            winner = player;
          }
        });
        
        // Afficher chaque joueur
        currentGame.players.forEach(player => {
          const score = currentGame.scores[player.id] || 0;
          const isWinner = player.id === winner.id;
          const playerColor = player.playerColor || (player.isHost ? '#FF6B6B' : '#4ECDC4');
          const totalWords = currentGame.currentPrefix ? FIELDS[currentGame.currentPrefix].length : 10;
          const accuracy = Math.round((score / totalWords) * 100);
          
          const scoreDiv = document.createElement('div');
          scoreDiv.className = `final-score ${isWinner ? 'winner' : ''}`;
          
          scoreDiv.innerHTML = `
            ${isWinner ? '<div class="winner-badge">üèÜ GAGNANT</div>' : ''}
            <div class="final-player-name" style="color: ${playerColor}">
              ${player.name} ${player.isHost ? ' (H√¥te)' : ''}
            </div>
            <div class="final-score-value">${score}/${totalWords}</div>
            <div class="final-accuracy">
              ${accuracy}% de pr√©cision
            </div>
          `;
          
          finalScores.appendChild(scoreDiv);
        });
      }
      
      // Arr√™ter tous les timers
      if (localChronoTimer) {
        clearInterval(localChronoTimer);
        localChronoTimer = null;
      }
    }

    // Quitter le salon
    async function leaveLobby() {
      console.log("Quitter le salon");
      
      if (gameListener) {
        gameListener();
        gameListener = null;
      }
      
      if (currentUser.isHost && currentGame.code) {
        // Si c'est l'h√¥te, supprimer la partie
        try {
          await db.collection('multiplayer_games').doc(currentGame.code).delete();
          console.log("Partie supprim√©e par l'h√¥te");
        } catch (error) {
          console.error("Erreur suppression partie:", error);
        }
      } else if (currentGame.code) {
        // Sinon, retirer le joueur
        try {
          const playerToRemove = {
            id: currentUser.id,
            name: currentUser.name,
            isHost: false
          };
          
          await db.collection('multiplayer_games').doc(currentGame.code).update({
            players: firebase.firestore.FieldValue.arrayRemove(playerToRemove)
          });
          console.log("Joueur retir√© du salon");
        } catch (error) {
          console.error("Erreur retrait joueur:", error);
        }
      }
      
      resetGame();
      showScreen('loginScreen');
    }

    // Quitter la partie en cours
    async function leaveGame() {
      console.log("Quitter la partie");
      
      if (gameListener) {
        gameListener();
        gameListener = null;
      }
      
      if (currentUser.isHost && currentGame.code) {
        // L'h√¥te met fin √† la partie
        try {
          await db.collection('multiplayer_games').doc(currentGame.code).update({
            status: "finished"
          });
        } catch (error) {
          console.error("Erreur fin de partie:", error);
        }
      }
      
      resetGame();
      showScreen('loginScreen');
    }

    // Nouvelle partie
    function newGame() {
      console.log("Nouvelle partie");
      resetGame();
      showScreen('loginScreen');
    }

    // R√©initialiser le jeu
    function resetGame() {
      console.log("R√©initialisation du jeu");
      
      currentUser = {
        id: null,
        name: "moise",
        isHost: false,
        playerColor: "#FF6B6B"
      };
      
      currentGame = {
        id: null,
        code: null,
        players: [],
        status: "waiting",
        currentWordIndex: 0,
        currentPrefix: null,
        scores: {},
        timeLeft: 20,
        gameStarted: false
      };
      
      if (localChronoTimer) {
        clearInterval(localChronoTimer);
        localChronoTimer = null;
      }
      
      if (gameListener) {
        gameListener();
        gameListener = null;
      }
      
      // R√©initialiser l'affichage
      document.getElementById('answer').value = '';
      document.getElementById('answer').disabled = false;
      document.getElementById('message').innerHTML = '';
      document.getElementById('prefixDisplay').textContent = '‚Äì ‚Äì';
      document.getElementById('definitionDisplay').textContent = 'S√©lectionne un personnage pour commencer';
      updateChronoDisplay(20);
    }

    // Copier le code de la partie
    function copyGameCode() {
      const code = document.getElementById('gameCodeDisplay').textContent;
      navigator.clipboard.writeText(code).then(() => {
        const btn = document.getElementById('copyCodeBtn');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-check"></i> Code copi√© !';
        setTimeout(() => {
          btn.innerHTML = originalText;
        }, 2000);
      }).catch(err => {
        console.error("Erreur copie:", err);
        alert("Impossible de copier le code. Copiez-le manuellement: " + code);
      });
    }

    // Synth√®se vocale
    function speak(text, rate = speechRate) {
      if (!('speechSynthesis' in window)) {
        console.log("Synth√®se vocale non support√©e");
        return;
      }
      
      if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
      }
      
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'fr-FR';
      utterance.rate = rate;
      speechSynthesis.speak(utterance);
    }

    function repeatWord() {
      if (!currentGame.currentPrefix || currentGame.status !== "playing") {
        alert("Aucun mot en cours.");
        return;
      }
      
      const wordIndex = currentGame.currentWordIndex || 0;
      const prefix = currentGame.currentPrefix;
      const words = FIELDS[prefix];
      
      if (wordIndex < words.length) {
        const currentWord = words[wordIndex];
        speak(`Toutes les bonnes r√©ponses commencent par les lettres : ${prefix}. D√©finition : ${currentWord.def}`);
      }
    }

    // Panel admin
    function setupAdminPanel() {
      const adminModal = document.getElementById('adminModal');
      const adminButton = document.getElementById('adminButton');
      const closeAdminModal = document.getElementById('closeAdminModal');
      const loginButton = document.getElementById('loginButton');

      adminButton.addEventListener('click', () => {
        adminModal.style.display = 'block';
        document.getElementById('passwordSection').classList.remove('hidden');
        document.getElementById('adminPanel').classList.add('hidden');
        document.getElementById('adminPassword').value = '';
        document.body.style.overflow = 'hidden';
      });

      closeAdminModal.addEventListener('click', () => {
        adminModal.style.display = 'none';
        document.body.style.overflow = 'auto';
      });

      adminModal.addEventListener('click', (e) => {
        if (e.target === adminModal) {
          adminModal.style.display = 'none';
          document.body.style.overflow = 'auto';
        }
      });

      loginButton.addEventListener('click', () => {
        const password = document.getElementById('adminPassword').value;
        if (password === ADMIN_PASSWORD) {
          document.getElementById('passwordSection').classList.add('hidden');
          document.getElementById('adminPanel').classList.remove('hidden');
        } else {
          alert("Mot de passe incorrect. Le mot de passe est : legende360@");
        }
      });
    }

    // V√©rifier la connexion Firebase
    function checkFirebaseConnection() {
      db.collection('test').limit(1).get()
        .then(() => {
          console.log("‚úÖ Firebase connect√©");
          document.getElementById('connectionStatus').innerHTML = '<i class="fas fa-wifi"></i> Connect√©';
        })
        .catch(error => {
          console.error("‚ùå Erreur Firebase:", error);
          document.getElementById('connectionStatus').innerHTML = '<i class="fas fa-wifi-slash"></i> Hors ligne';
        });
    }

    // V√©rifier la connexion au chargement
    setTimeout(checkFirebaseConnection, 1000);
  </script>
</body>
</html>