<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>DictÃ©e â€“ Fables de La Fontaine</title>
  <style>
    /* Styles CSS inchangÃ©s */
  </style>
</head>
<body>
  <div class="container">
    <h1>DictÃ©e â€“ Fables de La Fontaine</h1>
    <div>
      <label for="dictationSelect">Choisissez une dictÃ©e :</label>
      <select id="dictationSelect">
        <option value="0">DictÃ©e 1 â€“ Le Laboureur et ses enfants</option>
        <option value="1">DictÃ©e 2 â€“ La Cigale et la Fourmi</option>
      </select>
    </div>
    <br>
    <textarea id="userInput" placeholder="Recopiez la dictÃ©e ici aprÃ¨s l'Ã©coute..." disabled></textarea>
    <div class="buttons">
      <button id="btnPlay">â–¶ï¸ Ã‰couter</button>
      <button id="btnPause">â¸ï¸ Pause</button>
      <button id="btnResume" disabled>â–¶ï¸ Reprendre</button>
      <button id="btnRepeat">ğŸ” RÃ©pÃ©ter</button>
      <button id="btnSlow">ğŸ¢ Ralentir</button>
      <button id="btnFast">ğŸ‡ AccÃ©lÃ©rer</button>
      <button id="btnCheck">âœ… Corriger</button>
    </div>
    <div id="feedback"></div>
  </div>

  <script>
    const dictations = [
      {
        title: "Le Laboureur et ses enfants",
        text: [
          "Travaillez, prenez de la peine : C'est le fonds qui manque le moins.",
          "Un riche Laboureur, sentant sa mort prochaine, fit venir ses enfants, leur parla sans tÃ©moins.",
          "Gardez-vous, leur dit-il, de vendre l'hÃ©ritage que nous ont laissÃ© nos parents.",
          "Un trÃ©sor est cachÃ© dedans.",
          "Je ne sais pas l'endroit ; mais un peu de courage vous le fera trouver, vous en viendrez Ã  bout.",
          "Remuez votre champ dÃ¨s qu'on aura fait l'OÃ»t.",
          "Creusez, fouillez, bÃªchez ; ne laissez nulle place oÃ¹ la main ne passe et repasse.",
          "Le pÃ¨re mort, les fils vous retournent le champ deÃ§Ã , delÃ , partout ; si bien qu'au bout de l'an, il en rapporta davantage.",
          "D'argent, point de cachÃ©. Mais le pÃ¨re fut sage de leur montrer avant sa mort que le travail est un trÃ©sor."
        ]
      },
      {
        title: "La Cigale et la Fourmi",
        text: [
          "La Cigale, ayant chantÃ© tout l'Ã©tÃ©, se trouva fort dÃ©pourvue quand la bise fut venue.",
          "Pas un seul petit morceau de mouche ou de vermisseau.",
          "Elle alla crier famine chez la Fourmi sa voisine, la priant de lui prÃªter quelque grain pour subsister jusqu'Ã  la saison nouvelle.",
          "Â« Je vous paierai, lui dit-elle, avant l'aoÃ»t, foi d'animal, intÃ©rÃªt et principal. Â»",
          "La Fourmi n'est pas prÃªteuse : C'est lÃ  son moindre dÃ©faut.",
          "Â« Que faisiez-vous au temps chaud ? Â» dit-elle Ã  cette emprunteuse.",
          "â€” Nuit et jour Ã  tout venant je chantais, ne vous dÃ©plaise.",
          "â€” Vous chantiez ? j'en suis fort aise ; eh bien dansez maintenant."
        ]
      }
    ];

    let currentDictationIndex = 0;
    let rate = 1;
    let isPaused = false;
    let isSpeaking = false;
    let currentUtterance = null;

    const userInput = document.getElementById("userInput");
    const feedback = document.getElementById("feedback");
    const select = document.getElementById("dictationSelect");

    function speak(text, rate = 1) {
      if (isSpeaking) {
        speechSynthesis.cancel();
      }

      currentUtterance = new SpeechSynthesisUtterance(text);
      currentUtterance.lang = "fr-FR";
      currentUtterance.rate = rate;
      currentUtterance.onstart = () => {
        isSpeaking = true;
        userInput.disabled = true;
      };
      currentUtterance.onend = () => {
        isSpeaking = false;
        userInput.disabled = false;
      };
      speechSynthesis.speak(currentUtterance);
    }

    function playDictation() {
      const dictationText = dictations[currentDictationIndex].text.join(" ");
      speak(dictationText, rate);
    }

    function pauseDictation() {
      if (isSpeaking) {
        speechSynthesis.pause();
        isPaused = true;
        document.getElementById("btnPause").disabled = true;
        document.getElementById("btnResume").disabled = false;
      }
    }

    function resumeDictation() {
      if (isPaused) {
        speechSynthesis.resume();
        isPaused = false;
        document.getElementById("btnPause").disabled = false;
        document.getElementById("btnResume").disabled = true;
      }
    }

    function repeatDictation() {
      if (isSpeaking) {
        speechSynthesis.cancel();
      }
      const dictationText = dictations[currentDictationIndex].text.join(" ");
      speak(dictationText, rate);
    }

    function checkDictation() {
      const userText = userInput.value.trim().toLowerCase().replace(/[â€™']/g, "'");
      const correctText = dictations[currentDictationIndex].text.join(" ").toLowerCase().replace(/[â€™']/g, "'");
      const result = userText === correctText;

      feedback.innerHTML = result
        ? "âœ… Bravo ! Vous avez parfaitement recopiÃ© la dictÃ©e."
        : `âŒ Erreurs dÃ©tectÃ©es.\n\nTexte attendu :\n"${dictations[currentDictationIndex].text.join(" ")}"`;
      feedback.style.color = result ? "#00e676" : "#ff5252";
    }

    document.getElementById("btnPlay").onclick = playDictation;
    document.getElementById("btnPause").onclick = pauseDictation;
    document.getElementById("btnResume").onclick = resumeDictation;
    document.getElementById("btnRepeat").onclick = repeatDictation;
    document.getElementById("btnSlow").onclick = () => {
      rate = Math.max(0.5, rate - 0.25);
      if (isSpeaking) {
        speechSynthesis.cancel();
        playDictation();
      }
    };
    document.getElementById("btnFast").onclick = () => {
      rate = Math.min(2, rate + 0.25);
      if (isSpeaking) {
        speechSynthesis.cancel();
        playDictation();
      }
    };
    document.getElementById("btnCheck").onclick = checkDictation;

    select.onchange = () => {
      currentDictationIndex = parseInt(select.value);
      userInput.value = "";
      feedback.textContent = "";
    };
  </script>
</body>
</html>
