<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Champs Lexicaux ‚Äì Jeu Vocal (4 lettres)</title>
  <style>
    :root{
      --bg1:#6a11cb; --bg2:#2575fc;
      --card: rgba(255,255,255,.12);
      --glass: blur(12px);
      --txt:#fff; --accent:#fff; --brand:#2575fc;
      --ok:#00e676; --ko:#ff5252;
    }
    *{box-sizing:border-box}
    body{
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(270deg, var(--bg1), var(--bg2), var(--bg1));
      background-size: 600% 600%;
      animation: gradientAnimation 15s ease infinite;
      color: var(--txt);
      min-height: 100vh;
      margin: 0;
      display: grid;
      place-items: center;
      padding: 24px;
    }
    @keyframes gradientAnimation{
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }
    .container{
      background: var(--card);
      backdrop-filter: var(--glass);
      width: min(920px, 94vw);
      border-radius: 20px;
      padding: 28px;
      box-shadow: 0 8px 32px rgba(0,0,0,.25);
      animation: fadeIn .9s ease;
    }
    @keyframes fadeIn{from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:translateY(0)}}
    header{
      display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap
    }
    h1{
      font-weight:800; margin:0; font-size: clamp(22px, 3.2vw, 34px);
      text-shadow: 0 3px 8px rgba(0,0,0,.3);
      letter-spacing:.3px;
    }
    .status{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; font-weight:600;
      opacity:.95;
    }
    .pill{
      padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.16);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.16);
      font-size:.95rem
    }
    .display{
      margin:24px 0 10px; display:grid; gap:10px;
    }
    #prefixDisplay{
      font-size: clamp(28px, 5vw, 48px);
      font-weight:900; letter-spacing:.18em; text-align:center;
      text-shadow: 0 3px 8px rgba(0,0,0,.28);
    }
    #definitionDisplay{
      font-size: clamp(16px, 2vw, 20px);
      line-height:1.6; text-align:center;
      background: rgba(0,0,0,.16);
      border-radius:14px; padding:16px 18px;
    }
    .controls{
      display:grid; grid-template-columns: repeat(6,1fr); gap:10px; margin:12px 0 6px;
    }
    button{
      padding:12px; font-size:1.05rem; font-weight:700; border-radius:12px; border:none;
      cursor:pointer; background:#fff; color:var(--brand);
      transition:.25s; box-shadow:0 4px 10px rgba(0,0,0,.1);
    }
    button:hover{ background:var(--brand); color:#fff; box-shadow:0 0 12px #ffffff99, 0 0 18px #2575fcaa }
    button:disabled{opacity:.55; cursor:not-allowed}
    input[type="text"]{
      font-size:1.2rem; padding:14px 16px; border-radius:12px; border:none; width:100%;
      margin:10px 0 14px; background:#fff; color:#222; outline:none; transition:.25s;
    }
    input[type="text"]:focus{ box-shadow:0 0 10px var(--brand); caret-color:var(--brand) }
    #message{ min-height:28px; font-size:1.1rem; font-weight:700; text-align:center; margin:6px 0 0 }
    .divider{ height:1px; background:rgba(255,255,255,.18); margin:18px 0 }
    .bank{
      display:flex; flex-wrap:wrap; gap:10px; justify-content:center;
    }
    .bank button{
      background:rgba(255,255,255,.12); color:#fff; font-weight:800; letter-spacing:.08em;
      border:1px solid rgba(255,255,255,.18);
    }
    .bank button.active{ background:#fff; color:var(--brand) }
    .footnote{
      margin-top:10px; text-align:center; opacity:.85; font-size:.95rem
    }
    .sr-only{ position:absolute; left:-10000px; top:auto; width:1px; height:1px; overflow:hidden; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Champs lexicaux ‚Äì Jeu vocal (4 lettres)</h1>
      <div class="status">
        <span class="pill" id="progressPill">0 / 0</span>
        <span class="pill" id="speedPill">Vitesse √ó1.00</span>
        <span class="pill" id="hintPill">Toutes les r√©ponses commencent par&nbsp;<b id="hintPrefix">‚Äî ‚Äî ‚Äî ‚Äî</b></span>
      </div>
    </header>

    <div class="display">
      <div id="prefixDisplay">‚Äî ‚Äî ‚Äî ‚Äî</div>
      <div id="definitionDisplay">Clique un pr√©fixe ci-dessous ou appuie sur ‚ñ∂Ô∏è Jouer.</div>
    </div>

    <input type="text" id="answer" placeholder="√âcris le mot correct (m√™me 4 lettres initiales) et appuie sur Entr√©e‚Ä¶" autocomplete="off" />

    <div class="controls" role="group" aria-label="Commandes">
      <button id="btnPlay">‚ñ∂Ô∏è Jouer</button>
      <button id="btnSlow">üê¢ Ralentir</button>
      <button id="btnFast">üêá Acc√©l√©rer</button>
      <button id="btnRepeat">üîÅ R√©p√©ter</button>
      <button id="btnSkip">‚è≠ Passer</button>
      <button id="btnBack">‚¨ÖÔ∏è Retour</button>
    </div>

    <div id="message" aria-live="polite"></div>

    <div class="divider"></div>

    <div class="bank" id="initialBank" aria-label="Liste de pr√©fixes (s√©lection rapide)"></div>
    <div class="footnote">Astuce : change la vitesse et r√©p√®te la d√©finition √† volont√©.</div>
  </div>

  <script>
    // ================================
    // Donn√©es : CHAMPS LEXICAUX (4 lettres)
    // R√®gles: mots simples (pas d'expressions compos√©es), sans doublons, orthographe corrig√©e.
    // Chaque r√©ponse doit commencer par le pr√©fixe de 4 lettres (cl√© du champ).
    // ================================
    const FIELDS = {
      "CART": [
        {mot:"Carton", def:"Papier rigide utilis√© notamment pour emballer."},
        {mot:"Cartable", def:"Sac d‚Äô√©colier pour transporter cahiers et livres."},
        {mot:"Carte", def:"Document figurant des informations (g√©ographiques, etc.)."},
        {mot:"Cartouche", def:"Recharge d‚Äôencre ou munitions."},
        {mot:"Cartographe", def:"Sp√©cialiste de la r√©alisation de cartes."},
        {mot:"Cartographie", def:"Science/technique de la repr√©sentation des territoires."},
        {mot:"Cartonner", def:"Obtenir un grand succ√®s (familier)."},
        {mot:"Cartel", def:"Entente d‚Äôentreprises visant √† limiter la concurrence."},
        {mot:"Cartomancie", def:"Art divinatoire utilisant des cartes."},
        {mot:"Cartomancien", def:"Personne qui pratique la cartomancie."},
        {mot:"Cartulaire", def:"Recueil de chartes et de documents (histoire)."}
      ],

      "PLAN": [
        {mot:"Plante", def:"√ätre vivant du r√®gne v√©g√©tal."},
        {mot:"Planter", def:"Mettre une graine ou un v√©g√©tal en terre."},
        {mot:"Plantation", def:"Terrain cultiv√© de v√©g√©taux."},
        {mot:"Planteur", def:"Personne qui exploite une plantation."},
        {mot:"Plantule", def:"Jeune pousse v√©g√©tale."},
        {mot:"Plantain", def:"Plante herbac√©e courante."},
        {mot:"Plantigrade", def:"Animal marchant sur la plante des pieds."},
        {mot:"Plantoir", def:"Outil servant √† planter."},
        {mot:"Plantureux", def:"Abondant, g√©n√©reux."},
        {mot:"Plantin", def:"Petit plant destin√© √† √™tre replant√©."}
      ],

      "CHAN": [
        {mot:"Chant", def:"M√©lodie vocale."},
        {mot:"Chanter", def:"Produire des sons musicaux avec la voix."},
        {mot:"Chanteur", def:"Personne qui chante."},
        {mot:"Chanson", def:"Pi√®ce vocale avec couplets et refrain."},
        {mot:"Chantonner", def:"Chanter doucement, √† mi-voix."},
        {mot:"Chantonnement", def:"Fait de fredonner √† voix basse."},
        {mot:"Chanterelle", def:"Petite corde aigu√´ d‚Äôun instrument √† cordes."},
        {mot:"Chantre", def:"Personne qui c√©l√®bre ou d√©fend une id√©e."},
        {mot:"Chant√©", def:"Interpr√©t√© vocalement."}
      ],

      "PORT": [
        {mot:"Port", def:"Lieu d‚Äôaccostage des bateaux."},
        {mot:"Porter", def:"Tenir, transporter sur soi."},
        {mot:"Portable", def:"Qu‚Äôon peut transporter facilement."},
        {mot:"Porteur", def:"Personne ou chose qui porte."},
        {mot:"Portail", def:"Grande porte monumentale."},
        {mot:"Portuaire", def:"Relatif aux ports."},
        {mot:"Portance", def:"Force de soutien d‚Äôun profil en fluide."},
        {mot:"Portier", def:"Personne charg√©e d‚Äôune entr√©e."},
        {mot:"Portillon", def:"Petite porte d‚Äôacc√®s."}
      ],

      "MONT": [
        {mot:"Montagne", def:"Relief naturel √©lev√©."},
        {mot:"Monter", def:"Aller vers le haut ; grimper."},
        {mot:"Montant", def:"Somme due ; pi√®ce verticale."},
        {mot:"Monture", def:"Support d‚Äôun objet ; animal qu‚Äôon monte."},
        {mot:"Monticule", def:"Petite √©l√©vation de terrain."},
        {mot:"Mont√©e", def:"Action de grimper ; pente."},
        {mot:"Montagnard", def:"Habitant des r√©gions de montagne."},
        {mot:"Monteur", def:"Personne qui assemble (films, machines‚Ä¶)."},
        {mot:"Montreur", def:"Personne qui pr√©sente (d‚Äôanimaux, marionnettes‚Ä¶)."}
      ],

      "LUMI": [
        {mot:"Lumi√®re", def:"Ce qui rend les objets visibles."},
        {mot:"Lumineux", def:"Qui √©met ou r√©fl√©chit la lumi√®re."},
        {mot:"Luminaire", def:"Appareil d‚Äô√©clairage."},
        {mot:"Luminescence", def:"√âmission de lumi√®re sans chaleur."},
        {mot:"Lumignon", def:"Petite bougie mince."},
        {mot:"Luminance", def:"Intensit√© lumineuse per√ßue d‚Äôune surface."},
        {mot:"Luminoth√©rapie", def:"Traitement par la lumi√®re."},
        {mot:"Luminophore", def:"Substance qui √©met de la lumi√®re."}
      ],

      "VENT": [
        {mot:"Vent", def:"Mouvement d‚Äôair naturel."},
        {mot:"Venteux", def:"O√π il y a beaucoup de vent."},
        {mot:"Ventiler", def:"Faire circuler l‚Äôair."},
        {mot:"Ventilation", def:"Renouvellement de l‚Äôair."},
        {mot:"Ventilateur", def:"Appareil qui brasse l‚Äôair."},
        {mot:"Ventouse", def:"Dispositif d‚Äôaspiration par succion."},
        {mot:"Ventail", def:"Battant (ancien) de casque ou de porte."}
      ],

      "ECLA": [
        {mot:"√âclair", def:"Lueur br√®ve d‚Äôun orage ; p√¢tisserie allong√©e."},
        {mot:"√âclat", def:"Brillance vive ; fragment projet√©."},
        {mot:"√âclater", def:"Se briser violemment ; √©clore au grand jour."},
        {mot:"√âclaircir", def:"Rendre plus clair ou compr√©hensible."},
        {mot:"√âclairage", def:"Action d‚Äô√©clairer ; dispositif lumineux."},
        {mot:"√âclaireur", def:"Personne qui explore et guide."},
        {mot:"√âclabousser", def:"Projeter un liquide par √©clats."},
        {mot:"√âclaboussure", def:"Trace laiss√©e par un liquide projet√©."},
        {mot:"√âclatant", def:"Tr√®s lumineux ; remarquable."}
      ],

      "JOUR": [
        {mot:"Jour", def:"Espace de temps de 24 heures ; clart√© du jour."},
        {mot:"Journal", def:"Publication p√©riodique d‚Äôactualit√©s."},
        {mot:"Journ√©e", def:"Dur√©e du jour ; p√©riode d‚Äôactivit√©."},
        {mot:"Journalier", def:"Quotidien ; ouvrier pay√© √† la journ√©e."},
        {mot:"Journaliste", def:"Professionnel de l‚Äôinformation."},
        {mot:"Journaux", def:"Pluriel de journal (publications)."}
      ],

      "COMM": [
        {mot:"Commencer", def:"Entamer, d√©buter une action."},
        {mot:"Commande", def:"Action de commander ; ordre d‚Äôachat."},
        {mot:"Commandant", def:"Officier qui commande."},
        {mot:"Commentaire", def:"Explication ou appr√©ciation d‚Äôun texte."},
        {mot:"Commerce", def:"Achat et vente de biens et services."},
        {mot:"Commer√ßant", def:"Personne qui exerce le commerce."},
        {mot:"Commodit√©", def:"Caract√®re de ce qui est pratique."},
        {mot:"Commode", def:"Pratique ; meuble √† tiroirs."},
        {mot:"Commotion", def:"Choc physique ou psychique."},
        {mot:"Comit√©", def:"Groupe charg√© d‚Äôune mission."},
        {mot:"Communaut√©", def:"Groupe partageant des int√©r√™ts communs."},
        {mot:"Communication", def:"Action de communiquer ; message transmis."}
      ],

      "TEMP": [
        {mot:"Temps", def:"Dur√©e ; moment ; m√©t√©o."},
        {mot:"Temp√™te", def:"Perturbation atmosph√©rique violente."},
        {mot:"Temp√©rer", def:"Mod√©rer, adoucir."},
        {mot:"Temp√©rament", def:"Caract√®re naturel d‚Äôune personne."},
        {mot:"Temp√©rature", def:"Degr√© de chaleur mesur√©."},
        {mot:"Temporel", def:"Relatif au temps ; non spirituel."},
        {mot:"Temporaire", def:"Provisoire, qui ne dure pas."},
        {mot:"Temporal", def:"Relatif au temps (anatomie : r√©gion des tempes)."},
        {mot:"Temporiser", def:"Diff√©rer une d√©cision ; gagner du temps."},
        {mot:"Templier", def:"Membre de l‚Äôordre des Templiers."}
      ],

      "POUR": [
        {mot:"Pourcentage", def:"Proportion exprim√©e sur cent."},
        {mot:"Pourboire", def:"Somme donn√©e en plus pour un service."},
        {mot:"Pourvoir", def:"Fournir, doter."},
        {mot:"Pourvoyeur", def:"Personne qui pourvoit, fournit."},
        {mot:"Pourparlers", def:"N√©gociations en vue d‚Äôun accord."},
        {mot:"Pourpre", def:"Couleur rouge violac√©."},
        {mot:"Pourchasser", def:"Poursuivre afin de capturer."},
        {mot:"Pourrir", def:"Se d√©composer ; g√¢ter."},
        {mot:"Pourriture", def:"Alt√©ration d‚Äôune mati√®re organique."},
        {mot:"Pourtour", def:"Bord, contour d‚Äôun espace."}
      ],

      "BLAN": [
        {mot:"Blanc", def:"Couleur de la lumi√®re, oppos√©e au noir."},
        {mot:"Blanchir", def:"Rendre plus blanc ; l√©galiser de l‚Äôargent."},
        {mot:"Blancheur", def:"Qualit√© de ce qui est blanc."},
        {mot:"Blanchiment", def:"Action de blanchir ; op√©ration ill√©gale financi√®re."},
        {mot:"Blanchisserie", def:"Lieu o√π l‚Äôon lave/repassage du linge."},
        {mot:"Blanquette", def:"Plat en sauce √† base de viande blanche."},
        {mot:"Blanch√¢tre", def:"Qui tire sur le blanc."}
      ],

      "ROUG": [
        {mot:"Rouge", def:"Couleur vive du spectre."},
        {mot:"Rougir", def:"Devenir rouge."},
        {mot:"Rougeur", def:"Coloration rouge de la peau."},
        {mot:"Rougeole", def:"Maladie virale contagieuse."},
        {mot:"Rougeoyant", def:"Qui luit d‚Äôune teinte rouge."},
        {mot:"Rouge√¢tre", def:"L√©g√®rement rouge."},
        {mot:"Rougissement", def:"Action de rougir."}
      ],

      "OUVR": [
        {mot:"Ouvrir", def:"Rendre accessible en √©cartant un obstacle."},
        {mot:"Ouverture", def:"Action d‚Äôouvrir ; espace ouvert."},
        {mot:"Ouvrage", def:"Travail r√©alis√© ; livre ; construction."},
        {mot:"Ouvrier", def:"Travailleur manuel."},
        {mot:"Ouvreur", def:"Employ√© qui place le public ; personne qui ouvre."},
        {mot:"Ouvrable", def:"Se dit d‚Äôun jour o√π l‚Äôon travaille."},
        {mot:"Ouvrag√©", def:"Travaill√© avec ornementation."}
      ],

      "NUIT": [
        {mot:"Nuit", def:"P√©riode d‚Äôobscurit√© entre deux jours."},
        {mot:"Nuit√©", def:"H√©bergement d‚Äôune nuit (nuit√©e)."},
        {mot:"Nuit√©e", def:"P√©riode d‚Äôune nuit pass√©e quelque part."},
        {mot:"Nuitamment", def:"Pendant la nuit."},
        {mot:"Nuiteux", def:"Qui √©voque la nuit (rare)."},
        {mot:"Nuitard", def:"Personne active tard la nuit (fam.)."}
      ],

      "VERS": [
        {mot:"Verser", def:"Faire couler un liquide ; attribuer une somme."},
        {mot:"Version", def:"Forme d‚Äôun texte, d‚Äôun produit."},
        {mot:"Versant", def:"Flanc d‚Äôune montagne."},
        {mot:"Verset", def:"Division d‚Äôun texte religieux ou po√©tique."},
        {mot:"Versification", def:"Art de composer des vers."},
        {mot:"Versificateur", def:"Personne qui compose des vers."},
        {mot:"Versicolore", def:"De plusieurs couleurs changeantes."},
        {mot:"Versatile", def:"Qui change facilement d‚Äôopinion."},
        {mot:"Versoir", def:"Pi√®ce de charrue qui renverse la terre."},
        {mot:"Versement", def:"Somme d‚Äôargent pay√©e."}
      ],

      "GLAC": [
        {mot:"Glace", def:"Eau solidifi√©e ; miroir ; dessert glac√©."},
        {mot:"Glacier", def:"Masse de glace ; vendeur de glaces."},
        {mot:"Glacial", def:"Tr√®s froid ; distant."},
        {mot:"Glaci√®re", def:"R√©cipient/appareil qui garde au frais."},
        {mot:"Glacer", def:"Couvrir de glace ; refroidir fortement."},
        {mot:"Glacis", def:"Pente d√©gag√©e devant une fortification."},
        {mot:"Glaciation", def:"P√©riode d‚Äôextension des glaciers."},
        {mot:"Glaciologue", def:"Sp√©cialiste des glaciers."},
        {mot:"Glaciologie", def:"√âtude scientifique des glaciers."},
        {mot:"Glacure", def:"Couche vitrifi√©e d‚Äôune c√©ramique."}
      ],

      "SOLE": [
        {mot:"Sole", def:"Poisson plat ; partie inf√©rieure d‚Äôune chaussure."},
        {mot:"Soleil", def:"Astre central du syst√®me solaire."},
        {mot:"Solaire", def:"Relatif au soleil."},
        {mot:"Solennel", def:"Marqu√© par le s√©rieux d‚Äôune c√©r√©monie."},
        {mot:"Solennit√©", def:"Caract√®re solennel d‚Äôun √©v√©nement."},
        {mot:"Sol√©cisme", def:"Faute de syntaxe."},
        {mot:"Sol√©no√Øde", def:"Bobine produisant un champ magn√©tique."}
      ],

      "COUL": [
        {mot:"Couler", def:"S‚Äô√©couler ; sombrer."},
        {mot:"Coul√©e", def:"√âcoulement de mati√®re ; langue de lave."},
        {mot:"Coulis", def:"Sauce/pur√©e liquide (cuisine)."},
        {mot:"Coulissant", def:"Qui glisse sur un rail."},
        {mot:"Coulisse", def:"Partie lat√©rale d‚Äôune sc√®ne ; pi√®ce mobile."},
        {mot:"Couloir", def:"Passage √©troit dans un b√¢timent."},
        {mot:"Coulure", def:"Trace laiss√©e par un √©coulement visqueux."},
        {mot:"Couleur", def:"Sensation visuelle li√©e √† la lumi√®re."}
      ],

      "BOUL": [
        {mot:"Boulanger", def:"Personne qui fabrique et vend le pain."},
        {mot:"Boulangerie", def:"Lieu de fabrication/vente du pain."},
        {mot:"Boule", def:"Objet de forme sph√©rique."},
        {mot:"Boulon", def:"Tige filet√©e avec t√™te."},
        {mot:"Boulonner", def:"Fixer avec des boulons."},
        {mot:"Boulier", def:"Instrument de calcul √† billes."},
        {mot:"Bouliste", def:"Joueur de boules (p√©tanque, etc.)."},
        {mot:"Boulot", def:"Travail, emploi (familier)."}
      ],

      "ROCH": [
        {mot:"Roche", def:"Masse solide compos√©e de min√©raux."},
        {mot:"Rocher", def:"Bloc de roche ; √©cueil."},
        {mot:"Rocheux", def:"Compos√© de roches ; pierreux."},
        {mot:"Rochaille", def:"Assemblage de rochers ; terrain caillouteux."},
        {mot:"Rochassier", def:"Tr√®s pierreux (r√©gional/tech.)."},
        {mot:"Rochis", def:"Petit rocher (rare)."},
        {mot:"Rochage", def:"Action de disposer des roches (tech.)."}
      ]
    };

    // --- √âl√©ments DOM ---
    const prefixDisplay = document.getElementById("prefixDisplay");
    const definitionDisplay = document.getElementById("definitionDisplay");
    const answerInput = document.getElementById("answer");
    const message = document.getElementById("message");
    const btnPlay = document.getElementById("btnPlay");
    const btnSlow = document.getElementById("btnSlow");
    const btnFast = document.getElementById("btnFast");
    const btnRepeat = document.getElementById("btnRepeat");
    const btnSkip = document.getElementById("btnSkip");
    const btnBack = document.getElementById("btnBack");
    const initialBank = document.getElementById("initialBank");
    const progressPill = document.getElementById("progressPill");
    const speedPill = document.getElementById("speedPill");
    const hintPrefix = document.getElementById("hintPrefix");

    // --- √âtat du jeu ---
    let currentPrefix = null;
    let currentIndex = 0;
    let speechRate = 1;

    // --- Utilitaires ---
    const normalize = s => s
      .toLowerCase()
      .normalize('NFD').replace(/[\u0300-\u036f]/g,'')  // retire accents
      .replace(/[^a-z\-‚Äô' ]/g,'')                       // garde lettres/espaces/apostrophes
      .trim();

    function updatePills(){
      const total = currentPrefix ? FIELDS[currentPrefix].length : 0;
      progressPill.textContent = total ? `${currentIndex+1} / ${total}` : `0 / 0`;
      speedPill.textContent = `Vitesse √ó${speechRate.toFixed(2)}`;
      hintPrefix.textContent = currentPrefix || "‚Äî ‚Äî ‚Äî ‚Äî";
    }

    function ttsCancel(){ if ('speechSynthesis' in window) speechSynthesis.cancel(); }
    function speak(text, rate=speechRate){
      if(!('speechSynthesis' in window)) { return; }
      ttsCancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'fr-FR';
      u.rate = rate;
      speechSynthesis.speak(u);
    }

    function announce(){
      if(!currentPrefix) return;
      const item = FIELDS[currentPrefix][currentIndex];
      const intro = `Toutes les bonnes r√©ponses commencent par : ${currentPrefix}.`;
      const def  = item.def;
      speak(`${intro} D√©finition : ${def}`);
    }

    function renderCard(){
      if(!currentPrefix){
        prefixDisplay.textContent = "‚Äî ‚Äî ‚Äî ‚Äî";
        definitionDisplay.textContent = "Choisis un pr√©fixe ci-dessous pour commencer, ou appuie sur ‚ñ∂Ô∏è Jouer pour d√©marrer au premier.";
        updatePills();
        return;
      }
      const item = FIELDS[currentPrefix][currentIndex];
      prefixDisplay.textContent = currentPrefix;
      definitionDisplay.textContent = item.def;
      message.textContent = "√âcris le mot correspondant. (Il doit commencer par " + currentPrefix + ")";
      message.style.color = "#fff";
      answerInput.value = "";
      answerInput.placeholder = `Un mot qui commence par ¬´ ${currentPrefix} ¬ª‚Ä¶`;
      answerInput.disabled = false;
      updatePills();
    }

    function setPrefix(prefix){
      if(!FIELDS[prefix]) return;
      currentPrefix = prefix;
      currentIndex = 0;
      highlightBank(prefix);
      renderCard();
      announce();
      answerInput.focus();
    }

    function next(){
      if(!currentPrefix) return;
      currentIndex++;
      const list = FIELDS[currentPrefix];
      if(currentIndex >= list.length){
        currentIndex = list.length-1;
        message.textContent = `üéâ Bravo ! Tu as termin√© le champ lexical ${currentPrefix}. Choisis un autre pr√©fixe ci-dessous.`;
        message.style.color = "#00e676";
        answerInput.disabled = true;
        ttsCancel();
        speak(`Bravo ! Tu as termin√© le champ lexical ${currentPrefix}.`);
        return;
      }
      renderCard();
      announce();
      answerInput.focus();
    }

    function back(){
      if(!currentPrefix) return;
      if(currentIndex > 0){
        currentIndex--;
        renderCard();
        announce();
        answerInput.focus();
      }
    }

    function repeat(){ announce(); }

    function slower(){
      speechRate = Math.max(0.5, speechRate - 0.25);
      updatePills();
      announce();
    }
    function faster(){
      speechRate = Math.min(2, speechRate + 0.25);
      updatePills();
      announce();
    }

    function check(){
      if(!currentPrefix) return;
      const item = FIELDS[currentPrefix][currentIndex];
      const user = normalize(answerInput.value);
      const target = normalize(item.mot);
      if(user && user.startsWith(normalize(currentPrefix)) && user === target){
        message.textContent = "‚úÖ Correct ! Bien jou√©.";
        message.style.color = "#00e676";
        speak("Correct ! Bien jou√©.");
        setTimeout(next, 900);
      }else{
        message.textContent = `‚ùå Incorrect. Il fallait : ${item.mot}.`;
        message.style.color = "#ff5252";
        speak(`Incorrect. Il fallait : ${item.mot}.`);
      }
    }

    // --- Banque de pr√©fixes cliquables ---
    function buildBank(){
      const keys = Object.keys(FIELDS);
      keys.sort((a,b)=>a.localeCompare(b,'fr'));
      initialBank.innerHTML = "";
      for(const k of keys){
        const btn = document.createElement("button");
        btn.textContent = k.toUpperCase();
        btn.setAttribute("aria-label", `Choisir le champ lexical ${k}`);
        btn.addEventListener("click", ()=> setPrefix(k));
        initialBank.appendChild(btn);
      }
    }
    function highlightBank(k){
      [...initialBank.children].forEach(b=>{
        b.classList.toggle('active', b.textContent === k.toUpperCase());
      });
    }

    // --- √âcouteurs ---
    btnPlay.addEventListener("click", ()=>{
      if(!currentPrefix){
        const first = Object.keys(FIELDS).sort((a,b)=>a.localeCompare(b,'fr'))[0];
        setPrefix(first);
      }else{
        announce();
      }
    });
    btnSlow.addEventListener("click", slower);
    btnFast.addEventListener("click", faster);
    btnRepeat.addEventListener("click", repeat);
    btnSkip.addEventListener("click", next);
    btnBack.addEventListener("click", back);

    answerInput.addEventListener("keydown", (e)=>{
      if(e.key === "Enter") check();
    });

    // --- D√©marrage ---
    window.addEventListener("load", ()=>{
      buildBank();
      renderCard();
      if(!('speechSynthesis' in window)){
        message.innerHTML = "‚ÑπÔ∏è La synth√®se vocale n'est pas disponible sur ce navigateur.";
      }
    });
  </script>
</body>
</html>