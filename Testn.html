<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Devoirs de Français - Famille Singa</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
            color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        .admin-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: #ff6b6b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .admin-btn:hover {
            background-color: #ff5252;
            transform: scale(1.05);
        }
        
        .admin-panel {
            display: none;
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            border: 3px solid #182848;
        }
        
        .admin-panel.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .admin-header {
            text-align: center;
            margin-bottom: 30px;
            color: #182848;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .admin-header h2 {
            font-size: 2rem;
        }
        
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 5px solid #4b6cb7;
        }
        
        .stat-card h3 {
            color: #182848;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #4b6cb7;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .results-table th {
            background-color: #182848;
            color: white;
            padding: 15px;
            text-align: left;
        }
        
        .results-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .results-table tr:hover {
            background-color: #f8f9fa;
        }
        
        .export-btn {
            background-color: #4b6cb7;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            transition: all 0.3s ease;
        }
        
        .export-btn:hover {
            background-color: #3a56a4;
            transform: scale(1.05);
        }
        
        .auth-form {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            margin: 50px auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .auth-form h2 {
            text-align: center;
            margin-bottom: 25px;
            color: #182848;
        }
        
        .auth-form input {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .auth-form button {
            width: 100%;
            padding: 12px;
            background-color: #4b6cb7;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .auth-form button:hover {
            background-color: #3a56a4;
        }
        
        .auth-message {
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            border-radius: 8px;
        }
        
        .auth-message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .auth-message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .family-members {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .member-btn {
            padding: 18px 30px;
            font-size: 1.3rem;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .member-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        
        .member-btn i {
            font-size: 1.5rem;
        }
        
        #aubaine-btn {
            background-color: #3498db;
            color: white;
        }
        
        #moise-btn {
            background-color: #2ecc71;
            color: white;
        }
        
        #credo-btn {
            background-color: #9b59b6;
            color: white;
        }
        
        .instructions {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-left: 5px solid #4b6cb7;
        }
        
        .instructions h3 {
            color: #182848;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .instructions ul {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 10px;
        }
        
        .content-area {
            display: none;
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            margin-top: 20px;
        }
        
        .active-content {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .content-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .content-header h2 {
            color: #182848;
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .content-header .member-role {
            font-size: 1.1rem;
            color: #4b6cb7;
            font-weight: 600;
        }
        
        .questions-container {
            margin-bottom: 30px;
        }
        
        .question {
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 1px dashed #e0e0e0;
        }
        
        .question:last-child {
            border-bottom: none;
        }
        
        .question-number {
            display: inline-block;
            background-color: #4b6cb7;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            text-align: center;
            line-height: 32px;
            margin-right: 10px;
            font-weight: bold;
        }
        
        .question-text {
            font-size: 1.1rem;
            margin-bottom: 15px;
            font-weight: 500;
        }
        
        .options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .option {
            padding: 12px 15px;
            background-color: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
        }
        
        .option:hover {
            background-color: #e9ecef;
        }
        
        .option.selected {
            background-color: #d1ecf1;
            border-color: #3498db;
            color: #0c5460;
        }
        
        .option.correct {
            background-color: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        
        .option.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
        
        .option input {
            margin-right: 10px;
            cursor: pointer;
        }
        
        .results-panel {
            background-color: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-top: 30px;
            text-align: center;
        }
        
        .results-panel h3 {
            margin-bottom: 20px;
            color: #182848;
        }
        
        .score {
            font-size: 2.5rem;
            font-weight: bold;
            color: #4b6cb7;
            margin: 20px 0;
        }
        
        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-weight: 500;
        }
        
        .feedback.good {
            background-color: #d4edda;
            color: #155724;
            border-left: 5px solid #28a745;
        }
        
        .feedback.average {
            background-color: #fff3cd;
            color: #856404;
            border-left: 5px solid #ffc107;
        }
        
        .feedback.poor {
            background-color: #f8d7da;
            color: #721c24;
            border-left: 5px solid #dc3545;
        }
        
        .coaching-area {
            background-color: #e8f4fc;
            padding: 20px;
            border-radius: 10px;
            margin-top: 25px;
            border-left: 5px solid #3498db;
        }
        
        .coaching-area h4 {
            color: #182848;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .coaching-area p {
            margin-bottom: 15px;
        }
        
        .coaching-tip {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-style: italic;
            border-left: 4px solid #9b59b6;
        }
        
        .submit-btn {
            display: block;
            margin: 30px auto;
            padding: 15px 40px;
            background-color: #4b6cb7;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .submit-btn:hover {
            background-color: #3a56a4;
            transform: scale(1.05);
        }
        
        .submit-btn:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }
        
        .footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .member-btn {
                width: 100%;
                justify-content: center;
            }
            
            .options {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .admin-btn {
                position: relative;
                top: 0;
                right: 0;
                margin-bottom: 20px;
            }
            
            .admin-stats {
                grid-template-columns: 1fr;
            }
            
            .results-table {
                font-size: 0.9rem;
            }
            
            .results-table th, .results-table td {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-book-open"></i> Devoirs de Français - Famille Singa</h1>
        <p>Thème : Le participe passé et les terminaisons verbales<br>Distinguer participe passé / infinitif / imparfait / conditionnel - Maîtriser les accords du participe passé</p>
        <button class="admin-btn" id="admin-panel-btn">
            <i class="fas fa-lock"></i> Accès Admin
        </button>
    </div>
    
    <!-- Admin Panel -->
    <div class="admin-panel" id="admin-panel">
        <div class="admin-header">
            <i class="fas fa-chart-bar fa-2x"></i>
            <h2>Tableau de Bord Administrateur</h2>
        </div>
        
        <div id="auth-form" class="auth-form">
            <h2><i class="fas fa-user-shield"></i> Connexion Admin</h2>
            <input type="password" id="admin-password" placeholder="Mot de passe admin" autocomplete="off">
            <button id="admin-login-btn">Se connecter</button>
            <div id="auth-message" class="auth-message"></div>
        </div>
        
        <div id="admin-content" style="display: none;">
            <div class="admin-stats">
                <div class="stat-card">
                    <h3>Total Participants</h3>
                    <div class="stat-value" id="total-participants">0</div>
                </div>
                <div class="stat-card">
                    <h3>Moyenne Générale</h3>
                    <div class="stat-value" id="average-score">0%</div>
                </div>
                <div class="stat-card">
                    <h3>Meilleur Score</h3>
                    <div class="stat-value" id="best-score">0/30</div>
                </div>
                <div class="stat-card">
                    <h3>Dernière Activité</h3>
                    <div class="stat-value" id="last-activity">--</div>
                </div>
            </div>
            
            <h3><i class="fas fa-table"></i> Résultats Détailés</h3>
            <table class="results-table">
                <thead>
                    <tr>
                        <th>Participant</th>
                        <th>Score</th>
                        <th>Pourcentage</th>
                        <th>Date</th>
                        <th>Statut</th>
                    </tr>
                </thead>
                <tbody id="results-table-body">
                    <!-- Results will be populated here -->
                </tbody>
            </table>
            
            <button class="export-btn" id="export-btn">
                <i class="fas fa-download"></i> Exporter les Résultats
            </button>
        </div>
    </div>
    
    <div class="family-members">
        <button class="member-btn" id="aubaine-btn">
            <i class="fas fa-user-graduate"></i> Aubaine
        </button>
        
        <button class="member-btn" id="moise-btn">
            <i class="fas fa-user-graduate"></i> Moïse
        </button>
        
        <button class="member-btn" id="credo-btn">
            <i class="fas fa-user-graduate"></i> Credo
        </button>
    </div>
    
    <div class="instructions">
        <h3><i class="fas fa-info-circle"></i> Instructions</h3>
        <ul>
            <li>Chaque membre de la famille a accès à ses propres devoirs de français.</li>
            <li><strong>Aubaine et Moïse</strong> : Complétez les phrases en choisissant la bonne réponse.</li>
            <li><strong>Credo</strong> : En plus de compléter les phrases, vous devez aussi jouer le rôle de coach et valider les réponses. Vous aurez accès à des conseils pédagogiques et verrez les résultats finaux.</li>
            <li>Cliquez sur votre nom pour commencer votre devoir.</li>
            <li><strong>Les résultats sont automatiquement sauvegardés dans la base de données.</strong></li>
        </ul>
    </div>
    
    <!-- Aubaine's Content -->
    <div id="aubaine-content" class="content-area">
        <div class="content-header">
            <h2>Devoir d'Aubaine</h2>
            <p class="member-role">Complète les phrases avec la forme correcte du verbe</p>
        </div>
        
        <div class="questions-container" id="aubaine-questions">
            <!-- Questions will be inserted here by JavaScript -->
        </div>
        
        <button class="submit-btn" id="aubaine-submit">Soumettre mes réponses</button>
        
        <div class="results-panel" id="aubaine-results" style="display: none;">
            <h3>Résultats d'Aubaine</h3>
            <div class="score">Score: <span id="aubaine-score">0</span>/30</div>
            <div class="feedback" id="aubaine-feedback"></div>
            <p><i class="fas fa-database"></i> Résultats sauvegardés dans la base de données</p>
        </div>
    </div>
    
    <!-- Moïse's Content -->
    <div id="moise-content" class="content-area">
        <div class="content-header">
            <h2>Devoir de Moïse</h2>
            <p class="member-role">Complète les phrases avec la forme correcte du verbe</p>
        </div>
        
        <div class="questions-container" id="moise-questions">
            <!-- Questions will be inserted here by JavaScript -->
        </div>
        
        <button class="submit-btn" id="moise-submit">Soumettre mes réponses</button>
        
        <div class="results-panel" id="moise-results" style="display: none;">
            <h3>Résultats de Moïse</h3>
            <div class="score">Score: <span id="moise-score">0</span>/30</div>
            <div class="feedback" id="moise-feedback"></div>
            <p><i class="fas fa-database"></i> Résultats sauvegardés dans la base de données</p>
        </div>
    </div>
    
    <!-- Credo's Content -->
    <div id="credo-content" class="content-area">
        <div class="content-header">
            <h2>Devoir de Credo</h2>
            <p class="member-role">Complète les phrases et valide les réponses en tant que coach</p>
        </div>
        
        <div class="coaching-area">
            <h4><i class="fas fa-chalkboard-teacher"></i> Rôle du Coach</h4>
            <p>En tant que coach, vous devez non seulement répondre aux questions, mais aussi comprendre les règles derrière chaque réponse.</p>
            <p>Pour chaque question, nous vous fournirons un conseil pédagogique pour vous aider à expliquer la bonne réponse.</p>
            
            <div class="coaching-tip">
                <strong>Conseil du jour :</strong> Pour accorder le participe passé avec l'auxiliaire "avoir", regardez le complément d'objet direct (COD) s'il est placé avant le verbe. Si le COD est placé avant, le participe passé s'accorde en genre et en nombre avec ce COD.
            </div>
        </div>
        
        <div class="questions-container" id="credo-questions">
            <!-- Questions will be inserted here by JavaScript -->
        </div>
        
        <button class="submit-btn" id="credo-submit">Soumettre et voir les résultats finaux</button>
        
        <div class="results-panel" id="credo-results" style="display: none;">
            <h3>Résultats Finaux de Credo (Coach)</h3>
            <div class="score">Score: <span id="credo-score">0</span>/30</div>
            <div class="feedback" id="credo-feedback"></div>
            <p><i class="fas fa-database"></i> Résultats sauvegardés dans la base de données</p>
            
            <div class="coaching-tip" style="margin-top: 20px;">
                <strong>Rappel pédagogique :</strong> Les terminaisons -é, -ée, -és, -ées correspondent au participe passé. La terminaison -er correspond à l'infinitif. Les terminaisons -ait, -aient correspondent à l'imparfait. Les terminaisons -era, -erait correspondent au futur et conditionnel.
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>Devoirs de français - Famille Singa © 2023 | Thème : Participe passé et terminaisons verbales</p>
        <p>Objectif : Distinguer -é / -er / -ait / -aient / -és / -ée / -ées / -era / -erait</p>
        <p>Système de suivi administrateur activé - Tous les résultats sont sauvegardés</p>
    </div>

    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAUYpCBlPUnnsCyvqrfMmY5uacjHLGVRh0",
            authDomain: "match-a2ac6.firebaseapp.com",
            projectId: "match-a2ac6",
            storageBucket: "match-a2ac6.firebasestorage.app",
            messagingSenderId: "376894292796",
            appId: "1:376894292796:web:1eb138830c92aae8df5439",
            measurementId: "G-2RSRSSFCDZ"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Admin credentials
        const ADMIN_PASSWORD = "legende360@";
        const ADMIN_EMAIL = "admin@familiesinga.com";

        // Questions data
        const questions = [
            {
                question: "Il a ______ son sac sur la table.",
                options: ["posé", "poser", "posait", "posera"],
                correct: 0,
                explanation: "On utilise le participe passé 'posé' avec l'auxiliaire 'a' pour former le passé composé."
            },
            {
                question: "Les lettres qu'elle a ______ étaient très touchantes.",
                options: ["écrire", "écrites", "écrite", "écrivait"],
                correct: 1,
                explanation: "'écrites' s'accorde avec 'lettres' (féminin pluriel) car le COD ('lettres') est placé avant le verbe."
            },
            {
                question: "Nous avons ______ toute la journée.",
                options: ["marcher", "marché", "marchait", "marchera"],
                correct: 1,
                explanation: "On utilise le participe passé 'marché' avec l'auxiliaire 'avons' pour former le passé composé."
            },
            {
                question: "La chanson que j'ai ______ hier était magnifique.",
                options: ["écouter", "écoutée", "écouté", "écoutait"],
                correct: 1,
                explanation: "'écoutée' s'accorde avec 'chanson' (féminin singulier) car le COD ('chanson') est placé avant le verbe."
            },
            {
                question: "Les enfants ont ______ trop tard.",
                options: ["arriver", "arrivés", "arrivé", "arrivaient"],
                correct: 1,
                explanation: "'arrivés' s'accorde avec 'enfants' (masculin pluriel) car le sujet ('enfants') fait l'action avec l'auxiliaire 'avoir'."
            },
            {
                question: "Elle s'est ______ les mains avant de manger.",
                options: ["laver", "lavée", "lavées", "lavait"],
                correct: 2,
                explanation: "'lavées' s'accorde avec 'mains' (féminin pluriel) car le COD ('mains') est placé après le verbe dans ce cas avec 'se'."
            },
            {
                question: "Ils avaient ______ le travail avant la nuit.",
                options: ["terminer", "terminé", "terminaient", "termina"],
                correct: 1,
                explanation: "On utilise le participe passé 'terminé' avec l'auxiliaire 'avaient' pour former le plus-que-parfait."
            },
            {
                question: "La robe qu'elle a ______ hier est très belle.",
                options: ["acheter", "achetée", "acheté", "achetait"],
                correct: 1,
                explanation: "'achetée' s'accorde avec 'robe' (féminin singulier) car le COD ('robe') est placé avant le verbe."
            },
            {
                question: "Il ______ partir plus tôt, mais il a oublié.",
                options: ["a", "est", "avait", "aurait"],
                correct: 2,
                explanation: "On utilise l'imparfait 'avait' pour exprimer une action dans le passé qui était en cours ou une habitude."
            },
            {
                question: "Les histoires que nous avons ______ sont vraies.",
                options: ["raconter", "raconté", "racontées", "racontait"],
                correct: 2,
                explanation: "'racontées' s'accorde avec 'histoires' (féminin pluriel) car le COD ('histoires') est placé avant le verbe."
            },
            {
                question: "Elle a ______ ses erreurs.",
                options: ["corriger", "corrigé", "corrigée", "corrigeait"],
                correct: 1,
                explanation: "On utilise le participe passé 'corrigé' avec l'auxiliaire 'a' pour former le passé composé."
            },
            {
                question: "Les fleurs qu'il a ______ sont fanées.",
                options: ["cueillir", "cueilli", "cueillies", "cueillait"],
                correct: 2,
                explanation: "'cueillies' s'accorde avec 'fleurs' (féminin pluriel) car le COD ('fleurs') est placé avant le verbe."
            },
            {
                question: "Tu aurais ______ me prévenir.",
                options: ["dû", "du", "devoir", "dues"],
                correct: 0,
                explanation: "On utilise le participe passé 'dû' (de devoir) avec l'auxiliaire 'aurais' pour former le conditionnel passé."
            },
            {
                question: "La leçon qu'ils ont ______ était difficile.",
                options: ["apprendre", "appris", "apprise", "apprenaient"],
                correct: 2,
                explanation: "'apprise' s'accorde avec 'leçon' (féminin singulier) car le COD ('leçon') est placé avant le verbe."
            },
            {
                question: "Elle s'est ______ tard cette nuit.",
                options: ["coucher", "couchée", "couché", "couchait"],
                correct: 1,
                explanation: "'couchée' s'accorde avec 'elle' (féminin singulier) car le verbe est pronominal et le sujet fait l'action sur lui-même."
            },
            {
                question: "Les efforts qu'elle a ______ ont porté leurs fruits.",
                options: ["faire", "faits", "faites", "faisait"],
                correct: 1,
                explanation: "'faits' s'accorde avec 'efforts' (masculin pluriel) car le COD ('efforts') est placé avant le verbe."
            },
            {
                question: "Il a ______ son erreur.",
                options: ["reconnaître", "reconnu", "reconnue", "reconnaissait"],
                correct: 1,
                explanation: "On utilise le participe passé 'reconnu' avec l'auxiliaire 'a' pour former le passé composé."
            },
            {
                question: "Les décisions que nous avons ______ étaient justes.",
                options: ["prendre", "pris", "prises", "prenaient"],
                correct: 2,
                explanation: "'prises' s'accorde avec 'décisions' (féminin pluriel) car le COD ('décisions') est placé avant le verbe."
            },
            {
                question: "Elle aurait ______ venir plus tôt.",
                options: ["pu", "pue", "pouvoir", "pouvait"],
                correct: 0,
                explanation: "On utilise le participe passé 'pu' (de pouvoir) avec l'auxiliaire 'aurait' pour former le conditionnel passé."
            },
            {
                question: "Les films qu'ils ont ______ sont intéressants.",
                options: ["voir", "vus", "vue", "voyaient"],
                correct: 1,
                explanation: "'vus' s'accorde avec 'films' (masculin pluriel) car le COD ('films') est placé avant le verbe."
            },
            {
                question: "Il est ______ trop tard.",
                options: ["arriver", "arrivé", "arrivait", "arrivera"],
                correct: 1,
                explanation: "On utilise le participe passé 'arrivé' avec l'auxiliaire 'est' pour former le passé composé des verbes de mouvement."
            },
            {
                question: "Les promesses qu'elle a ______ n'ont pas été tenues.",
                options: ["faire", "fait", "faites", "faisait"],
                correct: 2,
                explanation: "'faites' s'accorde avec 'promesses' (féminin pluriel) car le COD ('promesses') est placé avant le verbe."
            },
            {
                question: "Elle a ______ une lettre à sa mère.",
                options: ["écrit", "écrite", "écrire", "écrivait"],
                correct: 0,
                explanation: "On utilise le participe passé 'écrit' avec l'auxiliaire 'a' pour former le passé composé."
            },
            {
                question: "Les valises qu'ils ont ______ étaient lourdes.",
                options: ["porter", "porté", "portées", "portaient"],
                correct: 2,
                explanation: "'portées' s'accorde avec 'valises' (féminin pluriel) car le COD ('valises') est placé avant le verbe."
            },
            {
                question: "Il aurait ______ gagner le match.",
                options: ["pu", "peut", "pue", "pouvoir"],
                correct: 0,
                explanation: "On utilise le participe passé 'pu' (de pouvoir) avec l'auxiliaire 'aurait' pour former le conditionnel passé."
            },
            {
                question: "Les fautes que tu as ______ doivent être corrigées.",
                options: ["faire", "fait", "faites", "faisait"],
                correct: 2,
                explanation: "'faites' s'accorde avec 'fautes' (féminin pluriel) car le COD ('fautes') est placé avant le verbe."
            },
            {
                question: "Elle s'est ______ parler sévèrement.",
                options: ["faire", "faite", "fait", "faisait"],
                correct: 2,
                explanation: "On utilise 'fait' car avec 'se faire + infinitif', le participe passé reste invariable."
            },
            {
                question: "Les chansons que nous avons ______ hier plaisent beaucoup.",
                options: ["chanter", "chanté", "chantées", "chantaient"],
                correct: 2,
                explanation: "'chantées' s'accorde avec 'chansons' (féminin pluriel) car le COD ('chansons') est placé avant le verbe."
            },
            {
                question: "Il a ______ trop vite.",
                options: ["répondre", "répondu", "répondait", "répondit"],
                correct: 1,
                explanation: "On utilise le participe passé 'répondu' avec l'auxiliaire 'a' pour former le passé composé."
            },
            {
                question: "Les règles que vous avez ______ sont importantes.",
                options: ["suivre", "suivi", "suivies", "suivaient"],
                correct: 2,
                explanation: "'suivies' s'accorde avec 'règles' (féminin pluriel) car le COD ('règles') est placé avant le verbe."
            }
        ];

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Create questions for each family member
            createQuestions('aubaine');
            createQuestions('moise');
            createQuestions('credo');
            
            // Set up button click events
            document.getElementById('aubaine-btn').addEventListener('click', () => showContent('aubaine'));
            document.getElementById('moise-btn').addEventListener('click', () => showContent('moise'));
            document.getElementById('credo-btn').addEventListener('click', () => showContent('credo'));
            
            // Set up submit button events
            document.getElementById('aubaine-submit').addEventListener('click', () => submitAnswers('aubaine'));
            document.getElementById('moise-submit').addEventListener('click', () => submitAnswers('moise'));
            document.getElementById('credo-submit').addEventListener('click', () => submitAnswers('credo'));
            
            // Admin panel events
            document.getElementById('admin-panel-btn').addEventListener('click', toggleAdminPanel);
            document.getElementById('admin-login-btn').addEventListener('click', adminLogin);
            document.getElementById('export-btn').addEventListener('click', exportResults);
            
            // Show Aubaine's content by default
            showContent('aubaine');
            
            // Check if admin is already logged in
            checkAdminAuth();
        });
        
        function createQuestions(member) {
            const container = document.getElementById(`${member}-questions`);
            container.innerHTML = '';
            
            questions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                
                let optionsHtml = '';
                q.options.forEach((option, optIndex) => {
                    optionsHtml += `
                        <div class="option" data-index="${optIndex}">
                            <input type="radio" name="${member}-q${index}" id="${member}-q${index}-opt${optIndex}" value="${optIndex}">
                            <label for="${member}-q${index}-opt${optIndex}">${option}</label>
                        </div>
                    `;
                });
                
                // Add coaching tip only for Credo
                const coachingTip = member === 'credo' ? 
                    `<div class="coaching-tip" style="margin-top: 15px; font-size: 0.9rem;">
                        <strong>Conseil :</strong> ${q.explanation}
                    </div>` : '';
                
                questionDiv.innerHTML = `
                    <div class="question-text">
                        <span class="question-number">${index + 1}</span>
                        ${q.question}
                    </div>
                    <div class="options">
                        ${optionsHtml}
                    </div>
                    ${coachingTip}
                `;
                
                container.appendChild(questionDiv);
            });
            
            // Add click events to options
            container.querySelectorAll('.option').forEach(option => {
                option.addEventListener('click', function() {
                    const questionDiv = this.closest('.question');
                    const options = questionDiv.querySelectorAll('.option');
                    const input = this.querySelector('input');
                    
                    // Deselect all options in this question
                    options.forEach(opt => {
                        opt.classList.remove('selected');
                        opt.querySelector('input').checked = false;
                    });
                    
                    // Select clicked option
                    this.classList.add('selected');
                    input.checked = true;
                });
            });
        }
        
        function showContent(member) {
            // Hide all content areas
            document.querySelectorAll('.content-area').forEach(area => {
                area.classList.remove('active-content');
            });
            
            // Show selected member's content
            document.getElementById(`${member}-content`).classList.add('active-content');
            
            // Reset button styles
            document.querySelectorAll('.member-btn').forEach(btn => {
                btn.style.transform = 'translateY(0)';
                btn.style.boxShadow = '0 5px 15px rgba(0, 0, 0, 0.1)';
            });
            
            // Highlight selected button
            const selectedBtn = document.getElementById(`${member}-btn`);
            selectedBtn.style.transform = 'translateY(-5px)';
            selectedBtn.style.boxShadow = '0 10px 20px rgba(0, 0, 0, 0.15)';
            
            // Hide results when switching members
            document.querySelectorAll('.results-panel').forEach(panel => {
                panel.style.display = 'none';
            });
        }
        
        async function submitAnswers(member) {
            let score = 0;
            const totalQuestions = questions.length;
            let answers = [];
            
            // Check each question
            for (let i = 0; i < totalQuestions; i++) {
                const selectedOption = document.querySelector(`input[name="${member}-q${i}"]:checked`);
                const selectedValue = selectedOption ? parseInt(selectedOption.value) : null;
                const isCorrect = selectedValue === questions[i].correct;
                
                if (isCorrect) {
                    score++;
                }
                
                answers.push({
                    question: questions[i].question,
                    selected: selectedValue,
                    correct: questions[i].correct,
                    isCorrect: isCorrect
                });
                
                // Show correct/incorrect for Credo
                if (member === 'credo') {
                    const questionDiv = document.getElementById(`${member}-questions`).children[i];
                    const options = questionDiv.querySelectorAll('.option');
                    
                    options.forEach((option, index) => {
                        option.classList.remove('correct', 'incorrect');
                        
                        if (index === questions[i].correct) {
                            option.classList.add('correct');
                        } else if (index === selectedValue && selectedValue !== questions[i].correct) {
                            option.classList.add('incorrect');
                        }
                    });
                }
            }
            
            // Save results to Firebase
            await saveResultsToFirebase(member, score, answers);
            
            // Display results
            const resultsPanel = document.getElementById(`${member}-results`);
            const scoreElement = document.getElementById(`${member}-score`);
            const feedbackElement = document.getElementById(`${member}-feedback`);
            
            scoreElement.textContent = `${score}/${totalQuestions}`;
            
            // Calculate percentage
            const percentage = (score / totalQuestions) * 100;
            
            // Provide feedback based on score
            let feedback = '';
            let feedbackClass = '';
            
            if (percentage >= 80) {
                feedback = `Excellent travail ! Tu as bien maîtrisé les accords du participe passé.`;
                feedbackClass = 'good';
            } else if (percentage >= 60) {
                feedback = `Bon travail ! Tu as compris la majorité des règles, mais il reste quelques points à revoir.`;
                feedbackClass = 'average';
            } else {
                feedback = `Continue à t'entraîner ! N'oublie pas que le participe passé s'accorde avec le COD quand il est placé avant le verbe.`;
                feedbackClass = 'poor';
            }
            
            // Add additional feedback for Credo
            if (member === 'credo') {
                feedback += ` En tant que coach, tu peux maintenant expliquer ces règles à tes frères et sœurs.`;
                
                if (percentage >= 80) {
                    feedback += ` Tu es prêt à les coacher efficacement !`;
                } else if (percentage >= 60) {
                    feedback += ` Revois les questions que tu as ratées pour mieux expliquer les règles.`;
                } else {
                    feedback += ` Étudie bien les explications avant de coacher les autres.`;
                }
            }
            
            feedbackElement.textContent = feedback;
            feedbackElement.className = `feedback ${feedbackClass}`;
            
            // Show results panel
            resultsPanel.style.display = 'block';
            
            // Scroll to results
            resultsPanel.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        async function saveResultsToFirebase(member, score, answers) {
            try {
                const resultData = {
                    member: member,
                    score: score,
                    totalQuestions: questions.length,
                    percentage: Math.round((score / questions.length) * 100),
                    answers: answers,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    date: new Date().toISOString()
                };
                
                await db.collection('results').add(resultData);
                console.log(`Résultats sauvegardés pour ${member}`);
            } catch (error) {
                console.error("Erreur lors de la sauvegarde des résultats:", error);
            }
        }
        
        function toggleAdminPanel() {
            const adminPanel = document.getElementById('admin-panel');
            adminPanel.classList.toggle('active');
        }
        
        function checkAdminAuth() {
            auth.onAuthStateChanged((user) => {
                if (user && user.email === ADMIN_EMAIL) {
                    showAdminContent();
                } else {
                    hideAdminContent();
                }
            });
        }
        
        async function adminLogin() {
            const password = document.getElementById('admin-password').value;
            const messageDiv = document.getElementById('auth-message');
            
            if (password === ADMIN_PASSWORD) {
                try {
                    // Create user with email and password
                    await auth.createUserWithEmailAndPassword(ADMIN_EMAIL, ADMIN_PASSWORD);
                    messageDiv.textContent = "Connexion réussie !";
                    messageDiv.className = "auth-message success";
                    showAdminContent();
                    loadResults();
                } catch (error) {
                    if (error.code === 'auth/email-already-in-use') {
                        // User already exists, try to sign in
                        try {
                            await auth.signInWithEmailAndPassword(ADMIN_EMAIL, ADMIN_PASSWORD);
                            messageDiv.textContent = "Connexion réussie !";
                            messageDiv.className = "auth-message success";
                            showAdminContent();
                            loadResults();
                        } catch (signInError) {
                            messageDiv.textContent = "Erreur de connexion. Vérifiez le mot de passe.";
                            messageDiv.className = "auth-message error";
                        }
                    } else {
                        messageDiv.textContent = "Erreur de connexion.";
                        messageDiv.className = "auth-message error";
                    }
                }
            } else {
                messageDiv.textContent = "Mot de passe incorrect.";
                messageDiv.className = "auth-message error";
            }
        }
        
        function showAdminContent() {
            document.getElementById('auth-form').style.display = 'none';
            document.getElementById('admin-content').style.display = 'block';
        }
        
        function hideAdminContent() {
            document.getElementById('auth-form').style.display = 'block';
            document.getElementById('admin-content').style.display = 'none';
        }
        
        async function loadResults() {
            try {
                const snapshot = await db.collection('results')
                    .orderBy('timestamp', 'desc')
                    .get();
                
                const results = [];
                let totalScore = 0;
                let bestScore = 0;
                let lastActivity = null;
                const members = new Set();
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    results.push(data);
                    
                    totalScore += data.percentage;
                    bestScore = Math.max(bestScore, data.score);
                    members.add(data.member);
                    
                    if (!lastActivity || data.timestamp > lastActivity) {
                        lastActivity = data.timestamp;
                    }
                });
                
                // Update statistics
                document.getElementById('total-participants').textContent = members.size;
                document.getElementById('average-score').textContent = results.length > 0 ? 
                    Math.round(totalScore / results.length) + '%' : '0%';
                document.getElementById('best-score').textContent = bestScore + '/30';
                document.getElementById('last-activity').textContent = lastActivity ? 
                    new Date(lastActivity.toDate()).toLocaleDateString('fr-FR') : '--';
                
                // Update results table
                const tableBody = document.getElementById('results-table-body');
                tableBody.innerHTML = '';
                
                results.forEach((result, index) => {
                    const row = document.createElement('tr');
                    const date = result.timestamp ? 
                        new Date(result.timestamp.toDate()).toLocaleString('fr-FR') : 
                        new Date(result.date).toLocaleString('fr-FR');
                    
                    let statusClass = '';
                    if (result.percentage >= 80) {
                        statusClass = 'Excellent';
                    } else if (result.percentage >= 60) {
                        statusClass = 'Bon';
                    } else {
                        statusClass = 'À revoir';
                    }
                    
                    row.innerHTML = `
                        <td>${result.member.charAt(0).toUpperCase() + result.member.slice(1)}</td>
                        <td>${result.score}/${result.totalQuestions}</td>
                        <td>${result.percentage}%</td>
                        <td>${date}</td>
                        <td>${statusClass}</td>
                    `;
                    tableBody.appendChild(row);
                });
                
            } catch (error) {
                console.error("Erreur lors du chargement des résultats:", error);
            }
        }
        
        function exportResults() {
            const table = document.getElementById('results-table-body');
            let csv = "Participant,Score,Pourcentage,Date,Statut\n";
            
            Array.from(table.rows).forEach(row => {
                const cells = row.cells;
                const rowData = Array.from(cells).map(cell => cell.textContent);
                csv += rowData.join(",") + "\n";
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'resultats_famille_singa.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>