<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Devoirs de Français - Famille Singa</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Import Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
            color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .family-members {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .member-btn {
            padding: 18px 30px;
            font-size: 1.3rem;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .member-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        
        .member-btn i {
            font-size: 1.5rem;
        }
        
        #aubaine-btn {
            background-color: #3498db;
            color: white;
        }
        
        #moise-btn {
            background-color: #2ecc71;
            color: white;
        }
        
        #credo-btn {
            background-color: #9b59b6;
            color: white;
        }
        
        #admin-btn {
            background-color: #e74c3c;
            color: white;
        }
        
        .instructions {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-left: 5px solid #4b6cb7;
        }
        
        .instructions h3 {
            color: #182848;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .instructions ul {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 10px;
        }
        
        .content-area {
            display: none;
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            margin-top: 20px;
        }
        
        .active-content {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .content-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .content-header h2 {
            color: #182848;
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .content-header .member-role {
            font-size: 1.1rem;
            color: #4b6cb7;
            font-weight: 600;
        }
        
        .questions-container {
            margin-bottom: 30px;
        }
        
        .question {
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 1px dashed #e0e0e0;
        }
        
        .question:last-child {
            border-bottom: none;
        }
        
        .question-number {
            display: inline-block;
            background-color: #4b6cb7;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            text-align: center;
            line-height: 32px;
            margin-right: 10px;
            font-weight: bold;
        }
        
        .question-text {
            font-size: 1.1rem;
            margin-bottom: 15px;
            font-weight: 500;
        }
        
        .options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .option {
            padding: 12px 15px;
            background-color: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
        }
        
        .option:hover {
            background-color: #e9ecef;
        }
        
        .option.selected {
            background-color: #d1ecf1;
            border-color: #3498db;
            color: #0c5460;
        }
        
        .option.correct {
            background-color: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        
        .option.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
        
        .option input {
            margin-right: 10px;
            cursor: pointer;
        }
        
        .results-panel {
            background-color: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-top: 30px;
            text-align: center;
        }
        
        .results-panel h3 {
            margin-bottom: 20px;
            color: #182848;
        }
        
        .score {
            font-size: 2.5rem;
            font-weight: bold;
            color: #4b6cb7;
            margin: 20px 0;
        }
        
        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-weight: 500;
        }
        
        .feedback.good {
            background-color: #d4edda;
            color: #155724;
            border-left: 5px solid #28a745;
        }
        
        .feedback.average {
            background-color: #fff3cd;
            color: #856404;
            border-left: 5px solid #ffc107;
        }
        
        .feedback.poor {
            background-color: #f8d7da;
            color: #721c24;
            border-left: 5px solid #dc3545;
        }
        
        .coaching-area {
            background-color: #e8f4fc;
            padding: 20px;
            border-radius: 10px;
            margin-top: 25px;
            border-left: 5px solid #3498db;
        }
        
        .coaching-area h4 {
            color: #182848;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .coaching-area p {
            margin-bottom: 15px;
        }
        
        .coaching-tip {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-style: italic;
            border-left: 4px solid #9b59b6;
        }
        
        .submit-btn {
            display: block;
            margin: 30px auto;
            padding: 15px 40px;
            background-color: #4b6cb7;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .submit-btn:hover {
            background-color: #3a56a4;
            transform: scale(1.05);
        }
        
        .submit-btn:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Admin Panel Styles */
        .admin-panel {
            background-color: #2c3e50;
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .admin-panel h3 {
            color: white;
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background-color: #34495e;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-card h4 {
            margin-bottom: 10px;
            color: #ecf0f1;
            font-size: 1rem;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #3498db;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
            color: #333;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .results-table th {
            background-color: #3498db;
            color: white;
            padding: 15px;
            text-align: left;
        }
        
        .results-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .results-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .results-table tr:hover {
            background-color: #e8f4fc;
        }
        
        .date-cell {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .score-cell {
            font-weight: bold;
            text-align: center;
        }
        
        .score-cell.high {
            color: #27ae60;
        }
        
        .score-cell.medium {
            color: #f39c12;
        }
        
        .score-cell.low {
            color: #e74c3c;
        }
        
        .refresh-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .refresh-btn:hover {
            background-color: #2980b9;
        }
        
        .footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .member-btn {
                width: 100%;
                justify-content: center;
            }
            
            .options {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .results-table {
                font-size: 0.9rem;
            }
            
            .results-table th,
            .results-table td {
                padding: 8px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-book-open"></i> Devoirs de Français - Famille Singa</h1>
        <p>Thème : Le participe passé et les terminaisons verbales<br>Distinguer participe passé / infinitif / imparfait / conditionnel - Maîtriser les accords du participe passé</p>
    </div>
    
    <div class="family-members">
        <button class="member-btn" id="aubaine-btn">
            <i class="fas fa-user-graduate"></i> Aubaine
        </button>
        
        <button class="member-btn" id="moise-btn">
            <i class="fas fa-user-graduate"></i> Moïse
        </button>
        
        <button class="member-btn" id="credo-btn">
            <i class="fas fa-user-graduate"></i> Credo
        </button>
        
        <button class="member-btn" id="admin-btn">
            <i class="fas fa-user-shield"></i> Administration
        </button>
    </div>
    
    <div class="instructions">
        <h3><i class="fas fa-info-circle"></i> Instructions</h3>
        <ul>
            <li>Chaque membre de la famille a accès à ses propres devoirs de français.</li>
            <li><strong>Aubaine et Moïse</strong> : Complétez les phrases en choisissant la bonne réponse.</li>
            <li><strong>Credo</strong> : En plus de compléter les phrases, vous devez aussi jouer le rôle de coach et valider les réponses. Vous aurez accès à des conseils pédagogiques et verrez les résultats finaux.</li>
            <li><strong>Administration</strong> : Pour voir les résultats de tous les membres et suivre leur progression.</li>
            <li>Cliquez sur votre nom pour commencer votre devoir.</li>
        </ul>
    </div>
    
    <!-- Admin Panel -->
    <div id="admin-content" class="content-area">
        <div class="content-header">
            <h2>Panneau d'Administration</h2>
            <p class="member-role">Suivi des résultats et progression des membres</p>
        </div>
        
        <div class="admin-panel">
            <h3><i class="fas fa-chart-line"></i> Tableau de bord des résultats</h3>
            
            <div class="stats-grid" id="admin-stats">
                <div class="stat-card">
                    <h4>Chargement des données...</h4>
                    <div class="stat-value">0</div>
                </div>
            </div>
            
            <button class="refresh-btn" id="refresh-results">
                <i class="fas fa-sync-alt"></i> Actualiser les résultats
            </button>
            
            <div style="overflow-x: auto; margin-top: 30px;">
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Date</th>
                            <th>Score</th>
                            <th>Pourcentage</th>
                            <th>Détails</th>
                        </tr>
                    </thead>
                    <tbody id="results-table-body">
                        <tr>
                            <td colspan="5" style="text-align: center;">Chargement des données...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Aubaine's Content -->
    <div id="aubaine-content" class="content-area">
        <div class="content-header">
            <h2>Devoir d'Aubaine</h2>
            <p class="member-role">Complète les phrases avec la forme correcte du verbe</p>
        </div>
        
        <div class="questions-container" id="aubaine-questions">
            <!-- Questions will be inserted here by JavaScript -->
        </div>
        
        <button class="submit-btn" id="aubaine-submit">Soumettre mes réponses</button>
        
        <div class="results-panel" id="aubaine-results" style="display: none;">
            <h3>Résultats d'Aubaine</h3>
            <div class="score">Score: <span id="aubaine-score">0</span>/30</div>
            <div class="feedback" id="aubaine-feedback"></div>
            <p style="margin-top: 15px; font-size: 0.9rem; color: #7f8c8d;">
                <i class="fas fa-database"></i> Vos résultats ont été enregistrés dans la base de données.
            </p>
        </div>
    </div>
    
    <!-- Moïse's Content -->
    <div id="moise-content" class="content-area">
        <div class="content-header">
            <h2>Devoir de Moïse</h2>
            <p class="member-role">Complète les phrases avec la forme correcte du verbe</p>
        </div>
        
        <div class="questions-container" id="moise-questions">
            <!-- Questions will be inserted here by JavaScript -->
        </div>
        
        <button class="submit-btn" id="moise-submit">Soumettre mes réponses</button>
        
        <div class="results-panel" id="moise-results" style="display: none;">
            <h3>Résultats de Moïse</h3>
            <div class="score">Score: <span id="moise-score">0</span>/30</div>
            <div class="feedback" id="moise-feedback"></div>
            <p style="margin-top: 15px; font-size: 0.9rem; color: #7f8c8d;">
                <i class="fas fa-database"></i> Vos résultats ont été enregistrés dans la base de données.
            </p>
        </div>
    </div>
    
    <!-- Credo's Content -->
    <div id="credo-content" class="content-area">
        <div class="content-header">
            <h2>Devoir de Credo</h2>
            <p class="member-role">Complète les phrases et valide les réponses en tant que coach</p>
        </div>
        
        <div class="coaching-area">
            <h4><i class="fas fa-chalkboard-teacher"></i> Rôle du Coach</h4>
            <p>En tant que coach, vous devez non seulement répondre aux questions, mais aussi comprendre les règles derrière chaque réponse.</p>
            <p>Pour chaque question, nous vous fournirons un conseil pédagogique pour vous aider à expliquer la bonne réponse.</p>
            
            <div class="coaching-tip">
                <strong>Conseil du jour :</strong> Pour accorder le participe passé avec l'auxiliaire "avoir", regardez le complément d'objet direct (COD) s'il est placé avant le verbe. Si le COD est placé avant, le participe passé s'accorde en genre et en nombre avec ce COD.
            </div>
        </div>
        
        <div class="questions-container" id="credo-questions">
            <!-- Questions will be inserted here by JavaScript -->
        </div>
        
        <button class="submit-btn" id="credo-submit">Soumettre et voir les résultats finaux</button>
        
        <div class="results-panel" id="credo-results" style="display: none;">
            <h3>Résultats Finaux de Credo (Coach)</h3>
            <div class="score">Score: <span id="credo-score">0</span>/30</div>
            <div class="feedback" id="credo-feedback"></div>
            <p style="margin-top: 15px; font-size: 0.9rem; color: #7f8c8d;">
                <i class="fas fa-database"></i> Vos résultats ont été enregistrés dans la base de données.
            </p>
            
            <div class="coaching-tip" style="margin-top: 20px;">
                <strong>Rappel pédagogique :</strong> Les terminaisons -é, -ée, -és, -ées correspondent au participe passé. La terminaison -er correspond à l'infinitif. Les terminaisons -ait, -aient correspondent à l'imparfait. Les terminaisons -era, -erait correspondent au futur et conditionnel.
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>Devoirs de français - Famille Singa © 2023 | Thème : Participe passé et terminaisons verbales</p>
        <p>Objectif : Distinguer -é / -er / -ait / -aient / -és / -ée / -ées / -era / -erait</p>
    </div>

    <script>
        // Configuration Firebase (pour Firestore)
        const firebaseConfig = {
            apiKey: "AIzaSyAUYpCBlPUnnsCyvqrfMmY5uacjHLGVRh0",
            authDomain: "match-a2ac6.firebaseapp.com",
            projectId: "match-a2ac6",
            storageBucket: "match-a2ac6.firebasestorage.app",
            messagingSenderId: "376894292796",
            appId: "1:376894292796:web:1eb138830c92aae8df5439",
            measurementId: "G-2RSRSSFCDZ"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(); // Firestore au lieu de Realtime Database

        // Questions data
        const questions = [
            {
                question: "Il a ______ son sac sur la table.",
                options: ["posé", "poser", "posait", "posera"],
                correct: 0,
                explanation: "On utilise le participe passé 'posé' avec l'auxiliaire 'a' pour former le passé composé."
            },
            {
                question: "Les lettres qu'elle a ______ étaient très touchantes.",
                options: ["écrire", "écrites", "écrite", "écrivait"],
                correct: 1,
                explanation: "'écrites' s'accorde avec 'lettres' (féminin pluriel) car le COD ('lettres') est placé avant le verbe."
            },
            {
                question: "Nous avons ______ toute la journée.",
                options: ["marcher", "marché", "marchait", "marchera"],
                correct: 1,
                explanation: "On utilise le participe passé 'marché' avec l'auxiliaire 'avons' pour former le passé composé."
            },
            {
                question: "La chanson que j'ai ______ hier était magnifique.",
                options: ["écouter", "écoutée", "écouté", "écoutait"],
                correct: 1,
                explanation: "'écoutée' s'accorde avec 'chanson' (féminin singulier) car le COD ('chanson') est placé avant le verbe."
            },
            {
                question: "Les enfants ont ______ trop tard.",
                options: ["arriver", "arrivés", "arrivé", "arrivaient"],
                correct: 1,
                explanation: "'arrivés' s'accorde avec 'enfants' (masculin pluriel) car le sujet ('enfants') fait l'action avec l'auxiliaire 'avoir'."
            },
            {
                question: "Elle s'est ______ les mains avant de manger.",
                options: ["laver", "lavée", "lavées", "lavait"],
                correct: 2,
                explanation: "'lavées' s'accorde avec 'mains' (féminin pluriel) car le COD ('mains') est placé après le verbe dans ce cas avec 'se'."
            },
            {
                question: "Ils avaient ______ le travail avant la nuit.",
                options: ["terminer", "terminé", "terminaient", "termina"],
                correct: 1,
                explanation: "On utilise le participe passé 'terminé' avec l'auxiliaire 'avaient' pour former le plus-que-parfait."
            },
            {
                question: "La robe qu'elle a ______ hier est très belle.",
                options: ["acheter", "achetée", "acheté", "achetait"],
                correct: 1,
                explanation: "'achetée' s'accorde avec 'robe' (féminin singulier) car le COD ('robe') est placé avant le verbe."
            },
            {
                question: "Il ______ partir plus tôt, mais il a oublié.",
                options: ["a", "est", "avait", "aurait"],
                correct: 2,
                explanation: "On utilise l'imparfait 'avait' pour exprimer une action dans le passé qui était en cours ou une habitude."
            },
            {
                question: "Les histoires que nous avons ______ sont vraies.",
                options: ["raconter", "raconté", "racontées", "racontait"],
                correct: 2,
                explanation: "'racontées' s'accorde avec 'histoires' (féminin pluriel) car le COD ('histoires') est placé avant le verbe."
            },
            {
                question: "Elle a ______ ses erreurs.",
                options: ["corriger", "corrigé", "corrigée", "corrigeait"],
                correct: 1,
                explanation: "On utilise le participe passé 'corrigé' avec l'auxiliaire 'a' pour former le passé composé."
            },
            {
                question: "Les fleurs qu'il a ______ sont fanées.",
                options: ["cueillir", "cueilli", "cueillies", "cueillait"],
                correct: 2,
                explanation: "'cueillies' s'accorde avec 'fleurs' (féminin pluriel) car le COD ('fleurs') est placé avant le verbe."
            },
            {
                question: "Tu aurais ______ me prévenir.",
                options: ["dû", "du", "devoir", "dues"],
                correct: 0,
                explanation: "On utilise le participe passé 'dû' (de devoir) avec l'auxiliaire 'aurais' pour former le conditionnel passé."
            },
            {
                question: "La leçon qu'ils ont ______ était difficile.",
                options: ["apprendre", "appris", "apprise", "apprenaient"],
                correct: 2,
                explanation: "'apprise' s'accorde avec 'leçon' (féminin singulier) car le COD ('leçon') est placé avant le verbe."
            },
            {
                question: "Elle s'est ______ tard cette nuit.",
                options: ["coucher", "couchée", "couché", "couchait"],
                correct: 1,
                explanation: "'couchée' s'accorde avec 'elle' (féminin singulier) car le verbe est pronominal et le sujet fait l'action sur lui-même."
            },
            {
                question: "Les efforts qu'elle a ______ ont porté leurs fruits.",
                options: ["faire", "faits", "faites", "faisait"],
                correct: 1,
                explanation: "'faits' s'accorde avec 'efforts' (masculin pluriel) car le COD ('efforts') est placé avant le verbe."
            },
            {
                question: "Il a ______ son erreur.",
                options: ["reconnaître", "reconnu", "reconnue", "reconnaissait"],
                correct: 1,
                explanation: "On utilise le participe passé 'reconnu' avec l'auxiliaire 'a' pour former le passé composé."
            },
            {
                question: "Les décisions que nous avons ______ étaient justes.",
                options: ["prendre", "pris", "prises", "prenaient"],
                correct: 2,
                explanation: "'prises' s'accorde avec 'décisions' (féminin pluriel) car le COD ('décisions') est placé avant le verbe."
            },
            {
                question: "Elle aurait ______ venir plus tôt.",
                options: ["pu", "pue", "pouvoir", "pouvait"],
                correct: 0,
                explanation: "On utilise le participe passé 'pu' (de pouvoir) avec l'auxiliaire 'aurait' pour formar le conditionnel passé."
            },
            {
                question: "Les films qu'ils ont ______ sont intéressants.",
                options: ["voir", "vus", "vue", "voyaient"],
                correct: 1,
                explanation: "'vus' s'accorde avec 'films' (masculin pluriel) car le COD ('films') est placé avant le verbe."
            },
            {
                question: "Il est ______ trop tard.",
                options: ["arriver", "arrivé", "arrivait", "arrivera"],
                correct: 1,
                explanation: "On utilise le participe passé 'arrivé' avec l'auxiliaire 'est' pour former le passé composé des verbes de mouvement."
            },
            {
                question: "Les promesses qu'elle a ______ n'ont pas été tenues.",
                options: ["faire", "fait", "faites", "faisait"],
                correct: 2,
                explanation: "'faites' s'accorde avec 'promesses' (féminin pluriel) car le COD ('promesses') est placé avant le verbe."
            },
            {
                question: "Elle a ______ une lettre à sa mère.",
                options: ["écrit", "écrite", "écrire", "écrivait"],
                correct: 0,
                explanation: "On utilise le participe passé 'écrit' avec l'auxiliaire 'a' pour former le passé composé."
            },
            {
                question: "Les valises qu'ils ont ______ étaient lourdes.",
                options: ["porter", "porté", "portées", "portaient"],
                correct: 2,
                explanation: "'portées' s'accorde avec 'valises' (féminin pluriel) car le COD ('valises') est placé avant le verbe."
            },
            {
                question: "Il aurait ______ gagner le match.",
                options: ["pu", "peut", "pue", "pouvoir"],
                correct: 0,
                explanation: "On utilise le participe passé 'pu' (de pouvoir) avec l'auxiliaire 'aurait' pour former le conditionnel passé."
            },
            {
                question: "Les fautes que tu as ______ doivent être corrigées.",
                options: ["faire", "fait", "faites", "faisait"],
                correct: 2,
                explanation: "'faites' s'accorde avec 'fautes' (féminin pluriel) car le COD ('fautes') est placé avant le verbe."
            },
            {
                question: "Elle s'est ______ parler sévèrement.",
                options: ["faire", "faite", "fait", "faisait"],
                correct: 2,
                explanation: "On utilise 'fait' car avec 'se faire + infinitif', le participe passé reste invariable."
            },
            {
                question: "Les chansons que nous avons ______ hier plaisent beaucoup.",
                options: ["chanter", "chanté", "chantées", "chantaient"],
                correct: 2,
                explanation: "'chantées' s'accorde avec 'chansons' (féminin pluriel) car le COD ('chansons') est placé avant le verbe."
            },
            {
                question: "Il a ______ trop vite.",
                options: ["répondre", "répondu", "répondait", "répondit"],
                correct: 1,
                explanation: "On utilise le participe passé 'répondu' avec l'auxiliaire 'a' pour former le passé composé."
            },
            {
                question: "Les règles que vous avez ______ sont importantes.",
                options: ["suivre", "suivi", "suivies", "suivaient"],
                correct: 2,
                explanation: "'suivies' s'accorde avec 'règles' (féminin pluriel) car le COD ('règles') est placé avant le verbe."
            }
        ];

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Create questions for each family member
            createQuestions('aubaine');
            createQuestions('moise');
            createQuestions('credo');
            
            // Set up button click events
            document.getElementById('aubaine-btn').addEventListener('click', () => showContent('aubaine'));
            document.getElementById('moise-btn').addEventListener('click', () => showContent('moise'));
            document.getElementById('credo-btn').addEventListener('click', () => showContent('credo'));
            document.getElementById('admin-btn').addEventListener('click', () => showContent('admin'));
            
            // Set up submit button events
            document.getElementById('aubaine-submit').addEventListener('click', () => submitAnswers('aubaine'));
            document.getElementById('moise-submit').addEventListener('click', () => submitAnswers('moise'));
            document.getElementById('credo-submit').addEventListener('click', () => submitAnswers('credo'));
            
            // Set up refresh button for admin panel
            document.getElementById('refresh-results').addEventListener('click', loadAllResults);
            
            // Load initial admin data
            loadAllResults();
            
            // Show Aubaine's content by default
            showContent('aubaine');
        });
        
        function createQuestions(member) {
            const container = document.getElementById(`${member}-questions`);
            container.innerHTML = '';
            
            questions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                
                let optionsHtml = '';
                q.options.forEach((option, optIndex) => {
                    optionsHtml += `
                        <div class="option" data-index="${optIndex}">
                            <input type="radio" name="${member}-q${index}" id="${member}-q${index}-opt${optIndex}" value="${optIndex}">
                            <label for="${member}-q${index}-opt${optIndex}">${option}</label>
                        </div>
                    `;
                });
                
                // Add coaching tip only for Credo
                const coachingTip = member === 'credo' ? 
                    `<div class="coaching-tip" style="margin-top: 15px; font-size: 0.9rem;">
                        <strong>Conseil :</strong> ${q.explanation}
                    </div>` : '';
                
                questionDiv.innerHTML = `
                    <div class="question-text">
                        <span class="question-number">${index + 1}</span>
                        ${q.question}
                    </div>
                    <div class="options">
                        ${optionsHtml}
                    </div>
                    ${coachingTip}
                `;
                
                container.appendChild(questionDiv);
            });
            
            // Add click events to options
            container.querySelectorAll('.option').forEach(option => {
                option.addEventListener('click', function() {
                    const questionDiv = this.closest('.question');
                    const options = questionDiv.querySelectorAll('.option');
                    const input = this.querySelector('input');
                    
                    // Deselect all options in this question
                    options.forEach(opt => {
                        opt.classList.remove('selected');
                        opt.querySelector('input').checked = false;
                    });
                    
                    // Select clicked option
                    this.classList.add('selected');
                    input.checked = true;
                });
            });
        }
        
        function showContent(member) {
            // Hide all content areas
            document.querySelectorAll('.content-area').forEach(area => {
                area.classList.remove('active-content');
            });
            
            // Show selected member's content
            document.getElementById(`${member}-content`).classList.add('active-content');
            
            // Reset button styles
            document.querySelectorAll('.member-btn').forEach(btn => {
                btn.style.transform = 'translateY(0)';
                btn.style.boxShadow = '0 5px 15px rgba(0, 0, 0, 0.1)';
            });
            
            // Highlight selected button
            const selectedBtn = document.getElementById(`${member}-btn`);
            selectedBtn.style.transform = 'translateY(-5px)';
            selectedBtn.style.boxShadow = '0 10px 20px rgba(0, 0, 0, 0.15)';
            
            // Hide results when switching members
            if (member !== 'admin') {
                document.querySelectorAll('.results-panel').forEach(panel => {
                    panel.style.display = 'none';
                });
            }
            
            // Load admin data if showing admin panel
            if (member === 'admin') {
                loadAllResults();
            }
        }
        
        function submitAnswers(member) {
            let score = 0;
            const totalQuestions = questions.length;
            const answers = [];
            
            // Check each question and collect answers
            for (let i = 0; i < totalQuestions; i++) {
                const selectedOption = document.querySelector(`input[name="${member}-q${i}"]:checked`);
                let selectedValue = null;
                
                if (selectedOption) {
                    selectedValue = parseInt(selectedOption.value);
                    
                    const questionDiv = document.getElementById(`${member}-questions`).children[i];
                    const options = questionDiv.querySelectorAll('.option');
                    
                    // Show correct/incorrect for Credo
                    if (member === 'credo') {
                        options.forEach((option, index) => {
                            option.classList.remove('correct', 'incorrect');
                            
                            if (index === questions[i].correct) {
                                option.classList.add('correct');
                            } else if (index === selectedValue && selectedValue !== questions[i].correct) {
                                option.classList.add('incorrect');
                            }
                        });
                    }
                    
                    // Update score if correct
                    if (selectedValue === questions[i].correct) {
                        score++;
                    }
                }
                
                // Store answer
                answers.push({
                    question: questions[i].question,
                    selected: selectedValue,
                    correct: questions[i].correct,
                    isCorrect: selectedValue === questions[i].correct
                });
            }
            
            // Calculate percentage
            const percentage = Math.round((score / totalQuestions) * 100);
            
            // Prepare result data for Firestore
            const resultData = {
                member: member,
                score: score,
                total: totalQuestions,
                percentage: percentage,
                date: new Date().toISOString(),
                timestamp: Date.now(),
                answers: answers
            };
            
            // Save to Firestore
            saveResultToFirestore(resultData);
            
            // Display results
            displayResults(member, score, totalQuestions, percentage);
        }
        
        function saveResultToFirestore(resultData) {
            // Utiliser Firestore
            db.collection('results').add(resultData)
                .then((docRef) => {
                    console.log('Result saved successfully to Firestore with ID:', docRef.id);
                })
                .catch((error) => {
                    console.error('Error saving result to Firestore:', error);
                    alert('Erreur lors de l\'enregistrement des résultats. Veuillez vérifier votre connexion Internet.');
                });
        }
        
        function displayResults(member, score, totalQuestions, percentage) {
            const resultsPanel = document.getElementById(`${member}-results`);
            const scoreElement = document.getElementById(`${member}-score`);
            const feedbackElement = document.getElementById(`${member}-feedback`);
            
            scoreElement.textContent = `${score}/${totalQuestions}`;
            
            // Provide feedback based on score
            let feedback = '';
            let feedbackClass = '';
            
            if (percentage >= 80) {
                feedback = `Excellent travail ! Tu as bien maîtrisé les accords du participe passé.`;
                feedbackClass = 'good';
            } else if (percentage >= 60) {
                feedback = `Bon travail ! Tu as compris la majorité des règles, mais il reste quelques points à revoir.`;
                feedbackClass = 'average';
            } else {
                feedback = `Continue à t'entraîner ! N'oublie pas que le participe passé s'accorde avec le COD quand il est placé avant le verbe.`;
                feedbackClass = 'poor';
            }
            
            // Add additional feedback for Credo
            if (member === 'credo') {
                feedback += ` En tant que coach, tu peux maintenant expliquer ces règles à tes frères et sœurs.`;
                
                if (percentage >= 80) {
                    feedback += ` Tu es prêt à les coacher efficacement !`;
                } else if (percentage >= 60) {
                    feedback += ` Revois les questions que tu as ratées pour mieux expliquer les règles.`;
                } else {
                    feedback += ` Étudie bien les explications avant de coacher les autres.`;
                }
            }
            
            feedbackElement.textContent = feedback;
            feedbackElement.className = `feedback ${feedbackClass}`;
            
            // Show results panel
            resultsPanel.style.display = 'block';
            
            // Scroll to results
            resultsPanel.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        function loadAllResults() {
            // Show loading state
            document.getElementById('admin-stats').innerHTML = `
                <div class="stat-card">
                    <h4>Chargement des données...</h4>
                    <div class="stat-value">0</div>
                </div>
            `;
            
            document.getElementById('results-table-body').innerHTML = `
                <tr>
                    <td colspan="5" style="text-align: center;">Chargement des données...</td>
                </tr>
            `;
            
            // Utiliser Firestore pour récupérer les données
            db.collection('results').orderBy('timestamp', 'desc').get()
                .then((querySnapshot) => {
                    const results = [];
                    querySnapshot.forEach((doc) => {
                        results.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    updateAdminStats(results);
                    updateResultsTable(results);
                })
                .catch((error) => {
                    console.error('Error loading results from Firestore:', error);
                    document.getElementById('admin-stats').innerHTML = `
                        <div class="stat-card">
                            <h4>Erreur de chargement</h4>
                            <div class="stat-value">Erreur</div>
                        </div>
                    `;
                    
                    document.getElementById('results-table-body').innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center; color: #e74c3c;">
                                Erreur lors du chargement des données. Vérifiez votre connexion Internet.
                            </td>
                        </tr>
                    `;
                });
        }
        
        function updateAdminStats(results) {
            if (results.length === 0) {
                document.getElementById('admin-stats').innerHTML = `
                    <div class="stat-card">
                        <h4>Aucun résultat enregistré</h4>
                        <div class="stat-value">0</div>
                    </div>
                `;
                return;
            }
            
            // Calculate statistics
            const totalAttempts = results.length;
            
            // Count attempts per member
            const memberAttempts = {
                aubaine: 0,
                moise: 0,
                credo: 0
            };
            
            // Calculate average scores
            let totalScore = 0;
            const memberScores = {
                aubaine: { total: 0, count: 0 },
                moise: { total: 0, count: 0 },
                credo: { total: 0, count: 0 }
            };
            
            results.forEach(result => {
                memberAttempts[result.member]++;
                totalScore += result.percentage;
                
                if (memberScores[result.member]) {
                    memberScores[result.member].total += result.percentage;
                    memberScores[result.member].count++;
                }
            });
            
            const averageScore = Math.round(totalScore / totalAttempts);
            
            // Create stats cards
            const statsHtml = `
                <div class="stat-card">
                    <h4>Tentatives totales</h4>
                    <div class="stat-value">${totalAttempts}</div>
                </div>
                
                <div class="stat-card">
                    <h4>Score moyen</h4>
                    <div class="stat-value">${averageScore}%</div>
                </div>
                
                <div class="stat-card">
                    <h4>Tentatives d'Aubaine</h4>
                    <div class="stat-value">${memberAttempts.aubaine}</div>
                </div>
                
                <div class="stat-card">
                    <h4>Tentatives de Moïse</h4>
                    <div class="stat-value">${memberAttempts.moise}</div>
                </div>
                
                <div class="stat-card">
                    <h4>Tentatives de Credo</h4>
                    <div class="stat-value">${memberAttempts.credo}</div>
                </div>
                
                <div class="stat-card">
                    <h4>Score moyen d'Aubaine</h4>
                    <div class="stat-value">${memberScores.aubaine.count > 0 ? Math.round(memberScores.aubaine.total / memberScores.aubaine.count) : 0}%</div>
                </div>
                
                <div class="stat-card">
                    <h4>Score moyen de Moïse</h4>
                    <div class="stat-value">${memberScores.moise.count > 0 ? Math.round(memberScores.moise.total / memberScores.moise.count) : 0}%</div>
                </div>
                
                <div class="stat-card">
                    <h4>Score moyen de Credo</h4>
                    <div class="stat-value">${memberScores.credo.count > 0 ? Math.round(memberScores.credo.total / memberScores.credo.count) : 0}%</div>
                </div>
            `;
            
            document.getElementById('admin-stats').innerHTML = statsHtml;
        }
        
        function updateResultsTable(results) {
            const tableBody = document.getElementById('results-table-body');
            
            if (results.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center;">
                            Aucun résultat enregistré pour le moment.
                        </td>
                    </tr>
                `;
                return;
            }
            
            let tableHtml = '';
            
            results.forEach((result, index) => {
                // Format date
                const date = new Date(result.date);
                const formattedDate = date.toLocaleDateString('fr-FR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                // Determine score class
                let scoreClass = '';
                if (result.percentage >= 80) {
                    scoreClass = 'high';
                } else if (result.percentage >= 60) {
                    scoreClass = 'medium';
                } else {
                    scoreClass = 'low';
                }
                
                // Get member name with proper capitalization
                let memberName = '';
                switch(result.member) {
                    case 'aubaine':
                        memberName = 'Aubaine';
                        break;
                    case 'moise':
                        memberName = 'Moïse';
                        break;
                    case 'credo':
                        memberName = 'Credo';
                        break;
                    default:
                        memberName = result.member;
                }
                
                tableHtml += `
                    <tr>
                        <td>${memberName}</td>
                        <td class="date-cell">${formattedDate}</td>
                        <td class="score-cell ${scoreClass}">${result.score}/${result.total}</td>
                        <td class="score-cell ${scoreClass}">${result.percentage}%</td>
                        <td>
                            <button class="view-details-btn" data-index="${index}" style="
                                background-color: #3498db;
                                color: white;
                                border: none;
                                padding: 5px 10px;
                                border-radius: 3px;
                                cursor: pointer;
                                font-size: 0.85rem;
                            ">
                                <i class="fas fa-eye"></i> Détails
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHtml;
            
            // Add event listeners to detail buttons
            tableBody.querySelectorAll('.view-details-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    showResultDetails(results[index]);
                });
            });
        }
        
        function showResultDetails(result) {
            // Get member name with proper capitalization
            let memberName = '';
            switch(result.member) {
                case 'aubaine':
                    memberName = 'Aubaine';
                    break;
                case 'moise':
                    memberName = 'Moïse';
                    break;
                case 'credo':
                    memberName = 'Credo';
                    break;
                default:
                    memberName = result.member;
            }
            
            // Format date
            const date = new Date(result.date);
            const formattedDate = date.toLocaleDateString('fr-FR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Create details HTML
            let detailsHtml = `
                <h3>Détails des résultats - ${memberName}</h3>
                <p><strong>Date:</strong> ${formattedDate}</p>
                <p><strong>Score:</strong> ${result.score}/${result.total} (${result.percentage}%)</p>
                <hr style="margin: 20px 0;">
                <h4>Réponses détaillées:</h4>
            `;
            
            result.answers.forEach((answer, index) => {
                const question = questions[index];
                const isCorrect = answer.selected === question.correct;
                const status = isCorrect ? '✅ Correct' : '❌ Incorrect';
                const statusClass = isCorrect ? 'good' : 'poor';
                
                detailsHtml += `
                    <div style="
                        background-color: ${isCorrect ? '#d4edda' : '#f8d7da'};
                        padding: 15px;
                        border-radius: 8px;
                        margin-bottom: 15px;
                        border-left: 5px solid ${isCorrect ? '#28a745' : '#dc3545'};
                    ">
                        <p><strong>Question ${index + 1}:</strong> ${question.question}</p>
                        <p><strong>Réponse choisie:</strong> ${answer.selected !== null ? question.options[answer.selected] : 'Aucune réponse'}</p>
                        <p><strong>Réponse correcte:</strong> ${question.options[question.correct]}</p>
                        <p><strong>Statut:</strong> <span style="color: ${isCorrect ? '#155724' : '#721c24'}; font-weight: bold;">${status}</span></p>
                        ${result.member === 'credo' ? `<p><em>${question.explanation}</em></p>` : ''}
                    </div>
                `;
            });
            
            // Show in a modal dialog
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0,0,0,0.7);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
                padding: 20px;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background-color: white;
                padding: 30px;
                border-radius: 10px;
                max-width: 800px;
                max-height: 80vh;
                overflow-y: auto;
                position: relative;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;
            
            modalContent.innerHTML = detailsHtml + `
                <button id="close-modal" style="
                    position: absolute;
                    top: 15px;
                    right: 15px;
                    background-color: #e74c3c;
                    color: white;
                    border: none;
                    padding: 8px 12px;
                    border-radius: 50%;
                    cursor: pointer;
                    font-size: 1.2rem;
                ">
                    ×
                </button>
            `;
            
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            
            // Close modal when clicking close button or outside
            modalContent.querySelector('#close-modal').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }
    </script>
</body>
</html>