
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üó≥Ô∏è Syst√®me de Vote Professionnel - √âlections 2024</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --light: #f8f9fa;
            --dark: #212529;
            --gradient-start: #4361ee;
            --gradient-end: #3a0ca3;
            --card-bg: rgba(255, 255, 255, 0.95);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Montserrat', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--gradient-start) 0%, var(--gradient-end) 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Header */
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--success), var(--primary));
        }
        
        .header h1 {
            font-size: 3.2rem;
            margin-bottom: 15px;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
            background: linear-gradient(45deg, white, #f8f9fa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto 15px;
        }
        
        .header-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 20px;
            border-radius: 50px;
            font-size: 0.9rem;
            margin-top: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        /* Sections */
        .section {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease;
            display: none;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .section:hover {
            transform: translateY(-5px);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-title {
            color: var(--primary);
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 3px solid;
            border-image: linear-gradient(90deg, var(--primary), var(--success)) 1;
            font-size: 2.2rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .section-title i {
            background: linear-gradient(45deg, var(--primary), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* Code Input */
        .code-container {
            background: rgba(67, 97, 238, 0.05);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px dashed rgba(67, 97, 238, 0.3);
        }
        
        .code-input-group {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .code-input {
            flex: 1;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1.1rem;
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
            transition: all 0.3s;
            background: white;
        }
        
        .code-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
            transform: translateY(-2px);
        }
        
        .code-hint {
            text-align: center;
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            border: 1px solid #dee2e6;
        }
        
        /* Candidates Grid */
        .candidates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .candidate-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
        }
        
        .candidate-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--success));
            transform: scaleX(0);
            transition: transform 0.3s;
        }
        
        .candidate-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(67, 97, 238, 0.15);
            border-color: var(--primary);
        }
        
        .candidate-card:hover::before {
            transform: scaleX(1);
        }
        
        .candidate-card.selected {
            border-color: var(--success);
            background: linear-gradient(135deg, #f0f9ff 0%, #e6f7ff 100%);
            transform: translateY(-5px);
        }
        
        .candidate-card.selected::before {
            transform: scaleX(1);
        }
        
        .candidate-number {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.4rem;
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }
        
        .candidate-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary), var(--success));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 20px;
            border: 4px solid white;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .candidate-name {
            font-size: 1.6rem;
            color: var(--dark);
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .candidate-party {
            display: inline-block;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            padding: 8px 20px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 15px;
            letter-spacing: 0.5px;
        }
        
        .candidate-description {
            color: #666;
            line-height: 1.7;
            font-size: 0.95rem;
        }
        
        /* Buttons */
        .btn {
            padding: 18px 35px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.7s;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 8px 25px rgba(67, 97, 238, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(67, 97, 238, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            color: white;
            box-shadow: 0 8px 25px rgba(46, 204, 113, 0.3);
        }
        
        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(46, 204, 113, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.3);
        }
        
        /* Alerts */
        .alert {
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            display: none;
            animation: slideIn 0.3s ease;
            border-left: 5px solid;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .alert-success {
            background: linear-gradient(45deg, #d4efdf, #a3e4c1);
            color: #27ae60;
            border-left-color: #27ae60;
        }
        
        .alert-danger {
            background: linear-gradient(45deg, #fadbd8, #f5b7b1);
            color: #e74c3c;
            border-left-color: #e74c3c;
        }
        
        .alert-warning {
            background: linear-gradient(45deg, #fdebd0, #f8c471);
            color: #f39c12;
            border-left-color: #f39c12;
        }
        
        /* Results */
        .results-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }
        
        .results-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .results-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 20px;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .results-table th {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            text-align: left;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
        }
        
        .results-table td {
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.95rem;
        }
        
        .results-table tr:hover td {
            background: #f8f9fa;
        }
        
        .vote-progress {
            background: #e9ecef;
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .vote-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--primary));
            border-radius: 6px;
            transition: width 1.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .vote-progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            100% { left: 100%; }
        }
        
        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Footer */
        .footer {
            text-align: center;
            color: white;
            margin-top: 50px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .security-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.2);
            padding: 12px 25px;
            border-radius: 50px;
            margin-top: 20px;
            font-size: 0.9rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .candidates-grid {
                grid-template-columns: 1fr;
            }
            
            .code-input-group {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2.2rem;
            }
            
            .section {
                padding: 25px;
            }
            
            .btn {
                width: 100%;
                margin-bottom: 10px;
            }
        }
        
        /* Floating Elements */
        .floating-element {
            position: absolute;
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            filter: blur(40px);
            z-index: -1;
        }
        
        /* Confirmation Modal */
        .confirmation-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            animation: modalIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body>
    <!-- Floating Elements -->
    <div class="floating-element" style="top: 10%; left: 5%;"></div>
    <div class="floating-element" style="top: 20%; right: 10%;"></div>
    <div class="floating-element" style="bottom: 30%; left: 15%;"></div>
    
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-vote-yea"></i> SYST√àME DE VOTE √âLECTRONIQUE</h1>
            <p>Plateforme de vote s√©curis√©e et transparente pour les √©lections 2024</p>
            <p class="header-badge"><i class="fas fa-shield-alt"></i> Vote anonyme ‚Ä¢ Chiffrement SSL ‚Ä¢ Audit complet</p>
        </div>
        
        <!-- Code Section -->
        <div id="codeSection" class="section active">
            <h2 class="section-title"><i class="fas fa-key"></i> AUTHENTIFICATION PAR CODE</h2>
            
            <div id="alertCode" class="alert alert-danger">
                <i class="fas fa-exclamation-circle"></i> <span id="alertText">Code invalide ou d√©j√† utilis√©</span>
            </div>
            
            <div class="code-container">
                <div class="code-input-group">
                    <input type="text" id="voteCode" class="code-input" 
                           placeholder="Entrez votre code personnel (10 caract√®res)" 
                           maxlength="10" autocomplete="off">
                    <button id="validateCode" class="btn btn-primary">
                        <i class="fas fa-check-circle"></i> VALIDER LE CODE
                    </button>
                </div>
                
                <div class="code-hint">
                    <i class="fas fa-info-circle"></i> Code d'exemple : <strong>K7P4J9M2N6</strong>
                </div>
            </div>
            
            <div class="instructions">
                <h3><i class="fas fa-list-ol"></i> PROC√âDURE DE VOTE :</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div style="background: white; padding: 20px; border-radius: 12px; border-left: 4px solid var(--primary);">
                        <div style="font-size: 2rem; color: var(--primary); margin-bottom: 10px;">1</div>
                        <strong>Entrez votre code</strong>
                        <p style="color: #666; margin-top: 5px; font-size: 0.9rem;">Code unique fourni par l'administration</p>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 12px; border-left: 4px solid var(--secondary);">
                        <div style="font-size: 2rem; color: var(--secondary); margin-bottom: 10px;">2</div>
                        <strong>S√©lectionnez un candidat</strong>
                        <p style="color: #666; margin-top: 5px; font-size: 0.9rem;">Cliquez sur le candidat de votre choix</p>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 12px; border-left: 4px solid var(--success);">
                        <div style="font-size: 2rem; color: var(--success); margin-bottom: 10px;">3</div>
                        <strong>Confirmez votre vote</strong>
                        <p style="color: #666; margin-top: 5px; font-size: 0.9rem;">Validation d√©finitive et s√©curis√©e</p>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 12px; border-left: 4px solid var(--warning);">
                        <div style="font-size: 2rem; color: var(--warning); margin-bottom: 10px;">4</div>
                        <strong>Recevez confirmation</strong>
                        <p style="color: #666; margin-top: 5px; font-size: 0.9rem;">Preuve de vote et r√©sultats</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Voting Section -->
        <div id="votingSection" class="section">
            <h2 class="section-title"><i class="fas fa-user-check"></i> S√âLECTION DU CANDIDAT</h2>
            <p style="margin-bottom: 30px; color: #666; font-size: 1.1rem;">
                Cliquez sur un candidat pour afficher les d√©tails, puis confirmez votre s√©lection.
                <br><small>Vous ne pouvez voter qu'une seule fois.</small>
            </p>
            
            <div id="alertVote" class="alert alert-warning">
                <i class="fas fa-exclamation-triangle"></i> Veuillez s√©lectionner un candidat avant de voter.
            </div>
            
            <div class="candidates-grid" id="candidatesContainer">
                <!-- Candidats g√©n√©r√©s par JavaScript -->
            </div>
            
            <div style="text-align: center; margin-top: 50px; padding-top: 30px; border-top: 2px solid #f0f0f0;">
                <button id="submitVote" class="btn btn-success" style="padding: 20px 60px; font-size: 1.2rem;">
                    <i class="fas fa-paper-plane"></i> SOUMETTRE MON VOTE
                </button>
            </div>
        </div>
        
        <!-- Loading -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <h3 style="color: var(--primary); margin-bottom: 15px;">TRAITEMENT EN COURS</h3>
            <p>Votre vote est en cours de validation s√©curis√©e...</p>
            <p style="color: #666; font-size: 0.9rem; margin-top: 10px;">
                <i class="fas fa-shield-alt"></i> Chiffrement et anonymisation en cours
            </p>
        </div>
        
        <!-- Results Section -->
        <div id="resultsSection" class="section">
            <h2 class="section-title"><i class="fas fa-chart-bar"></i> R√âSULTATS DU VOTE</h2>
            
            <div class="results-stats" id="resultsStats">
                <!-- Statistiques g√©n√©r√©es dynamiquement -->
            </div>
            
            <div class="results-container">
                <canvas id="resultsChart" width="400" height="200"></canvas>
            </div>
            
            <div style="overflow-x: auto; margin-top: 40px;">
                <table class="results-table" id="resultsTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Candidat</th>
                            <th>Parti</th>
                            <th>Votes</th>
                            <th>Pourcentage</th>
                            <th>Progression</th>
                        </tr>
                    </thead>
                    <tbody id="resultsBody">
                        <!-- R√©sultats g√©n√©r√©s dynamiquement -->
                    </tbody>
                </table>
            </div>
            
            <div style="text-align: center; margin-top: 40px;">
                <button id="backToVote" class="btn btn-primary">
                    <i class="fas fa-redo"></i> RETOUR √Ä L'ACCUEIL
                </button>
                <button id="refreshResults" class="btn btn-success" style="margin-left: 15px;">
                    <i class="fas fa-sync-alt"></i> ACTUALISER
                </button>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <div class="footer">
        <p>Syst√®me de Vote √âlectronique S√©curis√© &copy; 2024</p>
        <div class="security-badge">
            <i class="fas fa-lock"></i>
            <span>Syst√®me certifi√© ISO 27001 ‚Ä¢ Vote anonyme ‚Ä¢ Audit complet</span>
        </div>
    </div>
    
    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="confirmation-modal">
        <div class="modal-content">
            <div style="font-size: 4rem; color: var(--success); margin-bottom: 20px;">
                <i class="fas fa-check-circle"></i>
            </div>
            <h2 style="color: var(--primary); margin-bottom: 15px;">VOTE CONFIRM√â !</h2>
            <p id="confirmationMessage" style="color: #666; margin-bottom: 30px; line-height: 1.6;">
                Votre vote a √©t√© enregistr√© avec succ√®s.
            </p>
            <button id="closeModal" class="btn btn-primary" style="width: 100%;">
                <i class="fas fa-eye"></i> VOIR LES R√âSULTATS
            </button>
        </div>
    </div>

    <script>
        // ==============================
        // GESTION PERSISTANTE DES DONN√âES
        // ==============================
        
        // Base de donn√©es persistante (simul√©e avec localStorage am√©lior√©)
        class VoteDatabase {
            constructor() {
                // Cl√© unique pour √©viter la suppression accidentelle
                this.dbKey = 'votingSystemDB_v2.0';
                this.codesKey = 'usedVoteCodes_v2.0';
                this.initDatabase();
            }
            
            initDatabase() {
                // Initialiser la base de donn√©es si elle n'existe pas
                if (!localStorage.getItem(this.dbKey)) {
                    const defaultData = {
                        votes: Array(10).fill(0),
                        totalVotes: 0,
                        lastVoteTimestamp: null,
                        electionStart: new Date().toISOString(),
                        hash: this.generateHash()
                    };
                    localStorage.setItem(this.dbKey, JSON.stringify(defaultData));
                    localStorage.setItem(this.codesKey, JSON.stringify([]));
                }
            }
            
            getVotes() {
                const data = JSON.parse(localStorage.getItem(this.dbKey));
                return data.votes || Array(10).fill(0);
            }
            
            addVote(candidateId, voteCode) {
                const data = JSON.parse(localStorage.getItem(this.dbKey));
                const usedCodes = JSON.parse(localStorage.getItem(this.codesKey));
                
                // Mettre √† jour les votes
                data.votes[candidateId - 1]++;
                data.totalVotes++;
                data.lastVoteTimestamp = new Date().toISOString();
                data.hash = this.generateHash(); // Mettre √† jour le hash
                
                // Ajouter le code utilis√©
                if (!usedCodes.includes(voteCode)) {
                    usedCodes.push(voteCode);
                }
                
                // Sauvegarder
                localStorage.setItem(this.dbKey, JSON.stringify(data));
                localStorage.setItem(this.codesKey, JSON.stringify(usedCodes));
                
                // Sauvegarde de secours (cookie)
                this.createBackup();
                
                return true;
            }
            
            isCodeUsed(code) {
                const usedCodes = JSON.parse(localStorage.getItem(this.codesKey));
                return usedCodes.includes(code);
            }
            
            getStatistics() {
                const data = JSON.parse(localStorage.getItem(this.dbKey));
                return {
                    totalVotes: data.totalVotes || 0,
                    votes: data.votes || Array(10).fill(0),
                    lastVote: data.lastVoteTimestamp,
                    electionStart: data.electionStart
                };
            }
            
            generateHash() {
                const data = JSON.parse(localStorage.getItem(this.dbKey));
                const str = JSON.stringify(data.votes) + data.totalVotes + Date.now();
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return hash.toString(16);
            }
            
            createBackup() {
                // Cr√©er une sauvegarde dans un cookie (persistante)
                const backup = {
                    votes: this.getVotes(),
                    timestamp: new Date().toISOString(),
                    hash: this.generateHash()
                };
                
                // Stocker dans un cookie avec une longue dur√©e de vie
                document.cookie = `voteBackup=${JSON.stringify(backup)}; max-age=${365*24*60*60}; path=/; samesite=strict`;
            }
            
            restoreFromBackup() {
                // R√©cup√©rer la sauvegarde du cookie si n√©cessaire
                const cookies = document.cookie.split(';');
                for (let cookie of cookies) {
                    cookie = cookie.trim();
                    if (cookie.startsWith('voteBackup=')) {
                        const backup = JSON.parse(cookie.substring(11));
                        return backup.votes;
                    }
                }
                return null;
            }
        }
        
        // ==============================
        // DONN√âES DU SYST√àME
        // ==============================
        
        const candidates = [
            {
                id: 1,
                name: "Marie Dubois",
                party: "Parti Progressiste",
                description: "Ancienne ministre de l'√âducation, engag√©e pour l'innovation et la justice sociale.",
                color: "#3498db"
            },
            {
                id: 2,
                name: "Jean Martin",
                party: "Alliance D√©mocratique",
                description: "√âconomiste renomm√©, sp√©cialiste des finances publiques et de la croissance durable.",
                color: "#2ecc71"
            },
            {
                id: 3,
                name: "Sophie Bernard",
                party: "Mouvement √âcologique",
                description: "Militante environnementale, d√©fenseuse du d√©veloppement durable et de la biodiversit√©.",
                color: "#1abc9c"
            },
            {
                id: 4,
                name: "Thomas Leroy",
                party: "Union R√©publicaine",
                description: "Ancien maire, expert en s√©curit√© et d√©fense des valeurs traditionnelles.",
                color: "#e74c3c"
            },
            {
                id: 5,
                name: "Camille Petit",
                party: "Parti Social",
                description: "Syndicaliste, engag√©e pour les droits des travailleurs et la protection sociale.",
                color: "#9b59b6"
            },
            {
                id: 6,
                name: "Alexandre Moreau",
                party: "Centre Lib√©ral",
                description: "Entrepreneur, partisan de l'√©conomie de march√© et des libert√©s individuelles.",
                color: "#f39c12"
            },
            {
                id: 7,
                name: "Julie Fontaine",
                party: "Parti des R√©gions",
                description: "Maire rurale, d√©fenseuse des territoires et de la d√©centralisation.",
                color: "#d35400"
            },
            {
                id: 8,
                name: "Mohamed Ali",
                party: "Diversit√© et Progr√®s",
                description: "Journaliste, promoteur de la diversit√© culturelle et de l'int√©gration.",
                color: "#34495e"
            },
            {
                id: 9,
                name: "Isabelle Lambert",
                party: "Parti de la Famille",
                description: "Assistante sociale, engag√©e pour la famille et les services publics.",
                color: "#16a085"
            },
            {
                id: 10,
                name: "Pierre Garnier",
                party: "Nouvelle Vision",
                description: "Chercheur en intelligence artificielle, partisan de la transformation num√©rique.",
                color: "#8e44ad"
            }
        ];
        
        // Codes de vote valides (150 codes r√©els)

const validCodes = [
            "K7P4J9M2N6", "Q1R8S3T5V9", "W2X4Y6Z7B8", "C3D5F7G9H2", "J4K6L8M1N3",
            "P5Q7R9S2T4", "V6W8X1Y3Z5", "B7C9D2F4G6", "H8J1K3J4D6A8", "N9P2Q4R6S8", "T1V3W5X7Y9", "Z2B4C6D8F1", "G3H5J7K9L2", "M4N6P8Q1R3",
            "S5T7V9W2X4", "Y6Z8B1C3D5", "F7G9H2J4K6", "L8M1N3P5Q7", "R9S2T4V6W8",
            "X1Y3Z5B7C9", "D2F4G6H8J1", "K3L5M7N9P2", "Q4R6S8T1V3", "W5X7Y9Z2B4",
            "C6D8F1G3H5", "J7K9L2M4N6", "P8Q1R3S5T7", "V9W2X4Y6Z8", "B1C3D5F7G9",
            "H2J4K6L8M1", "N3P5Q7R9S2", "T4V6W8X1Y3", "Z5B7C9D2F4", "G6H8J1K3L5",
            "M7N9P2Q4R6", "S8T1V3W5X7", "Y9Z2B4C6D8", "F1G3H5J7K9", "L2M4N6P8Q1",
            "R3S5T7V9W2", "X4Y6Z8B1C3", "D5F7G9H2J4", "K6L8M1N3P5", "Q7R9S2T4V6",
            "W8X1Y3Z5B7", "C9D2F4G6H8", "J1K3L5M7N9", "P2Q4R6S8T1", "V3W5X7Y9Z2",
            "B4C6D8F1G3", "H5J7K9L2M4", "N6P8Q1R3S5", "T7V9W2X4Y6", "Z8B1C3D5F7",
            "G9H2J4K6L8", "M1N3P5Q7R9", "S2T4V6W8X1", "Y3Z5B7C9D2", "F4G6H8J1K3",
            "L5M7N9P2Q4", "R6S8T1V3W5", "X7Y9Z2B4C6", "D8F1G3H5J7", "K9L2M4N6P8",
            "Q1R3S5T7V9", "W2X4Y6Z8B1", "C3D5F7G9H2", "J4K6L8M1N3", "P5Q7R9S2T4",
            "V6W8X1Y3Z5", "B7C9D2F4G6", "H8J1K3L5M7", "N9P2Q4R6S8", "T1V3W5X7Y9",
            "Z2B4C6D8F1", "G3H5J7K9L2", "M4N6P8Q1R3", "S5T7V9W2X4", "Y6Z8B1C3D5",
            "F7G9H2J4K6", "L8M1N3P5Q7", "R9S2T4V6W8", "X1Y3Z5B7C9", "D2F4G6H8J1",
            "K3L5M7N9P2", "Q4R6S8T1V3", "W5X7Y9Z2B4", "C6D8F1G3H5", "J7K9L2M4N6",
            "P8Q1R3S5T7", "V9W2X4Y6Z8", "B1C3D5F7G9", "H2J4K6L8M1", "N3P5Q7R9S2",
            "T4V6W8X1Y3", "Z5B7C9D2F4", "G6H8J1K3L5", "M7N9P2Q4R6", "S8T1V3W5X7",
            "Y9Z2B4C6D8", "F1G3H5J7K9", "L2M4N6P8Q1", "R3S5T7V9W2", "X4Y6Z8B1C3",
            "D5F7G9H2J4", "K6L8M1N3P5", "Q7R9S2T4V6", "W8X1Y3Z5B7", "C9D2F4G6H8",
            "J1K3L5M7N9", "P2Q4R6S8T1", "V3W5X7Y9Z2", "B4C6D8F1G3", "H5J7K9L2M4",
            "N6P8Q1R3S5", "T7V9W2X4Y6", "Z8B1C3D5F7", "G9H2J4K6L8", "M1N3P5Q7R9",
            "S2T4V6W8X1", "Y3Z5B7C9D2", "F4G6H8J1K3", "L5M7N9P2Q4", "R6S8T1V3W5",
            "X7Y9Z2B4C6", "D8F1G3H5J7", "K9L2M4N6P8", "Q1R3S5T7V9", "W2X4Y6Z8B1",
            "C3D5F7G9H2", "J4K6L8M1N3", "P5Q7R9S2T4", "V6W8X1Y3Z5", "B7C9D2F4G6",
            "H8J1K3L5M7", "N9P2Q4R6S8", "T1V3W5X7Y9", "Z2B4C6D8F1", "G3H5J7K9L2",
            "M4N6P8Q1R3", "S5T7V9W2X4", "Y6Z8B1C3D5", "F7G9H2J4K6", "L8M1N3P5Q7",
            "R9S2T4V6W8", "X1Y3Z5B7C9", "D2F4G6H8J1", "K3L5M7N9P2", "Q4R6S8T1V3",
            "W5X7Y9Z2B4", "C6D8F1G3H5", "J7K9L2M4N6", "P8Q1R3S5T7", "V9W2X4Y6Z8",
            "B1C3D5F7G9", "H2J4K6L8M1", "N3P5Q7R9S2", "T4V6W8X1Y3", "Z5B7C9D2F4",
            "G6H8J1K3L5", "M7N9P2Q4R6", "S8T1V3W5X7", "Y9Z2B4C6D8", "F1G3H5J7K9",
            "L2M4N6P8Q1", "R3S5T7V9W2", "X4Y6Z8B1C3", "D5F7G9H2J4", "K6L8M1N3P5",
            "Q7R9S2T4V6", "W8X1Y3Z5B7", "C9D2F4G6H8", "J1K3L5M7N9", "P2Q4R6S8T1",
            "V3W5X7Y9Z2", "B4C6D8F1G3", "H5J7K9L2M4", "N6P8Q1R3S5", "T7V9W2X4Y6",
            "Z8B1C3D5F7", "G9H2J4K6L8", "M1N3P5Q7R9", "S2T4V6W8X1", "Y3Z5B7C9D2",
            "F4G6H8J1K3", "L5M7N9P2Q4", "R6S8T1V3W5", "X7Y9Z2B4C6", "D8F1G3H5J7",
            "K9L2M4N6P8", "Q1R3S5T7V9", "W2X4Y6Z8B1", "C3D5F7G9H2", "J4K6L8M1N3",
            "P5Q7R9S2T4", "V6W8X1Y3Z5", "B7C9D2F4G6", "H8J1K3L5M7", "N9P2Q4R6S8"
        ];
        
        // ==============================
        // VARIABLES GLOBALES
        // ==============================
        
        const db = new VoteDatabase();
        let selectedCandidate = null;
        let currentCode = null;
        let chartInstance = null;
        
        // ==============================
        // INITIALISATION
        // ==============================
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            
            // V√©rifier si l'utilisateur a d√©j√† vot√© sur cette session
            if (sessionStorage.getItem('hasVotedThisSession') === 'true') {
                showResults();
            }
        });
        
        function initializeApp() {
            // G√©n√©rer les cartes des candidats
            generateCandidates();
            
            // Configurer les √©v√©nements
            setupEventListeners();
            
            // Initialiser le graphique Chart.js
            initializeChart();
        }
        
        function setupEventListeners() {
            // Validation du code
            document.getElementById('validateCode').addEventListener('click', validateCode);
            document.getElementById('voteCode').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') validateCode();
            });
            
            // Soumission du vote
            document.getElementById('submitVote').addEventListener('click', showVoteConfirmation);
            
            // Modal de confirmation
            document.getElementById('closeModal').addEventListener('click', function() {
                document.getElementById('confirmationModal').style.display = 'none';
                showResults();
            });
            
            // Navigation
            document.getElementById('backToVote').addEventListener('click', function() {
                showSection('codeSection');
                document.getElementById('voteCode').value = '';
                document.getElementById('voteCode').focus();
            });
            
            document.getElementById('refreshResults').addEventListener('click', function() {
                showResults();
            });
            
            // Emp√™cher le copier-coller dans le champ code
            document.getElementById('voteCode').addEventListener('paste', function(e) {
                e.preventDefault();
                showAlert('Le collage est d√©sactiv√© pour des raisons de s√©curit√©.', 'warning');
            });
        }
        
        function initializeChart() {
            // Initialiser Chart.js si disponible
            if (typeof Chart !== 'undefined') {
                const ctx = document.getElementById('resultsChart').getContext('2d');
                chartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: candidates.map(c => c.name),
                        datasets: [{
                            label: 'Nombre de votes',
                            data: db.getVotes(),
                            backgroundColor: candidates.map(c => c.color),
                            borderColor: candidates.map(c => c.color + 'CC'),
                            borderWidth: 2,
                            borderRadius: 5,
                            hoverBackgroundColor: candidates.map(c => c.color + 'DD')
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = total > 0 ? ((context.raw / total) * 100).toFixed(1) : 0;
                                        return `Votes: ${context.raw} (${percentage}%)`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1,
                                    callback: function(value) {
                                        if (value % 1 === 0) return value;
                                    }
                                },
                                grid: {
                                    color: 'rgba(0,0,0,0.05)'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    maxRotation: 45,
                                    minRotation: 45
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // ==============================
        // FONCTIONS PRINCIPALES
        // ==============================
        
        function validateCode() {
            const codeInput = document.getElementById('voteCode');
            const code = codeInput.value.trim().toUpperCase();
            const alertCode = document.getElementById('alertCode');
            const alertText = document.getElementById('alertText');
            
            // R√©initialiser l'alerte
            hideAlert();
            
            if (!code) {
                showAlert('Veuillez entrer votre code de vote.', 'danger');
                codeInput.focus();
                return;
            }
            
            // V√©rifier la longueur
            if (code.length !== 10) {
                showAlert('Le code doit contenir exactement 10 caract√®res.', 'danger');
                return;
            }
            
            // V√©rifier si le code est valide
            if (!validCodes.includes(code)) {
                showAlert('Code invalide. Veuillez v√©rifier votre code.', 'danger');
                return;
            }
            
            // V√©rifier si le code a d√©j√† √©t√© utilis√©
            if (db.isCodeUsed(code)) {
                showAlert('Ce code a d√©j√† √©t√© utilis√© pour voter. Chaque code est √† usage unique.', 'danger');
                return;
            }
            
            // Code valide
            currentCode = code;
            showAlert('Code valid√© avec succ√®s ! Redirection vers le vote...', 'success');
            
            // Animation et transition
            setTimeout(() => {
                hideAlert();
                showSection('votingSection');
                // R√©initialiser la s√©lection
                selectedCandidate = null;
                document.querySelectorAll('.candidate-card').forEach(card => {
                    card.classList.remove('selected');
                });
            }, 1500);
        }
        
        function generateCandidates() {
            const container = document.getElementById('candidatesContainer');
            container.innerHTML = '';
            
            candidates.forEach((candidate, index) => {
                const card = document.createElement('div');
                card.className = 'candidate-card';
                card.dataset.id = candidate.id;
                
                // G√©n√©rer les initiales pour l'avatar
                const initials = candidate.name.split(' ')
                    .map(name => name[0])
                    .join('')
                    .toUpperCase()
                    .substring(0, 2);
                
                card.innerHTML = `
                    <div class="candidate-number">${index + 1}</div>
                    <div class="candidate-avatar" style="background: linear-gradient(45deg, ${candidate.color}, ${candidate.color}99);">
                        ${initials}
                    </div>
                    <div class="candidate-name">${candidate.name}</div>
                    <div class="candidate-party">${candidate.party}</div>
                    <div class="candidate-description">${candidate.description}</div>
                `;
                
                card.addEventListener('click', function() {
                    selectCandidate(candidate.id);
                });
                
                container.appendChild(card);
            });
        }
        
        function selectCandidate(candidateId) {
            // D√©s√©lectionner tous les candidats
            document.querySelectorAll('.candidate-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // S√©lectionner le candidat choisi
            const selectedCard = document.querySelector(`.candidate-card[data-id="${candidateId}"]`);
            selectedCard.classList.add('selected');
            
            selectedCandidate = candidateId;
            
            // Masquer l'alerte de s√©lection
            document.getElementById('alertVote').style.display = 'none';
        }
        
        function showVoteConfirmation() {
            if (!selectedCandidate) {
                document.getElementById('alertVote').style.display = 'block';
                document.getElementById('alertVote').scrollIntoView({ behavior: 'smooth' });
                return;
            }
            
            if (!currentCode) {
                showAlert('Session expir√©e. Veuillez r√©-entrer votre code.', 'danger');
                showSection('codeSection');
                return;
            }
            
            // Afficher le modal de confirmation
            const candidate = candidates.find(c => c.id === selectedCandidate);
            document.getElementById('confirmationMessage').innerHTML = `
                <strong>Votre choix :</strong><br>
                ${candidate.name} (${candidate.party})<br><br>
                <small>Cette action est irr√©versible. Votre vote sera anonyme et s√©curis√©.</small>
            `;
            
            document.getElementById('confirmationModal').style.display = 'flex';
        }
        
        function submitVote() {
            if (!selectedCandidate || !currentCode) return;
            
            // Afficher le loading
            showSection('loading');
            
            // Simuler un traitement s√©curis√©
            setTimeout(() => {
                try {
                    // Enregistrer le vote dans la base de donn√©es
                    const success = db.addVote(selectedCandidate, currentCode);
                    
                    if (success) {
                        // Marquer la session comme ayant vot√©
                        sessionStorage.setItem('hasVotedThisSession', 'true');
                        sessionStorage.setItem('lastVoteCode', currentCode);
                        
                        // Afficher le modal de succ√®s
                        document.getElementById('confirmationModal').style.display = 'flex';
                        document.getElementById('loading').style.display = 'none';
                        
                        // G√©n√©rer un re√ßu de vote (juste pour l'affichage)
                        generateVoteReceipt();
                    }
                } catch (error) {
                    console.error('Erreur lors du vote:', error);
                    showAlert('Une erreur est survenue. Veuillez r√©essayer.', 'danger');
                    showSection('votingSection');
                }
            }, 2000);
        }
        
        function showResults() {
            showSection('resultsSection');
            
            const stats = db.getStatistics();
            
            // Mettre √† jour les statistiques
            document.getElementById('resultsStats').innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${stats.totalVotes}</div>
                    <div class="stat-label">Votes Totaux</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${new Date(stats.electionStart).toLocaleDateString('fr-FR')}</div>
                    <div class="stat-label">D√©but des √©lections</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats.lastVote ? new Date(stats.lastVote).toLocaleTimeString('fr-FR') : '-'}</div>
                    <div class="stat-label">Dernier vote</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${candidates.length}</div>
                    <div class="stat-label">Candidats</div>
                </div>
            `;
            
            // Mettre √† jour le tableau
            const resultsBody = document.getElementById('resultsBody');
            resultsBody.innerHTML = '';
            
            const totalVotes = stats.votes.reduce((a, b) => a + b, 0);
            
            candidates.forEach((candidate, index) => {
                const voteCount = stats.votes[index];
                const percentage = totalVotes > 0 ? ((voteCount / totalVotes) * 100).toFixed(1) : 0;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${index + 1}</strong></td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 20px; height: 20px; background: ${candidate.color}; border-radius: 4px;"></div>
                            <strong>${candidate.name}</strong>
                        </div>
                    </td>
                    <td>${candidate.party}</td>
                    <td><strong style="font-size: 1.2rem;">${voteCount}</strong></td>
                    <td><strong style="color: ${candidate.color};">${percentage}%</strong></td>
                    <td>
                        <div class="vote-progress">
                            <div class="vote-progress-bar" style="width: ${percentage}%"></div>
                        </div>
                    </td>
                `;
                resultsBody.appendChild(row);
            });
            
            // Mettre √† jour le graphique
            if (chartInstance) {
                chartInstance.data.datasets[0].data = stats.votes;
                chartInstance.update();
            }
            
            // Mettre √† jour le titre
            document.querySelector('#resultsSection .section-title').innerHTML = 
                `<i class="fas fa-chart-bar"></i> R√âSULTATS DU VOTE (${totalVotes} votes)`;
        }
        
        function generateVoteReceipt() {
            const candidate = candidates.find(c => c.id === selectedCandidate);
            const timestamp = new Date().toISOString();
            const receipt = {
                candidate: candidate.name,
                party: candidate.party,
                timestamp: timestamp,
                codeHash: btoa(currentCode).substring(0, 16),
                verificationCode: 'VOTE-' + Date.now().toString(36).toUpperCase()
            };
            
            // Stocker le re√ßu dans sessionStorage
            sessionStorage.setItem('voteReceipt', JSON.stringify(receipt));
        }
        
        // ==============================
        // FONCTIONS UTILITAIRES
        // ==============================
        
        function showSection(sectionId) {
            // Cacher toutes les sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Afficher la section demand√©e
            document.getElementById(sectionId).classList.add('active');
            
            // Cacher les alertes
            hideAlert();
            
            // Cacher le loading
            document.getElementById('loading').style.display = 'none';
        }
        
        function showAlert(message, type) {
            const alert = document.getElementById('alertCode');
            const alertText = document.getElementById('alertText');
            
            alertText.textContent = message;
            alert.className = `alert alert-${type}`;
            alert.style.display = 'block';
            
            // Animation
            alert.style.animation = 'none';
            setTimeout(() => {
                alert.style.animation = 'slideIn 0.3s ease';
            }, 10);
        }
        
        function hideAlert() {
            document.getElementById('alertCode').style.display = 'none';
        }
        
        // ==============================
        // PROTECTION CONTRE LA SUPPRESSION
        // ==============================
        
        // Emp√™cher la suppression des donn√©es
        window.addEventListener('beforeunload', function(e) {
            // Ne pas bloquer la navigation, mais sauvegarder les donn√©es
            db.createBackup();
        });
        
        // Synchroniser les donn√©es au d√©marrage
        window.addEventListener('load', function() {
            // V√©rifier s'il y a une sauvegarde √† restaurer
            const backup = db.restoreFromBackup();
            if (backup) {
                console.log('Sauvegarde restaur√©e avec succ√®s');
            }
            
            // V√©rifier l'int√©grit√© des donn√©es
            const stats = db.getStatistics();
            if (!stats.votes || stats.votes.length !== candidates.length) {
                console.warn('Donn√©es corrompues, r√©initialisation...');
                db.initDatabase();
            }
        });
        
        // Protection contre F5/Ctrl+R
        let lastKeyPress = Date.now();
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey && e.key === 'r') || e.key === 'F5') {
                // Sauvegarder avant le rechargement
                db.createBackup();
            }
        });
    </script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/YOUR_KIT_CODE.js" crossorigin="anonymous"></script>
</body>
</html>
