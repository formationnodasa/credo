
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Champs Lexicaux - MULTIJOUEUR SIMPLIFI√â</title>
  <style>
    :root{
      --bg1:#6a11cb; --bg2:#2575fc;
      --card: rgba(255,255,255,.12);
      --glass: blur(12px);
      --txt:#fff; --accent:#fff; --brand:#2575fc;
      --ok:#00e676; --ko:#ff5252;
      --room-color:#9c27b0;
      --player-color:#4caf50;
    }
    *{box-sizing:border-box; margin:0; padding:0;}
    body{
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(270deg, var(--bg1), var(--bg2), var(--bg1));
      background-size: 600% 600%;
      animation: gradientAnimation 15s ease infinite;
      color: var(--txt);
      min-height: 100vh;
      padding: 12px;
      overflow-x: hidden;
      overflow-y: auto;
    }
    @keyframes gradientAnimation{
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }
    
    /* Modal Multijoueur */
    .multiplayer-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.95);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      overflow-y: auto;
    }
    
    .multiplayer-content {
      background: #1a1a2e;
      border-radius: 20px;
      padding: 30px;
      max-width: 500px;
      width: 100%;
      border: 2px solid var(--room-color);
      position: relative;
      color: white;
      box-shadow: 0 10px 40px rgba(156, 39, 176, 0.4);
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .close-multiplayer {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      color: #ff6b6b;
      font-size: 1.8rem;
      cursor: pointer;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }
    
    .multiplayer-title {
      text-align: center;
      color: #e1bee7;
      margin-bottom: 25px;
      font-size: 1.8rem;
    }
    
    .multiplayer-buttons {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 25px;
    }
    
    .multiplayer-btn {
      padding: 18px;
      background: linear-gradient(90deg, var(--room-color), #7b1fa2);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1.2rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      width: 100%;
    }
    
    .multiplayer-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(156, 39, 176, 0.5);
    }
    
    .multiplayer-btn.join {
      background: linear-gradient(90deg, var(--player-color), #2e7d32);
    }
    
    .multiplayer-btn.join:hover {
      box-shadow: 0 8px 25px rgba(76, 175, 80, 0.5);
    }
    
    .room-section {
      margin-top: 25px;
      border-top: 2px solid rgba(255, 255, 255, 0.1);
      padding-top: 20px;
    }
    
    .room-input {
      width: 100%;
      padding: 16px;
      border-radius: 12px;
      border: 2px solid rgba(156, 39, 176, 0.4);
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 1.1rem;
      margin-bottom: 15px;
    }
    
    .room-input::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }
    
    .room-info {
      background: rgba(156, 39, 176, 0.1);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      border: 2px solid rgba(156, 39, 176, 0.3);
      max-height: 300px;
      overflow-y: auto;
    }
    
    .room-info h4 {
      color: #e1bee7;
      margin-bottom: 15px;
      font-size: 1.3rem;
      position: sticky;
      top: 0;
      background: rgba(26, 26, 46, 0.9);
      padding: 5px;
      z-index: 1;
    }
    
    .players-list {
      list-style: none;
      padding: 0;
    }
    
    .players-list li {
      padding: 10px 15px;
      margin-bottom: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .players-list li .player-badge {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--player-color);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      flex-shrink: 0;
    }
    
    .players-list li.you {
      background: rgba(76, 175, 80, 0.2);
      border-left: 4px solid var(--player-color);
    }
    
    .room-id-display {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 12px;
      margin: 15px 0;
      text-align: center;
      font-weight: bold;
      font-size: 1.4rem;
      letter-spacing: 2px;
      color: #e1bee7;
      border: 2px dashed rgba(156, 39, 176, 0.4);
    }
    
    .copy-btn {
      background: rgba(255, 255, 255, 0.15);
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 10px auto 0;
      transition: background 0.3s;
      width: 100%;
      justify-content: center;
    }
    
    .copy-btn:hover {
      background: rgba(255, 255, 255, 0.25);
    }
    
    /* Interface multijoueur dans le jeu */
    .multiplayer-status {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      background: rgba(0,0,0,0.2);
      padding: 15px;
      border-radius: 15px;
      border: 2px solid var(--room-color);
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .room-indicator {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 20px;
      background: rgba(156, 39, 176, 0.2);
      border-radius: 10px;
      border: 2px solid var(--room-color);
      flex: 1;
      min-width: 200px;
    }
    
    .players-in-room {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: center;
      flex: 2;
    }
    
    .player-bubble {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--player-color);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      position: relative;
      border: 3px solid white;
      flex-shrink: 0;
    }
    
    .player-bubble.you {
      border-color: #ffeb3b;
      box-shadow: 0 0 15px #ffeb3b;
    }
    
    .player-bubble .score {
      position: absolute;
      bottom: -25px;
      left: 0;
      right: 0;
      text-align: center;
      font-size: 0.9rem;
      color: white;
      background: rgba(0,0,0,0.7);
      padding: 2px 6px;
      border-radius: 10px;
    }
    
    .leave-room-btn {
      background: #ff6b6b;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      flex-shrink: 0;
    }
    
    .leave-room-btn:hover {
      background: #ff5252;
      transform: scale(1.05);
    }
    
    .multiplayer-message {
      background: rgba(156, 39, 176, 0.2);
      border-radius: 12px;
      padding: 15px;
      margin: 15px 0;
      border-left: 4px solid var(--room-color);
      text-align: center;
      font-weight: bold;
    }
    
    /* Container principal */
    .container{
      background: var(--card);
      backdrop-filter: var(--glass);
      width: min(1200px, 94vw);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,.25);
      animation: fadeIn .9s ease;
      margin: 20px auto;
      min-height: auto;
      overflow: visible;
    }
    @keyframes fadeIn{from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:translateY(0)}}
    
    /* Header */
    header{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    h1{
      font-weight:800;
      margin:0;
      font-size: clamp(26px, 3.4vw, 40px);
      text-shadow: 0 3px 8px rgba(0,0,0,.3);
      letter-spacing:.3px;
    }
    
    .multiplayer-btn-header {
      background-color: var(--room-color);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      font-size: 1rem;
      white-space: nowrap;
    }
    
    .multiplayer-btn-header:hover {
      background-color: #7b1fa2;
      transform: scale(1.05);
    }
    
    .admin-btn {
      background-color: #ff6b6b;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      font-size: 1rem;
      white-space: nowrap;
    }
    
    .admin-btn:hover {
      background-color: #ff5252;
      transform: scale(1.05);
    }
    
    .status{
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      font-weight: 600;
      opacity: .95;
    }
    .pill{
      padding: 8px 16px;
      border-radius: 999px;
      background: rgba(255,255,255,.16);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.16);
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }
    
    /* Zone d'affichage */
    .display{
      margin: 24px 0 10px;
      display: grid;
      gap: 15px;
    }
    #prefixDisplay{
      font-size: clamp(36px, 5vw, 64px);
      font-weight:900;
      letter-spacing:.18em;
      text-align:center;
      text-shadow: 0 3px 8px rgba(0,0,0,.28);
    }
    #definitionDisplay{
      font-size: clamp(18px, 2.2vw, 22px);
      line-height:1.6;
      text-align:center;
      background: rgba(0,0,0,.16);
      border-radius:14px;
      padding: 25px;
      min-height: 140px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* Chronom√®tre */
    .chrono-section {
      background: rgba(0,0,0,0.2);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
    }
    
    .chrono-label {
      font-size: 1.2rem;
      margin-bottom: 15px;
      color: #fff;
      font-weight: 600;
    }
    
    #chrono {
      font-size: 4rem;
      font-weight: bold;
      color: #fff;
      background: rgba(0,0,0,0.3);
      border-radius: 15px;
      padding: 20px 40px;
      display: inline-block;
      min-width: 200px;
      transition: all 0.3s ease;
      font-family: 'Courier New', monospace;
      margin: 10px 0;
    }
    #chrono.warning {
      color: #ff9800;
      animation: pulse 1s infinite;
    }
    #chrono.danger {
      color: #ff5252;
      animation: pulse 0.5s infinite;
    }
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }
    
    /* Zone de r√©ponse */
    .answer-section {
      margin: 20px 0;
    }
    
    #answer{
      font-size:1.2rem;
      padding:16px 20px;
      border-radius:12px;
      border:none;
      width:100%;
      background:#fff;
      color:#222;
      outline:none;
      transition:.25s;
      margin: 0;
    }
    #answer:focus{
      box-shadow:0 0 15px var(--brand);
      caret-color:var(--brand);
    }
    
    /* Contr√¥les */
    .controls-section {
      margin: 20px 0;
    }
    
    .controls{
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 10px;
    }
    button{
      padding: 14px;
      font-size: 1.1rem;
      font-weight: 700;
      border-radius: 14px;
      border: none;
      cursor: pointer;
      background: #fff;
      color: var(--brand);
      transition: .25s;
      box-shadow: 0 4px 10px rgba(0,0,0,.1);
    }
    button:hover{
      background: var(--brand);
      color: #fff;
      box-shadow: 0 0 12px #ffffff99, 0 0 18px #2575fcaa;
    }
    button:disabled{
      opacity: .55;
      cursor: not-allowed;
    }
    
    /* Message */
    #message{
      min-height: 40px;
      font-size: 1.1rem;
      font-weight: 700;
      text-align: center;
      margin: 15px 0 0;
      padding: 10px;
      border-radius: 10px;
      background: rgba(0,0,0,0.1);
    }
    
    /* Banque d'initiales */
    .bank-section {
      margin: 25px 0 15px;
    }
    
    .bank{
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
    }
    .bank button{
      background: rgba(255,255,255,.12);
      color: #fff;
      font-weight: 800;
      letter-spacing: .08em;
      border: 2px solid rgba(255,255,255,.18);
      min-width: 60px;
      padding: 15px 0;
    }
    .bank button:hover{
      background: rgba(255,255,255,.2);
      color: var(--brand);
    }
    .bank button.active{
      background: #fff;
      color: var(--brand);
      border-color: var(--brand);
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .controls {
        grid-template-columns: repeat(3, 1fr);
      }
      
      .bank button {
        min-width: 50px;
        padding: 12px 0;
      }
      
      h1 {
        font-size: 1.8rem;
      }
      
      #chrono {
        font-size: 3rem;
        padding: 15px 30px;
      }
      
      .multiplayer-status {
        flex-direction: column;
        gap: 15px;
      }
      
      .players-in-room {
        flex-wrap: wrap;
        justify-content: center;
      }
    }
    
    @media (max-width: 480px) {
      .controls {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .status {
        flex-direction: column;
        align-items: flex-start;
      }
      
      header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .admin-btn, .multiplayer-btn-header {
        align-self: flex-start;
      }
    }
    
    .hidden {
      display: none !important;
    }
    
    .debug-info {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 10px;
      border-radius: 5px;
      font-size: 12px;
      max-width: 300px;
      z-index: 9999;
    }
  </style>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <!-- Debug info -->
  <div id="debugInfo" class="debug-info hidden">
    <div><strong>Debug Info</strong></div>
    <div id="debugStatus">Non connect√©</div>
  </div>

  <!-- Modal Multijoueur -->
  <div class="multiplayer-modal hidden" id="multiplayerModal">
    <div class="multiplayer-content">
      <button class="close-multiplayer" id="closeMultiplayerModal">&times;</button>
      
      <h2 class="multiplayer-title">
        <i class="fas fa-users"></i> MODE MULTIJOUEUR
      </h2>
      
      <div class="multiplayer-buttons">
        <button class="multiplayer-btn" id="createRoomBtn">
          <i class="fas fa-plus-circle"></i> Cr√©er une salle
        </button>
        <button class="multiplayer-btn join" id="joinRoomBtn">
          <i class="fas fa-sign-in-alt"></i> Rejoindre une salle
        </button>
      </div>
      
      <div id="createRoomSection" class="room-section hidden">
        <h3>Cr√©er une nouvelle salle</h3>
        <input type="text" id="roomNameInput" class="room-input" 
               placeholder="Ton pseudo (ex: Moise)" maxlength="20">
        <button id="createRoomConfirm" class="multiplayer-btn">
          <i class="fas fa-gamepad"></i> Cr√©er une salle
        </button>
      </div>
      
      <div id="joinRoomSection" class="room-section hidden">
        <h3>Rejoindre une salle</h3>
        <input type="text" id="roomCodeInput" class="room-input" 
               placeholder="Code de la salle (ex: ABCD)" maxlength="4" style="text-transform:uppercase">
        <input type="text" id="playerNameInput" class="room-input" 
               placeholder="Ton pseudo (ex: Joueur2)" maxlength="20">
        <button id="joinRoomConfirm" class="multiplayer-btn join">
          <i class="fas fa-sign-in-alt"></i> Rejoindre
        </button>
      </div>
      
      <div id="roomInfoSection" class="room-section hidden">
        <div class="room-id-display" id="roomIdDisplay">
          SALLE: ABCD
        </div>
        
        <button class="copy-btn" id="copyRoomCodeBtn">
          <i class="fas fa-copy"></i> Copier le code
        </button>
        
        <div class="room-info">
          <h4>Joueurs dans la salle (<span id="playerCount">0</span>/8)</h4>
          <ul class="players-list" id="playersList">
            <!-- Les joueurs seront ajout√©s ici -->
          </ul>
        </div>
        
        <button id="startGameBtn" class="multiplayer-btn hidden">
          <i class="fas fa-play-circle"></i> D√©marrer la partie
        </button>
        
        <button id="leaveRoomBtn" class="leave-room-btn" style="width:100%">
          <i class="fas fa-sign-out-alt"></i> Quitter la salle
        </button>
      </div>
      
      <div id="waitingSection" class="room-section hidden">
        <div style="text-align:center; padding:30px;">
          <i class="fas fa-hourglass-half fa-3x" style="color:#e1bee7; margin-bottom:20px;"></i>
          <h3>En attente du cr√©ateur...</h3>
          <p>Le cr√©ateur de la salle va d√©marrer la partie</p>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <header>
      <h1><i class="fas fa-brain"></i> Champs Lexicaux ‚Äì MULTIJOUEUR</h1>
      <div class="status">
        <span class="pill" id="progressPill">
          <i class="fas fa-list-ol"></i> <span id="questionCounter">0/0</span>
        </span>
        <span class="pill" id="scorePill">
          <i class="fas fa-star"></i> Score: <span id="scoreValue">0</span>
        </span>
        <button class="multiplayer-btn-header" id="multiplayerButton">
          <i class="fas fa-users"></i> Multijoueur
        </button>
        <button class="admin-btn" id="adminButton">
          <i class="fas fa-lock"></i> Admin
        </button>
      </div>
    </header>

    <!-- Section Multijoueur (visible quand connect√©) -->
    <div id="multiplayerStatus" class="multiplayer-status hidden">
      <div class="room-indicator">
        <i class="fas fa-door-open"></i>
        <div>
          <div style="font-weight:bold; color:#e1bee7;">SALLE: <span id="currentRoomCode">----</span></div>
          <div style="font-size:0.9rem;">Cr√©√©e par: <span id="roomCreator">---</span></div>
        </div>
      </div>
      
      <div class="players-in-room" id="playersInRoom">
        <!-- Les joueurs seront affich√©s ici -->
      </div>
      
      <button class="leave-room-btn" id="leaveRoomBtnInGame">
        <i class="fas fa-sign-out-alt"></i> Quitter
      </button>
    </div>
    
    <div id="multiplayerMessage" class="multiplayer-message hidden">
      <!-- Messages multijoueur -->
    </div>

    <!-- Zone d'affichage -->
    <div class="display">
      <div id="prefixDisplay">‚Äì ‚Äì</div>
      <div id="definitionDisplay">
        S√©lectionne un champ lexical ci-dessous et clique sur "Jouer".<br>
        Tu as <strong>20 secondes</strong> pour trouver le mot correspondant !
      </div>
    </div>

    <!-- Chronom√®tre -->
    <div class="chrono-section">
      <div class="chrono-label">
        <i class="fas fa-clock"></i> TEMPS RESTANT
      </div>
      <div id="chrono">20</div>
    </div>

    <!-- Zone de r√©ponse -->
    <div class="answer-section">
      <input type="text" id="answer" placeholder="√âcris le mot correct (m√™mes initiales) et appuie sur Entr√©e‚Ä¶" autocomplete="off" />
    </div>

    <!-- Contr√¥les -->
    <div class="controls-section">
      <div class="controls" role="group" aria-label="Commandes">
        <button id="btnPlay">
          <i class="fas fa-play"></i> Jouer
        </button>
        <button id="btnSlow">
          <i class="fas fa-turtle"></i> Ralentir
        </button>
        <button id="btnFast">
          <i class="fas fa-rabbit"></i> Acc√©l√©rer
        </button>
        <button id="btnRepeat">
          <i class="fas fa-redo"></i> R√©p√©ter
        </button>
        <button id="btnSkip">
          <i class="fas fa-forward"></i> Passer
        </button>
        <button id="btnBack">
          <i class="fas fa-backward"></i> Retour
        </button>
      </div>
    </div>

    <!-- Message -->
    <div id="message" aria-live="polite"></div>

    <!-- Banque d'initiales -->
    <div class="bank-section">
      <div class="bank" id="initialBank" aria-label="Liste d'initiales (s√©lection rapide)"></div>
    </div>
  </div>

  <script>
    // üî• CONFIGURATION FIREBASE SIMPLIFI√âE
    const firebaseConfig = {
      apiKey: "AIzaSyBPBq1uT7lbL9Xp_neAJh2lSe0MRErlYdo",
      authDomain: "evoir-1.firebaseapp.com",
      projectId: "evoir-1",
      storageBucket: "evoir-1.firebasestorage.app",
      messagingSenderId: "504718469638",
      appId: "1:504718469638:web:72707fd51d0ce6ff773187"
    };

    // Initialiser Firebase
    try {
      firebase.initializeApp(firebaseConfig);
      console.log("‚úÖ Firebase initialis√©");
    } catch (error) {
      console.error("‚ùå Erreur Firebase:", error);
    }
    
    const db = firebase.firestore();
    
    // Activer le debug
    document.getElementById('debugInfo').classList.remove('hidden');

    // Donn√©es : champs lexicaux (COMPLETS)
    const FIELDS = {
      "Pr": [
        {mot:"Pr√©cision", def:"Le fait de donner des d√©tails exacts et pr√©cis sur quelque chose."},
        {mot:"Profond", def:"Qui se rapporte √† la profondeur ou √† une intensit√© importante."},
        {mot:"Profession", def:"Domaine d'activit√© ou m√©tier dans lequel une personne travaille."},
        {mot:"Progr√®s", def:"Avancement ou am√©lioration dans une situation ou un domaine."},
        {mot:"Promesse", def:"Engagement ou parole donn√©e de faire quelque chose."},
        {mot:"Proverbe", def:"Expression populaire qui contient une sagesse ou un conseil."},
        {mot:"Pr√©cieux", def:"Qui a une grande valeur ou importance."},
        {mot:"Pr√©paration", def:"Action de se pr√©parer en vue d'une activit√©."},
        {mot:"Pr√©caution", def:"Mesure prise pour √©viter un danger ou un probl√®me."},
        {mot:"Privil√®ge", def:"Avantage ou droit sp√©cial accord√© √† certaines personnes."}
      ],
      "Se": [
        {mot:"Sensation", def:"Perception ou ressenti d'un stimulus par les sens."},
        {mot:"S√©duction", def:"Charme ou pouvoir d'attraction envers quelqu'un."},
        {mot:"S√©r√©nit√©", def:"√âtat de calme et de tranquillit√©."},
        {mot:"Secret", def:"Quelque chose qui est cach√© ou inconnu du public."},
        {mot:"S√©paration", def:"Acte de se s√©parer ou de se diviser."},
        {mot:"S√©rieux", def:"√âtat de responsabilit√© et de gravit√©."},
        {mot:"Sentiment", def:"√âmotion ou affection ressentie envers quelqu'un ou quelque chose."},
        {mot:"Service", def:"Action d'aider ou d'assister quelqu'un."},
        {mot:"Seconde", def:"Unit√© de temps ou rang apr√®s la premi√®re."},
        {mot:"Septi√®me", def:"Position dans une s√©rie apr√®s le sixi√®me."}
      ],
      "Tr": [
        {mot:"Transformation", def:"Changement ou m√©tamorphose d'une chose en une autre."},
        {mot:"Tristesse", def:"√âtat de chagrin ou de m√©lancolie."},
        {mot:"Travail", def:"Emploi ou activit√© professionnelle."},
        {mot:"Traitement", def:"Action de soigner ou de proc√©der √† une proc√©dure m√©dicale."},
        {mot:"Tradition", def:"Coutume transmise de g√©n√©ration en g√©n√©ration."},
        {mot:"Trag√©die", def:"Drame qui provoque de la tristesse ou du d√©sespoir."},
        {mot:"Trenti√®me", def:"Position dans une s√©rie apr√®s le vingt-neuvi√®me."},
        {mot:"Triomphe", def:"Victoire √©clatante √† l'issue d'une lutte."},
        {mot:"Transparence", def:"Clart√© d'une substance ou d'une situation."},
        {mot:"Tr√©sor", def:"Richesse ou bien pr√©cieux √† valeur sentimentale ou mat√©rielle."}
      ],
      "Ac": [
        {mot:"Accompagnement", def:"Soutien ou aide fournie √† quelqu'un."},
        {mot:"Acc√®s", def:"Possibilit√© d'entrer dans un lieu ou d'obtenir quelque chose."},
        {mot:"Action", def:"Acte de faire quelque chose."},
        {mot:"Activit√©", def:"Occupation ou exercice d'une action."},
        {mot:"Achat", def:"Acquisition d'un bien."},
        {mot:"Accident", def:"√âv√©nement impr√©vu, souvent tragique."},
        {mot:"Accord", def:"Entente ou consensus entre plusieurs personnes."},
        {mot:"Acquisition", def:"Obtention d'une chose."},
        {mot:"Acteur", def:"Personne qui joue un r√¥le au th√©√¢tre ou au cin√©ma."},
        {mot:"Acclamation", def:"Applaudissements ou √©loges enthousiastes."}
      ],
      "Ca": [
        {mot:"Caract√®re", def:"Ensemble de traits distinctifs d'une personne ou d'une chose."},
        {mot:"Carte", def:"Document repr√©sentant une r√©gion ou un territoire."},
        {mot:"Cascade", def:"Chute d'eau sur une pente."},
        {mot:"Cadeau", def:"Objet offert pour une occasion ou par affection."},
        {mot:"Caisse", def:"Contenant destin√© au transport d'objets."},
        {mot:"Cam√©ra", def:"Appareil pour prendre des photos ou filmer."},
        {mot:"Campagne", def:"R√©gion rurale, √©loign√©e de la ville."},
        {mot:"Canal", def:"Voie d'eau artificielle pour le transport."},
        {mot:"Capacit√©", def:"Aptitude √† faire, comprendre ou apprendre."},
        {mot:"Capitale", def:"Ville principale d'un pays ou d'une r√©gion."}
      ],
      "Me": [
        {mot:"M√©moire", def:"Capacit√© de se souvenir et de rappeler des informations."},
        {mot:"M√©thode", def:"Mani√®re sp√©cifique d'effectuer une t√¢che."},
        {mot:"M√©lodie", def:"S√©quence agr√©able de notes musicales."},
        {mot:"Menu", def:"Liste de plats ou d'options dans un programme."},
        {mot:"M√©contentement", def:"Sentiment de ne pas √™tre satisfait."},
        {mot:"Mesure", def:"Quantit√© ou √©chelle pour √©valuer quelque chose."},
        {mot:"Merveille", def:"Chose tr√®s impressionnante ou √©tonnante."},
        {mot:"M√©ditation", def:"Pratique de relaxation et de concentration."},
        {mot:"Messagerie", def:"Syst√®me d'envoi et de r√©ception de messages."},
        {mot:"M√©morable", def:"Qui m√©rite d'√™tre rappel√©."}
      ]
    };

    // √âl√©ments DOM
    const prefixDisplay = document.getElementById("prefixDisplay");
    const definitionDisplay = document.getElementById("definitionDisplay");
    const answerInput = document.getElementById("answer");
    const message = document.getElementById("message");
    const btnPlay = document.getElementById("btnPlay");
    const btnSlow = document.getElementById("btnSlow");
    const btnFast = document.getElementById("btnFast");
    const btnRepeat = document.getElementById("btnRepeat");
    const btnSkip = document.getElementById("btnSkip");
    const btnBack = document.getElementById("btnBack");
const initialBank = document.getElementById("initialBank");
const progressPill = document.getElementById("progressPill");
const scorePill = document.getElementById("scorePill");
const chronoDisplay = document.getElementById("chrono");
const questionCounter = document.getElementById("questionCounter");
const scoreValue = document.getElementById("scoreValue");
const debugStatus = document.getElementById("debugStatus");
// √âl√©ments Multijoueur
const multiplayerModal = document.getElementById("multiplayerModal");
const multiplayerButton = document.getElementById("multiplayerButton");
const closeMultiplayerModal = document.getElementById("closeMultiplayerModal");
const createRoomBtn = document.getElementById("createRoomBtn");
const joinRoomBtn = document.getElementById("joinRoomBtn");
const createRoomSection = document.getElementById("createRoomSection");
const joinRoomSection = document.getElementById("joinRoomSection");
const roomInfoSection = document.getElementById("roomInfoSection");
const waitingSection = document.getElementById("waitingSection");
const createRoomConfirm = document.getElementById("createRoomConfirm");
const joinRoomConfirm = document.getElementById("joinRoomConfirm");
const roomIdDisplay = document.getElementById("roomIdDisplay");
const copyRoomCodeBtn = document.getElementById("copyRoomCodeBtn");
const playersList = document.getElementById("playersList");
const startGameBtn = document.getElementById("startGameBtn");
const leaveRoomBtn = document.getElementById("leaveRoomBtn");
const multiplayerStatus = document.getElementById("multiplayerStatus");
const playersInRoom = document.getElementById("playersInRoom");
const currentRoomCode = document.getElementById("currentRoomCode");
const roomCreator = document.getElementById("roomCreator");
const leaveRoomBtnInGame = document.getElementById("leaveRoomBtnInGame");
const multiplayerMessage = document.getElementById("multiplayerMessage");

// √âtat du jeu
let currentPrefix = null;
let currentIndex = 0;
let speechRate = 1;
let score = 0;
let chronoTimer = null;
let timeLeft = 20;
let gameActive = false;
let playerName = "Joueur";

// Variables Multijoueur
let currentRoomId = null;
let isRoomCreator = false;
let players = [];
let playerId = null;
let roomUnsubscribe = null;
let gameStateUnsubscribe = null;
let multiplayerGameActive = false;

// üî• SUPPRIMER TOUTE LA COMPLEXIT√â - GARDER L'ESSENTIEL
function updateDebugInfo(text) {
  debugStatus.textContent = text;
  console.log("DEBUG:", text);
}

// G√©n√©rer un ID de joueur unique
function generatePlayerId() {
  return 'player_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
}

// G√©n√©rer un code de salle simple
function generateRoomCode() {
  return Math.random().toString(36).substr(2, 4).toUpperCase();
}

// üî• SIMPLIFIER : Cr√©er une salle
createRoomConfirm.addEventListener('click', async () => {
  const name = document.getElementById('roomNameInput').value || "Cr√©ateur";
  playerName = name;
  
  try {
    const roomCode = generateRoomCode();
    playerId = generatePlayerId();
    
    updateDebugInfo(`Cr√©ation salle ${roomCode}...`);
    
    // Structure SIMPLIFI√âE
    const roomData = {
      code: roomCode,
      name: name + " - Salle",
      creatorId: playerId,
      creatorName: playerName,
      players: [{
        id: playerId,
        name: playerName,
        score: 0,
        isCreator: true,
        joinedAt: Date.now()
      }],
      gameState: {
        active: false,
        currentPrefix: null,
        currentIndex: 0
      },
      createdAt: Date.now(),
      lastUpdate: Date.now()
    };
    
    await db.collection('rooms').doc(roomCode).set(roomData);
    updateDebugInfo(`‚úÖ Salle ${roomCode} cr√©√©e`);
    
    currentRoomId = roomCode;
    isRoomCreator = true;
    joinRoom(roomCode);
    
  } catch (error) {
    updateDebugInfo(`‚ùå Erreur cr√©ation: ${error.message}`);
    alert("Erreur cr√©ation salle. V√©rifie ta connexion.");
  }
});

// üî• SIMPLIFIER : Rejoindre une salle
joinRoomConfirm.addEventListener('click', async () => {
  const roomCode = document.getElementById('roomCodeInput').value.toUpperCase();
  const name = document.getElementById('playerNameInput').value || "Joueur";
  
  if (!roomCode || roomCode.length !== 4) {
    alert("Code salle: 4 lettres/chiffres");
    return;
  }
  
  updateDebugInfo(`Connexion salle ${roomCode}...`);
  
  try {
    const roomDoc = await db.collection('rooms').doc(roomCode).get();
    
    if (!roomDoc.exists) {
      alert("Salle non trouv√©e");
      updateDebugInfo("‚ùå Salle inexistante");
      return;
    }
    
    playerId = generatePlayerId();
    playerName = name;
    currentRoomId = roomCode;
    isRoomCreator = false;
    
    updateDebugInfo(`‚úÖ Salle trouv√©e, connexion...`);
    joinRoom(roomCode);
    
  } catch (error) {
    updateDebugInfo(`‚ùå Erreur connexion: ${error.message}`);
    alert("Erreur connexion. V√©rifie le code et ta connexion.");
  }
});

// üî• ULTRA-SIMPLIFI√â : Joindre une salle
async function joinRoom(roomCode) {
  try {
    const roomRef = db.collection('rooms').doc(roomCode);
    const roomDoc = await roomRef.get();
    
    if (!roomDoc.exists) {
      alert("Salle supprim√©e");
      return;
    }
    
    const roomData = roomDoc.data();
    
    // Ajouter le joueur
    await roomRef.update({
      players: firebase.firestore.FieldValue.arrayUnion({
        id: playerId,
        name: playerName,
        score: 0,
        isCreator: isRoomCreator,
        joinedAt: Date.now()
      }),
      lastUpdate: Date.now()
    });
    
    // Afficher infos
    showRoomInfo(roomCode);
    subscribeToRoom(roomCode);
    
    multiplayerStatus.classList.remove('hidden');
    currentRoomCode.textContent = roomCode;
    updateDebugInfo(`‚úÖ Connect√© √† ${roomCode} comme ${playerName}`);
    
  } catch (error) {
    updateDebugInfo(`‚ùå Erreur joinRoom: ${error.message}`);
  }
}

// üî• SUIVRE LES CHANGEMENTS DE LA SALLE
function subscribeToRoom(roomCode) {
  if (roomUnsubscribe) roomUnsubscribe();
  
  roomUnsubscribe = db.collection('rooms').doc(roomCode)
    .onSnapshot((doc) => {
      if (!doc.exists) {
        updateDebugInfo("‚ùå Salle supprim√©e");
        return;
      }
      
      const roomData = doc.data();
      updateRoomDisplay(roomData);
      
    }, (error) => {
      updateDebugInfo(`‚ùå Erreur √©coute: ${error.message}`);
    });
}

// üî• METTRE √Ä JOUR L'AFFICHAGE
function updateRoomDisplay(roomData) {
  // Mettre √† jour les joueurs
  updatePlayersList(roomData.players);
  updatePlayersInGame(roomData.players);
  
  document.getElementById('playerCount').textContent = roomData.players.length;
  roomCreator.textContent = roomData.creatorName;
  
  // G√©rer l'√©tat du jeu
  if (roomData.gameState.active) {
    multiplayerGameActive = true;
    waitingSection.classList.remove('hidden');
    roomInfoSection.classList.add('hidden');
    
    // Synchroniser le jeu
    syncGameState(roomData.gameState);
  } else {
    multiplayerGameActive = false;
    gameActive = false;
    stopChrono();
  }
}

// üî• SYNCHRONISER L'√âTAT DU JEU
function syncGameState(gameState) {
  if (gameState.currentPrefix) {
    currentPrefix = gameState.currentPrefix;
    currentIndex = gameState.currentIndex;
    renderCard();
    
    if (!gameActive) {
      gameActive = true;
      startChrono();
    }
    
    multiplayerMessage.classList.remove('hidden');
    multiplayerMessage.innerHTML = `
      <i class="fas fa-gamepad"></i> Partie en cours - 
      Question ${currentIndex + 1}/10 - 
      Champ: <strong>${currentPrefix}</strong>
    `;
  }
}

// üî• D√âMARRER LE JEU
startGameBtn.addEventListener('click', async () => {
  if (!currentRoomId || !isRoomCreator) return;
  
  const prefixes = Object.keys(FIELDS);
  const randomPrefix = prefixes[Math.floor(Math.random() * prefixes.length)];
  
  try {
    await db.collection('rooms').doc(currentRoomId).update({
      'gameState.active': true,
      'gameState.currentPrefix': randomPrefix,
      'gameState.currentIndex': 0,
      'gameState.startedAt': Date.now(),
      lastUpdate: Date.now()
    });
    
    multiplayerMessage.classList.remove('hidden');
    multiplayerMessage.innerHTML = `
      <i class="fas fa-gamepad"></i> Partie d√©marr√©e ! 
      Champ lexical: <strong>${randomPrefix}</strong>
    `;
    
    updateDebugInfo("‚úÖ Jeu d√©marr√©");
    
  } catch (error) {
    updateDebugInfo(`‚ùå Erreur d√©marrage: ${error.message}`);
  }
});

// üî• PASSER √Ä LA QUESTION SUIVANTE
async function nextQuestion() {
  if (!currentRoomId || !isRoomCreator) return;
  
  const list = FIELDS[currentPrefix];
  const nextIndex = currentIndex + 1;
  
  if (nextIndex >= list.length) {
    // Fin du champ
    await db.collection('rooms').doc(currentRoomId).update({
      'gameState.active': false,
      lastUpdate: Date.now()
    });
    
    multiplayerMessage.innerHTML = `
      <i class="fas fa-flag-checkered"></i> Champ lexical termin√© !
    `;
    return;
  }
  
  await db.collection('rooms').doc(currentRoomId).update({
    'gameState.currentIndex': nextIndex,
    lastUpdate: Date.now()
  });
}

// üî• METTRE √Ä JOUR LES JOUEURS
function updatePlayersList(playersArray) {
  playersList.innerHTML = '';
  players = playersArray;
  
  playersArray.forEach(player => {
    const li = document.createElement('li');
    if (player.id === playerId) {
      li.classList.add('you');
    }
    
    li.innerHTML = `
      <span class="player-badge">${player.name.charAt(0).toUpperCase()}</span>
      <span>${player.name} ${player.isCreator ? '(Cr√©ateur)' : ''}</span>
      <span style="margin-left:auto; font-weight:bold;">${player.score} pts</span>
    `;
    
    playersList.appendChild(li);
  });
}

function updatePlayersInGame(playersArray) {
  playersInRoom.innerHTML = '';
  
  playersArray.forEach(player => {
    const bubble = document.createElement('div');
    bubble.className = `player-bubble ${player.id === playerId ? 'you' : ''}`;
    bubble.innerHTML = `
      ${player.name.charAt(0).toUpperCase()}
      <div class="score">${player.score}</div>
    `;
    playersInRoom.appendChild(bubble);
  });
}

// üî• METTRE √Ä JOUR LE SCORE
async function updatePlayerScore(newScore) {
  if (!currentRoomId) return;
  
  try {
    const roomRef = db.collection('rooms').doc(currentRoomId);
    const roomDoc = await roomRef.get();
    
    if (!roomDoc.exists) return;
    
    const roomData = roomDoc.data();
    const updatedPlayers = roomData.players.map(p => {
      if (p.id === playerId) {
        return { ...p, score: newScore };
      }
      return p;
    });
    
    await roomRef.update({
      players: updatedPlayers,
      lastUpdate: Date.now()
    });
    
    score = newScore;
    updatePills();
    
  } catch (error) {
    updateDebugInfo(`‚ùå Erreur score: ${error.message}`);
  }
}

// Afficher infos salle
function showRoomInfo(roomCode) {
  createRoomSection.classList.add('hidden');
  joinRoomSection.classList.add('hidden');
  roomInfoSection.classList.remove('hidden');
  roomIdDisplay.textContent = `SALLE: ${roomCode}`;
  startGameBtn.classList.toggle('hidden', !isRoomCreator);
}

// Copier code
copyRoomCodeBtn.addEventListener('click', () => {
  navigator.clipboard.writeText(currentRoomId)
    .then(() => {
      copyRoomCodeBtn.innerHTML = '<i class="fas fa-check"></i> Copi√© !';
      setTimeout(() => {
        copyRoomCodeBtn.innerHTML = '<i class="fas fa-copy"></i> Copier le code';
      }, 2000);
    });
});

// Quitter salle
leaveRoomBtn.addEventListener('click', leaveRoom);
leaveRoomBtnInGame.addEventListener('click', leaveRoom);

async function leaveRoom() {
  if (!currentRoomId) return;
  
  try {
    const roomRef = db.collection('rooms').doc(currentRoomId);
    const roomDoc = await roomRef.get();
    
    if (roomDoc.exists) {
      const roomData = roomDoc.data();
      const player = roomData.players.find(p => p.id === playerId);
      
      if (player) {
        await roomRef.update({
          players: firebase.firestore.FieldValue.arrayRemove(player),
          lastUpdate: Date.now()
        });
        
        // Si salle vide, supprimer
        const newData = await roomRef.get();
        if (newData.exists && newData.data().players.length === 0) {
          await roomRef.delete();
        }
      }
    }
    
    resetMultiplayerState();
    
  } catch (error) {
    updateDebugInfo(`‚ùå Erreur sortie: ${error.message}`);
  }
}

// R√©initialiser
function resetMultiplayerState() {
  if (roomUnsubscribe) roomUnsubscribe();
  
  currentRoomId = null;
  isRoomCreator = false;
  multiplayerGameActive = false;
  players = [];
  
  multiplayerModal.classList.add('hidden');
  multiplayerStatus.classList.add('hidden');
  multiplayerMessage.classList.add('hidden');
  
  gameActive = false;
  stopChrono();
  updateDebugInfo("D√©connect√©");
}

// üî• FONCTIONS DE BASE DU JEU (inchang√©es)
function startChrono() {
  if (chronoTimer) clearInterval(chronoTimer);
  timeLeft = 20;
  chronoDisplay.textContent = timeLeft;
  chronoDisplay.className = "";
  
  chronoTimer = setInterval(() => {
    timeLeft--;
    chronoDisplay.textContent = timeLeft;
    
    if (timeLeft <= 5) {
      chronoDisplay.className = "danger";
    } else if (timeLeft <= 10) {
      chronoDisplay.className = "warning";
    }
    
    if (timeLeft <= 0) {
      clearInterval(chronoTimer);
      timeUp();
    }
  }, 1000);
}

function stopChrono() {
  if (chronoTimer) {
    clearInterval(chronoTimer);
    chronoTimer = null;
  }
}

function timeUp() {
  if (!gameActive) return;
  
  const item = FIELDS[currentPrefix][currentIndex];
  message.textContent = `‚è∞ Temps √©coul√© ! R√©ponse : ${item.mot}`;
  message.style.color = "#ff5252";
  
  if (multiplayerGameActive && isRoomCreator) {
    setTimeout(() => {
      nextQuestion();
    }, 2000);
  } else if (!multiplayerGameActive) {
    setTimeout(next, 2000);
  }
}

const normalize = s => s
  .toLowerCase()
  .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
  .replace(/[^a-z\-' ]/g,'')
  .trim();

function updatePills(){
  const total = currentPrefix ? FIELDS[currentPrefix].length : 0;
  questionCounter.textContent = `${currentIndex+1}/${total}`;
  scoreValue.textContent = score;
}

function ttsCancel(){ if ('speechSynthesis' in window) speechSynthesis.cancel(); }
function speak(text, rate=speechRate){
  if(!('speechSynthesis' in window)) { return; }
  ttsCancel();
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'fr-FR';
  u.rate = rate;
  speechSynthesis.speak(u);
}

function announce(){
  if(!currentPrefix) return;
  const item = FIELDS[currentPrefix][currentIndex];
  const intro = `Toutes les bonnes r√©ponses commencent par les lettres : ${currentPrefix}.`;
  const def  = item.def;
  speak(`${intro} D√©finition : ${def}`);
  if (!multiplayerGameActive) {
    startChrono();
  }
  gameActive = true;
}

function renderCard(){
  if(!currentPrefix){
    prefixDisplay.textContent = "‚Äì ‚Äì";
    definitionDisplay.innerHTML = `
      S√©lectionne un champ lexical ci-dessous et clique sur "Jouer".<br>
      Tu as <strong>20 secondes</strong> pour trouver le mot correspondant !
    `;
    updatePills();
    return;
  }
  const item = FIELDS[currentPrefix][currentIndex];
  prefixDisplay.textContent = currentPrefix;
  definitionDisplay.textContent = item.def;
  message.textContent = `Joueur: ${playerName} - Temps: ${timeLeft}s - Mot commence par ${currentPrefix}`;
  message.style.color = "#fff";
  answerInput.value = "";
  answerInput.placeholder = `√âcris un mot qui commence par ¬´ ${currentPrefix} ¬ª‚Ä¶`;
  updatePills();
  answerInput.focus();
}

function setPrefix(prefix){
  if(!FIELDS[prefix]) return;
  currentPrefix = prefix;
  currentIndex = 0;
  score = 0;
  highlightBank(prefix);
  renderCard();
  gameActive = false;
  stopChrono();
  answerInput.focus();
}

function next(){
  if(!currentPrefix) return;
  currentIndex++;
  const list = FIELDS[currentPrefix];
  if(currentIndex >= list.length){
    currentIndex = list.length-1;
    message.innerHTML = `üéâ ${playerName} a termin√© ! Score: ${score}/${list.length}`;
    message.style.color = "#00e676";
    gameActive = false;
    stopChrono();
    return;
  }
  renderCard();
  announce();
}

function back(){
  if(!currentPrefix) return;
  if(currentIndex > 0){
    currentIndex--;
    gameActive = false;
    stopChrono();
    renderCard();
    answerInput.focus();
  }
}

function repeat(){ 
  if (gameActive) {
    announce(); 
  }
}

function slower(){
  speechRate = Math.max(0.5, speechRate - 0.25);
  if (gameActive) announce();
}

function faster(){
  speechRate = Math.min(2, speechRate + 0.25);
  if (gameActive) announce();
}

async function check(){
  if(!currentPrefix || !gameActive) return;
  
  const item = FIELDS[currentPrefix][currentIndex];
  const user = normalize(answerInput.value);
  const target = normalize(item.mot);
  const timeUsed = 20 - timeLeft;

  if(user && user.startsWith(normalize(currentPrefix)) && user === target){
    stopChrono();
    const newScore = score + 1;
    message.innerHTML = `‚úÖ Correct ! Temps: ${timeUsed}s - Score: ${newScore}`;
    message.style.color = "#00e676";
    
    if (multiplayerGameActive) {
      await updatePlayerScore(newScore);
      if (isRoomCreator) {
        setTimeout(() => {
          nextQuestion();
        }, 1500);
      }
    } else {
      score = newScore;
      setTimeout(next, 1500);
    }
  } else {
    message.innerHTML = `‚ùå Incorrect. R√©ponse: ${item.mot}`;
    message.style.color = "#ff5252";
    
    if (multiplayerGameActive && isRoomCreator) {
      setTimeout(() => {
        nextQuestion();
      }, 2000);
    } else if (!multiplayerGameActive) {
      setTimeout(next, 2000);
    }
  }
}

// Banque d'initiales
function buildBank(){
  const keys = Object.keys(FIELDS);
  keys.sort((a,b)=>a.localeCompare(b,'fr'));
  initialBank.innerHTML = "";
  for(const k of keys){
    const btn = document.createElement("button");
    btn.textContent = k.toUpperCase();
    btn.setAttribute("aria-label", `Choisir le champ lexical ${k}`);
    btn.addEventListener("click", ()=> setPrefix(k));
    initialBank.appendChild(btn);
  }
}

function highlightBank(k){
  [...initialBank.children].forEach(b=>{
    b.classList.toggle('active', b.textContent === k.toUpperCase());
  });
}

// √âcouteurs
btnPlay.addEventListener("click", ()=>{
  if(!currentPrefix){
    const first = Object.keys(FIELDS).sort((a,b)=>a.localeCompare(b,'fr'))[0];
    setPrefix(first);
    announce();
  }else{
    announce();
  }
});

btnSlow.addEventListener("click", slower);
btnFast.addEventListener("click", faster);
btnRepeat.addEventListener("click", repeat);
btnSkip.addEventListener("click", next);
btnBack.addEventListener("click", back);

answerInput.addEventListener("keydown", (e)=>{
  if(e.key === "Enter" && gameActive) check();
});

// Interface multijoueur
multiplayerButton.addEventListener('click', () => {
  multiplayerModal.classList.remove('hidden');
  showMainMenu();
  document.body.style.overflow = 'hidden';
  updateDebugInfo("Modal ouvert");
});

closeMultiplayerModal.addEventListener('click', () => {
  multiplayerModal.classList.add('hidden');
  document.body.style.overflow = 'auto';
});

multiplayerModal.addEventListener('click', (e) => {
  if (e.target === multiplayerModal) {
    multiplayerModal.classList.add('hidden');
    document.body.style.overflow = 'auto';
  }
});

createRoomBtn.addEventListener('click', () => {
  showMainMenu();
  createRoomSection.classList.remove('hidden');
});

joinRoomBtn.addEventListener('click', () => {
  showMainMenu();
  joinRoomSection.classList.remove('hidden');
});

// Initialisation
window.addEventListener("load", ()=>{
  buildBank();
  renderCard();
  updateDebugInfo("Pr√™t");
  if(!('speechSynthesis' in window)){
    message.innerHTML = "‚ö†Ô∏è Synth√®se vocale non disponible";
  }
});

// Nettoyage
window.addEventListener('beforeunload', () => {
  if (currentRoomId) {
    leaveRoom();
  }
});

</script>
</body>
</html>

