<!-- √âPELLATION BIBLIQUE SP√âCIALE DIOC√àSE ‚Äî Composant autonome
     Auteur: toi :) | Aucune d√©pendance externe | Fonctionne hors-ligne
     Conseil: place ce bloc dans ta page l√† o√π tu veux le widget. -->

<section id="epellation-biblique" lang="fr" dir="ltr">
  <style>
    /* ---------- Design g√©n√©ral (glass + gradient anim√©) ---------- */
    #epellation-biblique {
      --bg: #0e0f13;
      --card: rgba(255, 255, 255, 0.06);
      --card-hover: rgba(255, 255, 255, 0.10);
      --text: #e9edf1;
      --muted: #b8c1cc;
      --chip: rgba(255, 255, 255, 0.10);
      --ok: #27d696;
      --warn: #ffb020;
      --accent1: #7b5cff;
      --accent2: #44d1ff;
      --accent3: #75f3b4;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
      --radius-sm: 10px;
      --radius-lg: 22px;
      --speed: 260ms;
      color: var(--text);
      font: 500 16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Color Emoji", "Apple Color Emoji", sans-serif;
      background:
        radial-gradient(1200px 600px at 10% -10%, #2a1f5b66, transparent 60%),
        radial-gradient(900px 600px at 110% 10%, #0a5d7a55, transparent 60%),
        radial-gradient(800px 500px at 50% 120%, #0a7a4244, transparent 60%),
        var(--bg);
      padding: 48px 20px 64px;
      position: relative;
      overflow: clip;
    }

    /* ruban lumineux anim√© */
    #epellation-biblique::before {
      content: "";
      position: absolute;
      inset: -40% -20%;
      background: conic-gradient(from 180deg,
        var(--accent1), var(--accent2), var(--accent3), var(--accent1));
      filter: blur(80px) saturate(140%);
      opacity: .12;
      animation: swirl 26s linear infinite;
      pointer-events: none;
    }
    @keyframes swirl { to { transform: rotate(360deg); } }

    .wrap { max-width: 1100px; margin: 0 auto; position: relative; z-index: 1; }

    .title {
      display: grid;
      gap: 10px;
      margin-bottom: 24px;
      text-align: center;
    }
    .title h1 {
      margin: 0;
      font-size: clamp(28px, 4vw, 40px);
      line-height: 1.15;
      letter-spacing: .3px;
      background: linear-gradient(90deg, var(--accent1), var(--accent2), var(--accent3));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      filter: drop-shadow(0 6px 16px rgba(0,0,0,.25));
    }
    .title p { margin: 0; color: var(--muted) }

    /* barre d‚Äôoutils */
    .toolbar {
      display: grid;
      grid-template-columns: 1fr auto auto;
      gap: 10px;
      align-items: center;
      margin: 22px auto 16px;
    }
    .search {
      position: relative;
    }
    .search input {
      width: 100%;
      padding: 14px 44px 14px 44px;
      border-radius: var(--radius);
      background: var(--card);
      border: 1px solid rgba(255,255,255,.12);
      color: var(--text);
      outline: none;
      transition: border var(--speed), background var(--speed), box-shadow var(--speed);
      box-shadow: var(--shadow);
    }
    .search input::placeholder { color: #9fb0bf; opacity: .9 }
    .search .icon {
      position: absolute; left: 12px; top: 50%; translate: 0 -50%;
      font-size: 18px; opacity: .8;
    }
    .btn, .file {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 12px 14px; border-radius: var(--radius-sm);
      background: var(--chip); border: 1px solid rgba(255,255,255,.14);
      color: var(--text); cursor: pointer; transition: background var(--speed), transform var(--speed);
      box-shadow: var(--shadow); text-decoration: none; user-select: none;
    }
    .btn:active { transform: translateY(1px) }
    .file input { display: none }
    .pill {
      justify-self: start; display: inline-flex; gap: 6px; flex-wrap: wrap; align-items: center;
      padding: 10px 12px; border-radius: 999px; background: var(--chip); border: 1px solid rgba(255,255,255,.14);
      font-size: 14px; color: var(--muted);
    }

    /* grille de cartes */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 16px;
      margin-top: 10px;
    }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border: 1px solid rgba(255,255,255,.16);
      border-radius: var(--radius-lg);
      padding: 14px;
      transition: transform var(--speed), background var(--speed), border var(--speed);
      position: relative;
      overflow: clip;
      box-shadow: var(--shadow);
      backdrop-filter: blur(6px);
    }
    .card:hover { transform: translateY(-3px); background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.05)); }

    .badge {
      position: absolute; top: 12px; right: 12px;
      padding: 6px 10px; border-radius: 999px; font-size: 12px; letter-spacing: .2px;
      background: rgba(123,92,255,.20); border: 1px solid rgba(123,92,255,.35);
      color: #dfddff;
    }
    .name {
      font-weight: 800; letter-spacing: .3px;
      font-size: 20px; margin: 4px 36px 10px 2px;
    }
    .aliases {
      margin: -6px 0 8px 2px; font-size: 12.5px; color: var(--muted);
    }

    /* onglets */
    .tabs { display: grid; gap: 8px; }
    .tab-list {
      display: grid; grid-auto-flow: column; gap: 8px; align-items: center;
    }
    .tab-btn {
      background: var(--chip); border: 1px solid rgba(255,255,255,.14);
      border-radius: 999px; padding: 8px 10px; font-size: 13px; cursor: pointer;
      color: var(--text); transition: background var(--speed), transform var(--speed), border var(--speed);
    }
    .tab-btn[aria-selected="true"] {
      background: linear-gradient(90deg, rgba(123,92,255,.35), rgba(68,209,255,.35));
      border-color: rgba(255,255,255,.22);
    }
    .panel {
      border-radius: var(--radius);
      border: 1px dashed rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      padding: 10px 12px; min-height: 70px; position: relative;
    }
    .panel p { margin: 0; }

    .meta {
      display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px;
    }
    .chip { font-size: 12px; padding: 6px 10px; border-radius: 999px;
      background: var(--chip); border: 1px solid rgba(255,255,255,.14); color: var(--muted);
    }

    .actions {
      display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap;
    }
    .edit { border-color: rgba(255,255,255,.25); }
    .save-ok { color: var(--ok); font-weight: 700; }

    /* √©tat ‚Äú√† compl√©ter‚Äù */
    .todo { color: #ffe7a8; }
    .todo .panel { border-style: solid; border-color: rgba(255,176,32,.45) }

    /* footer */
    .foot {
      display: flex; justify-content: space-between; align-items: center; gap: 10px;
      margin-top: 16px; color: var(--muted); font-size: 12.5px;
    }

    /* responsive toolbar */
    @media (max-width: 740px) {
      .toolbar { grid-template-columns: 1fr; }
    }
  </style>

  <div class="wrap" id="widget-root">
    <div class="title">
      <h1>√âpellation biblique sp√©ciale dioc√®se</h1>
      <p>Noms propres et personnages ‚Äî prononciation, versets, histoire</p>
    </div>

    <div class="toolbar">
      <div class="search" role="search">
        <span class="icon">üîé</span>
        <input id="searchInput" type="search" autocomplete="off" placeholder="Rechercher un nom (ex. Abraham, √âsa√º, Mo√Øse)‚Ä¶" aria-label="Rechercher un nom" />
      </div>

      <label class="file" title="Importer un fichier JSON de donn√©es">
        üì• Importer JSON
        <input id="importFile" type="file" accept="application/json" />
      </label>

      <button class="btn" id="exportBtn" title="Exporter les donn√©es (incluant vos modifications)">üì§ Exporter JSON</button>
    </div>

    <div class="pill" id="summaryPill">Chargement‚Ä¶</div>

    <div class="grid" id="cardGrid" aria-live="polite"></div>

    <div class="foot">
      <span>üí° Astuce : clique sur <strong>‚úé Modifier</strong> pour personnaliser textes et versets. Tes changements restent sur l‚Äôappareil (localStorage).</span>
      <span>¬© Dioc√®se ‚Äî composant local, aucune donn√©e n‚Äôest envoy√©e.</span>
    </div>
  </div>

  <template id="cardTemplate">
    <article class="card" part="card">
      <span class="badge">Biblique</span>
      <div class="name"></div>
      <div class="aliases" hidden></div>

      <div class="tabs" role="tablist" aria-label="D√©tails">
        <div class="tab-list">
          <button class="tab-btn" role="tab" data-tab="pron" aria-selected="true">üó£Ô∏è Prononciation</button>
          <button class="tab-btn" role="tab" data-tab="verses" aria-selected="false">üìú Versets</button>
          <button class="tab-btn" role="tab" data-tab="story" aria-selected="false">üìñ Histoire</button>
        </div>
        <section class="panel" role="tabpanel" data-panel="pron"></section>
        <section class="panel" role="tabpanel" data-panel="verses" hidden></section>
        <section class="panel" role="tabpanel" data-panel="story" hidden></section>
      </div>

      <div class="meta"></div>

      <div class="actions">
        <button class="btn speak" title="Lire la prononciation √† voix haute (si disponible)">üîä √âcouter</button>
        <button class="btn edit" title="Modifier les contenus">‚úé Modifier</button>
        <button class="btn save" hidden>üíæ Enregistrer</button>
        <span class="save-ok" hidden>Enregistr√© ‚úì</span>
      </div>
    </article>
  </template>

  <script>
    // ================================
    //   Donn√©es ‚Äî faciles √† √©tendre
    // ================================
    // Structure attendue par nom canonique:
    // {
    //   pron: "prononciation √©crite (approx. FR)",
    //   verses: ["REF ; REF", ...],  // libre
    //   story: "Bref r√©sum√© (2-4 lignes)",
    //   aliases: ["synonyme1", "variante2"],
    //   type: "Personne|Lieu|Peuple|Terme",
    // }
    // ‚ö†Ô∏è NB: Les entr√©es marqu√©es TODO sont des coquilles pr√™tes √† compl√©ter depuis l‚ÄôUI.
    const BASE_DATA = {
      "Abraham": {
        pron: "a-bra-ham (√†-bra-ram) | H√©breu:  æAvrƒÅhƒÅm",
        verses: ["Gen√®se 12:1-3", "Gen√®se 15", "Gen√®se 17", "Gen√®se 22:1-18"],
        story: "P√®re des croyants, alli√© par l‚Äôalliance : appel√© √† quitter son pays, re√ßoit la promesse d‚Äôune descendance et d‚Äôune terre.",
        aliases: [],
        type: "Personne",
      },
      "Isaac": {
        pron: "i-zak (i-za-ak) | H√©breu: Yits·∏•ƒÅq",
        verses: ["Gen√®se 21:1-7", "Gen√®se 22", "Gen√®se 26"],
        story: "Fils de la promesse; presque offert en sacrifice; p√®re d‚Äô√âsa√º et Jacob.",
        aliases: [],
        type: "Personne",
      },
      "Jacob": {
        pron: "ja-kob (ya-kob) | H√©breu: Ya øaqov",
        verses: ["Gen√®se 25:26", "Gen√®se 28", "Gen√®se 32:23-32", "Gen√®se 35"],
        story: "Renomm√© Isra√´l apr√®s avoir lutt√©; p√®re des douze tribus.",
        aliases: ["Isra√´l"],
        type: "Personne",
      },
      "Joseph": {
        pron: "jo-z√®f (jo-z√®f) | H√©breu: Y√¥sƒìf",
        verses: ["Gen√®se 37", "Gen√®se 39-50"],
        story: "Vendu par ses fr√®res, devient administrateur en √âgypte et sauve sa famille de la famine.",
        aliases: ["Yos√®ph"],
        type: "Personne",
      },
      "Mo√Øse": {
        pron: "mo-√Øz | H√©breu: Mosh√®",
        verses: ["Exode 2-3", "Exode 12-14", "Exode 19-20", "Deut√©ronome 34"],
        story: "Lib√©rateur d‚ÄôIsra√´l, m√©diateur de la Loi au Sina√Ø (Horeb).",
        aliases: [],
        type: "Personne",
      },
      "Sara": {
        pron: "sa-ra | H√©breu: SarƒÅh",
        verses: ["Gen√®se 17:15-19", "Gen√®se 18", "Gen√®se 21:1-7", "Gen√®se 23"],
        story: "√âpouse d‚ÄôAbraham, m√®re d‚ÄôIsaac; symbole de la promesse.",
        aliases: ["Sarah"],
        type: "Personne",
      },
      "R√©becca": {
        pron: "r√©-b√©-ka | H√©breu: Rivqah",
        verses: ["Gen√®se 24", "Gen√®se 27"],
        story: "√âpouse d‚ÄôIsaac; m√®re de Jacob et √âsa√º.",
        aliases: ["Ribqa (translit.)"],
        type: "Personne",
      },
      "Rachel": {
        pron: "ra-ch√®l | H√©breu: Ra·∏•el",
        verses: ["Gen√®se 29", "Gen√®se 30", "Gen√®se 35:16-19"],
        story: "√âpouse aim√©e de Jacob; m√®re de Joseph et Benjamin.",
        aliases: [],
        type: "Personne",
      },
      "L√©a": {
        pron: "l√©-a | H√©breu: Le‚Äôah",
        verses: ["Gen√®se 29", "Gen√®se 30"],
        story: "Premi√®re √©pouse de Jacob; m√®re de plusieurs tribus.",
        aliases: [],
        type: "Personne",
      },
      "Juda": {
        pron: "ju-da | H√©breu: Yehouda",
        verses: ["Gen√®se 29:35", "Gen√®se 38", "Gen√®se 49:8-12"],
        story: "Un des fils de Jacob; lign√©e royale (David).",
        aliases: [],
        type: "Personne",
      },
      "Benjamin": {
        pron: "ben-ja-min | H√©breu: Binyam√Æn",
        verses: ["Gen√®se 35:18", "Gen√®se 43-45"],
        story: "Plus jeune fils de Jacob; tribu de Benjamin.",
        aliases: [],
        type: "Personne",
      },
      "√âsa√º": {
        pron: "√©-za-u | H√©breu:  øEsav",
        verses: ["Gen√®se 25:29-34", "Gen√®se 27", "Gen√®se 33"],
        story: "Fr√®re jumeau de Jacob; anc√™tre d‚Äô√âdom.",
        aliases: ["Esau"],
        type: "Personne",
      },
      "Aaron": {
        pron: "a-ron | H√©breu: Aharon",
        verses: ["Exode 4:14-16", "Exode 28", "Nombres 12", "Nombres 20:22-29"],
        story: "Fr√®re de Mo√Øse; premier grand-pr√™tre.",
        aliases: [],
        type: "Personne",
      },
      "Myriam": {
        pron: "mi-riam | H√©breu: Miryam",
        verses: ["Exode 15:20-21", "Nombres 12"],
        story: "S≈ìur de Mo√Øse et Aaron; proph√©tesse.",
        aliases: ["M√©riam"],
        type: "Personne",
      },
      "L√©vi": {
        pron: "l√©-vi | H√©breu: Lewi",
        verses: ["Gen√®se 29:34", "Gen√®se 49:5-7"],
        story: "Fils de Jacob; anc√™tre des L√©vites (service du sanctuaire).",
        aliases: [],
        type: "Personne",
      },
      "√âphra√Øm": {
        pron: "√©-fra-im | H√©breu: Efrayim",
        verses: ["Gen√®se 48:17-20"],
        story: "Fils de Joseph; tribu importante du Nord.",
        aliases: [],
        type: "Personne",
      },
      "Manass√©": {
        pron: "ma-na-s√© | H√©breu: Menash√®",
        verses: ["Gen√®se 48:13-19"],
        story: "Fils premier-n√© de Joseph; tribu de Manass√©.",
        aliases: [],
        type: "Personne",
      },
      "Josu√©": {
        pron: "jo-zou-√© | H√©breu: Yehoshoua",
        verses: ["Josu√© 1:1-9", "Josu√© 6"],
        story: "Successeur de Mo√Øse; conduit l‚Äôentr√©e dans le pays.",
        aliases: [],
        type: "Personne",
      },
      "Balaam": {
        pron: "ba-la-am | H√©breu: Bil øam",
        verses: ["Nombres 22-24"],
        story: "Deviner voyant; b√©nit Isra√´l malgr√© Balaq.",
        aliases: [],
        type: "Personne",
      },
      "Balaq": {
        pron: "ba-lak | H√©breu: Balaq",
        verses: ["Nombres 22:2-6"],
        story: "Roi de Moab qui convoque Balaam.",
        aliases: [],
        type: "Personne",
      },
      "Cor√©": {
        pron: "ko-r√© | H√©breu: Qorah",
        verses: ["Nombres 16"],
        story: "M√®ne une r√©volte contre Mo√Øse et Aaron.",
        aliases: ["Qorah", "Qor√©"],
        type: "Personne",
      },
      "Datan": {
        pron: "da-tan",
        verses: ["Nombres 16"],
        story: "Associ√© √† la r√©volte de Cor√©.",
        aliases: ["Dathan"],
        type: "Personne",
      },
      "Abiram": {
        pron: "a-bi-ram",
        verses: ["Nombres 16"],
        story: "Associ√© √† la r√©volte de Cor√©.",
        aliases: [],
        type: "Personne",
      },
      "Be√ßal√©el": {
        pron: "b√©-tsa-l√©-el | H√©breu: Betsalel",
        verses: ["Exode 31:1-6", "Exode 35:30-35"],
        story: "Artisan principal du Tabernacle.",
        aliases: ["Bezalel"],
        type: "Personne",
      },
      "Oholiab": {
        pron: "o-ho-li-ab",
        verses: ["Exode 31:6", "Exode 35:34"],
        story: "Assistant de Be√ßal√©el, artisan habile.",
        aliases: [],
        type: "Personne",
      },
      "Pinhas": {
        pron: "pin-has | H√©breu: Pin·∏•as",
        verses: ["Nombres 25:7-13"],
        story: "Z√®le pour l‚Äôalliance; re√ßoit une alliance de paix.",
        aliases: ["Phin√©√®s (fr hist.)"],
        type: "Personne",
      },
      "Ithamar": {
        pron: "i-ta-mar",
        verses: ["Exode 6:23", "Nombres 4"],
        story: "Fils d‚ÄôAaron; service sacerdotal.",
        aliases: [],
        type: "Personne",
      },
      "√âl√©azar": {
        pron: "√©-l√©-a-zar",
        verses: ["Nombres 3:32", "Nombres 20:26-28"],
        story: "Fils d‚ÄôAaron; succ√®de comme grand-pr√™tre.",
        aliases: [],
        type: "Personne",
      },
      "J√©thro": {
        pron: "j√©-tro | H√©breu: Yitro",
        verses: ["Exode 2:16-22", "Exode 18"],
        story: "Beau-p√®re de Mo√Øse; conseille sur l‚Äôorganisation.",
        aliases: ["R√©uel (var.)"],
        type: "Personne",
      },
      "Cippora": {
        pron: "tsi-po-ra | H√©breu: Tsipporah",
        verses: ["Exode 2:21", "Exode 4:24-26"],
        story: "√âpouse de Mo√Øse.",
        aliases: ["Tsipporah", "S√©phora (trad.)"],
        type: "Personne",
      },
      "Laban": {
        pron: "la-ban",
        verses: ["Gen√®se 24:29", "Gen√®se 29-31"],
        story: "Oncle de Jacob, p√®re de Rachel et L√©a.",
        aliases: [],
        type: "Personne",
      },
      "R√©uel": {
        pron: "r√©-u-√®l",
        verses: ["Exode 2:18"],
        story: "Nom associ√© au pr√™tre madianite (J√©thro).",
        aliases: ["R√©houel", "R√©ouel"],
        type: "Personne",
      },
      "Amalec": {
        pron: "a-ma-l√®k",
        verses: ["Exode 17:8-16", "1 Samuel 15"],
        story: "Peuple ennemi d‚ÄôIsra√´l; vaincu par Josu√©/Mo√Øse (Ex 17).",
        aliases: [],
        type: "Peuple",
      },
      "Aggag": {
        pron: "ag-gag",
        verses: ["1 Samuel 15"],
        story: "Roi des Amal√©cites au temps de Sa√ºl.",
        aliases: [],
        type: "Personne",
      },
      "Hadad": {
        pron: "a-dad",
        verses: ["Gen√®se 36:35-39"],
        story: "Nom d‚Äô√©domites/rois dans les g√©n√©alogies.",
        aliases: [],
        type: "Personne",
      },
      "B√©thel": {
        pron: "b√©-tel",
        verses: ["Gen√®se 28:10-22", "Gen√®se 35:1-7"],
        story: "Lieu o√π Jacob voit l‚Äô√©chelle et consacre le lieu.",
        aliases: ["Bethel"],
        type: "Lieu",
      },
      "Horeb": {
        pron: "o-r√®b (H√¥reb)",
        verses: ["Exode 3", "Exode 17:6", "1 Rois 19"],
        story: "Mont de Dieu; autre nom du Sina√Ø.",
        aliases: ["H√¥reb"],
        type: "Lieu",
      },
      "√âdom": {
        pron: "√©-dom",
        verses: ["Gen√®se 36", "Nombres 20:14-21"],
        story: "Descendance d‚Äô√âsa√º; voisin d‚ÄôIsra√´l.",
        aliases: [],
        type: "Peuple",
      },
      "Pharaon": {
        pron: "fa-ra-on",
        verses: ["Exode 1-14"],
        story: "Titre des rois d‚Äô√âgypte; s‚Äôoppose √† la sortie d‚Äô√âgypte.",
        aliases: [],
        type: "Titre",
      },

      /* ---------- Coquilles (pr√©sentes dans ta liste) √† compl√©ter facilement depuis l'UI ---------- */
      "Abel-Misra√Øm": { pron: "", verses: [], story: "", aliases: [], type: "Lieu" },
      "Abiasaph": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Abihu": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Abihou": { pron: "", verses: [], story: "", aliases: ["Abihu"], type: "Personne" },
      "Abim√©lek": { pron: "", verses: [], story: "", aliases: ["Abim√©lec"], type: "Personne" },
      "Abisamac": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Abiram (autre)": { pron: "", verses: [], story: "", aliases: ["Abiram"], type: "Personne" },
      "Abraham, Isaac et Jacob": { pron: "", verses: [], story: "", aliases: [], type: "Groupe" },
      "Ada": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Adullam": { pron: "", verses: [], story: "", aliases: [], type: "Lieu" },
      "Aggag (var.)": { pron: "", verses: [], story: "", aliases: ["Aggag"], type: "Personne" },
      "Ahira": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Ahuzzat": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Ahi√©zer": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Akbor": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Alva": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Amminadab": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Ammiel": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Ammishadda√Ø": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Ana": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Arau": { pron: "", verses: [], story: "", aliases: [], type: "Non list√©" },
      "Asnat": { pron: "", verses: [], story: "", aliases: ["Asnath"], type: "Personne" },
      "Asher": { pron: "", verses: [], story: "", aliases: ["Aser"], type: "Personne" },
      "Aser": { pron: "", verses: [], story: "", aliases: ["Asher"], type: "Personne" },
      "Baal-Hanan": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Basmat": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "B√©eri": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Bilha": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Cippora": {}, /* d√©j√† renseign√©e ci-dessus */
      "Dan": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "D√©borah": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Deuel": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Dish√¢n": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Dish√¥n": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Dina": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "√âli-phaz (√âliphas)": { pron: "", verses: [], story: "", aliases: ["√âlifaz", "√âliphaz"], type: "Personne" },
      "√âlim": { pron: "", verses: [], story: "", aliases: [], type: "Lieu" },
      "√âlon√©": { pron: "", verses: [], story: "", aliases: [], type: "Lieu/Arbre" },
      "√âphron": { pron: "", verses: [], story: "", aliases: ["H√©phron"], type: "Personne" },
      "Gad": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Galaad": { pron: "", verses: [], story: "", aliases: [], type: "Lieu/Peuple" },
      "Gatam": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "G√©d√©oni": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Geuel": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Guershom": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Guersh√¥n": { pron: "", verses: [], story: "", aliases: ["Gershon"], type: "Personne" },
      "Hamor": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Hanok": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "H√©b√©r": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "H√©man": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Hittite (H√©thite)": { pron: "", verses: [], story: "", aliases: ["H√©thite"], type: "Peuple" },
      "Hogla": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Issachar": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Ishvi (Yishvi)": { pron: "", verses: [], story: "", aliases: ["Yishvi"], type: "Personne" },
      "Ithamar (d√©j√†)": {},
      "Jamin": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "J√©thro (d√©j√†)": {},
      "Jemuel": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Jokin (Yak√Æn)": { pron: "", verses: [], story: "", aliases: ["Yak√Æn", "Jakin"], type: "Personne" },
      "Kozbi": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Laban (d√©j√†)": {},
      "Ladanum": { pron: "", verses: [], story: "", aliases: [], type: "Terme" },
      "Libni": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Lotan": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Makir": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Makp√©la": { pron: "", verses: [], story: "", aliases: [], type: "Tombe/Lieu" },
      "Malchiel (Malkiel)": { pron: "", verses: [], story: "", aliases: ["Malkiel"], type: "Personne" },
      "Mambr√©": { pron: "", verses: [], story: "", aliases: [], type: "Lieu" },
      "M√©-Zahab (Me-Zahab)": { pron: "", verses: [], story: "", aliases: ["Me-Zahab"], type: "Personne" },
      "Merari": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Misha√´l": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Milka": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Nahbi": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Nahsh√¥n": { pron: "", verses: [], story: "", aliases: ["Nahshon"], type: "Personne" },
      "Naphtali (Nephtali)": { pron: "", verses: [], story: "", aliases: ["Nephtali"], type: "Personne" },
      "Nemu√´l": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Noa": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "N√ªn (Nun)": { pron: "", verses: [], story: "", aliases: ["Nun"], type: "Personne" },
      "Oholibama": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "On (H√©liopolis)": { pron: "", verses: [], story: "", aliases: ["H√©liopolis"], type: "Lieu" },
      "Ozni": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Pagiel": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Palti": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Pa√Ø": { pron: "", verses: [], story: "", aliases: [], type: "Lieu" },
      "Poti-Ph√©ra": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Qenaz": { pron: "", verses: [], story: "", aliases: ["K√©naz"], type: "Personne" },
      "Qehat": { pron: "", verses: [], story: "", aliases: ["Kehath", "Qeath"], type: "Personne" },
      "Qehatites": { pron: "", verses: [], story: "", aliases: ["Kehathites"], type: "Groupe" },
      "Rams√®s": { pron: "", verses: [], story: "", aliases: [], type: "Lieu/Pharaon" },
      "R√©becca (d√©j√†)": {},
      "R√©houel (R√©ouel)": { pron: "", verses: [], story: "", aliases: ["R√©ouel", "R√©uel"], type: "Personne" },
      "R√©ouel (d√©j√†)": {},
      "Ruben": { pron: "", verses: [], story: "", aliases: ["Roub√´n"], type: "Personne" },
      "Salu": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Samla": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Scepte (terme)": { pron: "", verses: [], story: "", aliases: ["Sceptre"], type: "Terme" },
      "S√©√Ør": { pron: "", verses: [], story: "", aliases: [], type: "Lieu" },
      "Seth": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Sha√ºl": { pron: "", verses: [], story: "", aliases: ["Sa√ºl"], type: "Personne" },
      "Shammua": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Shaphat (Shafat)": { pron: "", verses: [], story: "", aliases: ["Shafat"], type: "Personne" },
      "Shillem": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Shime√Ø": { pron: "", verses: [], story: "", aliases: ["Shim√©i"], type: "Personne" },
      "Shobal": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Shouni": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Sim√©on": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Sithre√Ø": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Susi": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Timna": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Tirscha (Tirtsa)": { pron: "", verses: [], story: "", aliases: ["Tirtsa"], type: "Lieu" },
      "Tsephon": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Tsurishadda√Ø": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Uzzi√´l": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Yak√Æn": { pron: "", verses: [], story: "", aliases: ["Jakin"], type: "Personne" },
      "Yehudit": { pron: "", verses: [], story: "", aliases: ["Judith"], type: "Personne" },
      "Yalam": { pron: "", verses: [], story: "", aliases: [], type: "Personne" },
      "Y√©ush": { pron: "", verses: [], story: "", aliases: ["Jeush"], type: "Personne" },
      "Yok√©bed": { pron: "", verses: [], story: "", aliases: ["Jochebed"], type: "Personne" },
      // "J√©sus", "Agar", "Jasher" explicitement ‚Äúnon‚Äù dans ta liste
    };

    // Synonymes suppl√©mentaires -> nom canonique
    const SYNONYMS = {
      "Esau": "√âsa√º",
      "Qorah": "Cor√©",
      "Qor√©": "Cor√©",
      "√âliphas": "√âli-phaz (√âliphas)",
      "Eliphaz": "√âli-phaz (√âliphas)",
      "Horeb": "Horeb",
      "Bethel": "B√©thel",
      "Sephora": "Cippora",
      "Tsipporah": "Cippora",
      "Yos√®ph": "Joseph",
      "Nephtali": "Naphtali (Nephtali)",
      "Judith": "Yehudit",
    };

    // ================================
    //     Helper UI / fonctionnalit√©s
    // ================================
    const root = document.getElementById("widget-root");
    const grid = document.getElementById("cardGrid");
    const searchInput = document.getElementById("searchInput");
    const exportBtn = document.getElementById("exportBtn");
    const importFile = document.getElementById("importFile");
    const summaryPill = document.getElementById("summaryPill");
    const cardTpl = document.getElementById("cardTemplate");

    // Chargement des √©ventuelles personnalisations
    function loadCustomData() {
      try { return JSON.parse(localStorage.getItem("epellation-data") || "{}"); }
      catch { return {}; }
    }
    function saveCustomData(data) {
      localStorage.setItem("epellation-data", JSON.stringify(data));
    }

    // Fusion avec priorit√©s aux donn√©es personnalis√©es
    function getData() {
      const custom = loadCustomData();
      return Object.fromEntries(
        Object.entries(BASE_DATA).map(([k, v]) => {
          const merged = { ...v, ...(custom[k] || {}) };
          // normaliser champs vides
          merged.pron ??= "";
          merged.verses ??= [];
          merged.story ??= "";
          merged.aliases ??= v?.aliases || [];
          merged.type ??= v?.type || "Personne";
          return [k, merged];
        })
      );
    }

    // Normalisation de recherche (sans accents / casse)
    const fold = (s) => (s || "")
      .toString()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")
      .toLowerCase();

    // Rendu d‚Äôun item
    function renderCard(name, entry) {
      const node = cardTpl.content.firstElementChild.cloneNode(true);

      node.querySelector(".name").textContent = name;
      const aliasEl = node.querySelector(".aliases");
      const aliases = (entry.aliases || []).filter(a => a && a !== name);
      if (aliases.length) {
        aliasEl.textContent = "Aussi : " + aliases.join(" ¬∑ ");
        aliasEl.hidden = false;
      }

      const meta = node.querySelector(".meta");
      const typeChip = document.createElement("span");
      typeChip.className = "chip";
      typeChip.textContent = entry.type || "‚Äî";
      meta.appendChild(typeChip);

      // Statut ‚Äú√† compl√©ter‚Äù si vide
      const needs = (!entry.pron?.trim()) + (!entry.verses?.length) + (!entry.story?.trim());
      if (needs) node.classList.add("todo");

      // Panneaux
      const pnlPron = node.querySelector('[data-panel="pron"]');
      const pnlVers = node.querySelector('[data-panel="verses"]');
      const pnlStory = node.querySelector('[data-panel="story"]');

      pnlPron.innerHTML = entry.pron?.trim()
        ? `<p>${escapeHtml(entry.pron)}</p>`
        : `<p><em>√Ä compl√©ter : ajouter la prononciation √©crite (ex. ‚Äúa-bra-ham‚Äù).</em></p>`;

      pnlVers.innerHTML = (entry.verses?.length)
        ? `<ul>${entry.verses.map(v => `<li>${escapeHtml(v)}</li>`).join("")}</ul>`
        : `<p><em>√Ä compl√©ter : ajouter des r√©f√©rences (ex. ‚ÄúGen√®se 12:1-3‚Äù).</em></p>`;

      pnlStory.innerHTML = entry.story?.trim()
        ? `<p>${escapeHtml(entry.story)}</p>`
        : `<p><em>√Ä compl√©ter : bref r√©sum√© (2-4 lignes).</em></p>`;

      // Onglets
      node.querySelectorAll(".tab-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const tab = btn.dataset.tab;
          node.querySelectorAll(".tab-btn").forEach(b => b.setAttribute("aria-selected", String(b === btn)));
          node.querySelectorAll(".panel").forEach(p => p.hidden = (p.dataset.panel !== tab));
        });
      });

      // Lecture prononciation
      node.querySelector(".speak").addEventListener("click", () => {
        const text = (entry.pron?.replace(/\|.*$/, "") || name);
        if ("speechSynthesis" in window) {
          const u = new SpeechSynthesisUtterance(text);
          u.lang = "fr-FR";
          u.rate = 0.92;
          speechSynthesis.speak(u);
        } else {
          alert("Synth√®se vocale non disponible dans ce navigateur.");
        }
      });

      // Edition
      const btnEdit = node.querySelector(".edit");
      const btnSave = node.querySelector(".save");
      const saved = node.querySelector(".save-ok");

      btnEdit.addEventListener("click", () => {
        toEditable(pnlPron, "Texte de prononciation‚Ä¶");
        toEditable(pnlVers, "Une r√©f√©rence par ligne‚Ä¶", true);
        toEditable(pnlStory, "R√©dige un court r√©sum√©‚Ä¶");
        btnSave.hidden = false;
        btnEdit.hidden = true;
      });

      btnSave.addEventListener("click", () => {
        const newPron = fromEditable(pnlPron, false);
        const newVers = fromEditable(pnlVers, true);
        const newStory = fromEditable(pnlStory, false);

        const custom = loadCustomData();
        custom[name] = {
          ...(custom[name] || {}),
          pron: newPron,
          verses: newVers,
          story: newStory,
          aliases: entry.aliases || [],
          type: entry.type || "Personne",
        };
        saveCustomData(custom);
        saved.hidden = false;
        setTimeout(() => { saved.hidden = true; }, 1500);
        // Remettre en lecture
        pnlPron.innerHTML = newPron ? `<p>${escapeHtml(newPron)}</p>` : `<p><em>√Ä compl√©ter‚Ä¶</em></p>`;
        pnlVers.innerHTML = newVers.length ? `<ul>${newVers.map(v => `<li>${escapeHtml(v)}</li>`).join("")}</ul>` : `<p><em>√Ä compl√©ter‚Ä¶</em></p>`;
        pnlStory.innerHTML = newStory ? `<p>${escapeHtml(newStory)}</p>` : `<p><em>√Ä compl√©ter‚Ä¶</em></p>`;
        btnSave.hidden = true;
        btnEdit.hidden = false;
        node.classList.toggle("todo", (!newPron) || (!newVers.length) || (!newStory));
      });

      return node;
    }

    // Edition helpers
    function toEditable(panel, isMultiHint = "Texte‚Ä¶", listMode = false) {
      const text = panel.textContent.trim().startsWith("√Ä compl√©ter") ? "" : panel.textContent.trim();
      panel.innerHTML = "";
      if (listMode) {
        const ta = document.createElement("textarea");
        ta.value = (Array.from(panel.querySelectorAll("li")).map(li => li.textContent.trim()).join("\n")) || text || "";
        ta.placeholder = isMultiHint;
        ta.rows = 4;
        ta.style.width = "100%";
        ta.style.background = "transparent";
        ta.style.border = "0";
        ta.style.color = "inherit";
        panel.appendChild(ta);
      } else {
        const input = document.createElement("textarea");
        input.value = text || "";
        input.placeholder = isMultiHint;
        input.rows = 3;
        input.style.width = "100%";
        input.style.background = "transparent";
        input.style.border = "0";
        input.style.color = "inherit";
        panel.appendChild(input);
      }
    }
    function fromEditable(panel, listMode = false) {
      const ta = panel.querySelector("textarea");
      if (!ta) return listMode ? [] : "";
      const val = ta.value.trim();
      if (!listMode) return val;
      return val ? val.split(/\n+/).map(s => s.trim()).filter(Boolean) : [];
    }

    // S√©curit√© simple
    function escapeHtml(s) {
      return (s ?? "").toString()
        .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
        .replaceAll('"',"&quot;").replaceAll("'","&#039;");
    }

    // Liste tri√©e par ordre alphab√©tique (sans accents)
    function sortedNames(data) {
      return Object.keys(data)
        .filter(k => Object.keys(data[k] || {}).length) // ignorer placeholders vides
        .sort((a,b) => fold(a).localeCompare(fold(b)));
    }

    // Rendu complet
    function render(filter = "") {
      const data = getData();
      const names = sortedNames(data)
        .filter(n => {
          const canon = fold(n);
          const f = fold(filter);
          if (!f) return true;
          if (canon.includes(f)) return true;
          const aliases = (data[n].aliases || []).map(fold);
          return aliases.some(a => a.includes(f));
        });

      grid.innerHTML = "";
      names.forEach(n => {
        const card = renderCard(n, data[n]);
        grid.appendChild(card);
      });

      // r√©sum√©
      const total = names.length;
      const all = sortedNames(data);
      const todoCount = all.filter(n => {
        const e = data[n];
        return (!e.pron?.trim()) || (!(e.verses?.length)) || (!e.story?.trim());
      }).length;
      summaryPill.textContent = `${total} nom(s) affich√©(s) ‚Ä¢ ${all.length} total ‚Ä¢ ${todoCount} √† compl√©ter`;
    }

    // Recherche instantan√©e
    searchInput.addEventListener("input", (e) => render(e.target.value));

    // Export JSON
    exportBtn.addEventListener("click", () => {
      const all = getData();
      const blob = new Blob([JSON.stringify(all, null, 2)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "epellation-biblique-data.json";
      a.click();
      URL.revokeObjectURL(a.href);
    });

    // Import JSON
    importFile.addEventListener("change", (e) => {
      const file = e.target.files?.[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const obj = JSON.parse(reader.result);
          const prev = loadCustomData();
          saveCustomData({ ...prev, ...obj });
          render(searchInput.value);
          alert("Import r√©ussi ‚úì");
        } catch {
          alert("Le fichier n‚Äôest pas un JSON valide.");
        }
      };
      reader.readAsText(file);
      importFile.value = "";
    });

    // Redirection des synonymes (si on tape un alias dans la recherche)
    function tryAliasRedirect(q) {
      const target = SYNONYMS[q]?.trim();
      if (!target) return;
      searchInput.value = target;
      render(target);
    }

    // Premi√®re peinture
    render("");

    // ---------------- Extra: si on arrive avec un hash #Nom, le s√©lectionner ----------------
    if (location.hash) {
      const q = decodeURIComponent(location.hash.slice(1));
      searchInput.value = q;
      tryAliasRedirect(q);
      render(q);
    }
  </script>
</section>