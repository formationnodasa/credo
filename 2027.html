<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Champs Lexicaux ‚Äì Jeu Multijoueur</title>
  <style>
    :root{
      --bg1:#6a11cb; --bg2:#2575fc;
      --card: rgba(255,255,255,.12);
      --glass: blur(12px);
      --txt:#fff; --accent:#fff; --brand:#2575fc;
      --ok:#00e676; --ko:#ff5252;
    }
    *{box-sizing:border-box}
    body{
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(270deg, var(--bg1), var(--bg2), var(--bg1));
      background-size: 600% 600%;
      animation: gradientAnimation 15s ease infinite;
      color: var(--txt);
      min-height: 100vh;
      margin: 0;
      display: grid;
      place-items: center;
      padding: 12px;
    }
    @keyframes gradientAnimation{
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }
    .container{
      background: var(--card);
      backdrop-filter: var(--glass);
      width: min(1200px, 94vw);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,.25);
      animation: fadeIn .9s ease;
    }
    @keyframes fadeIn{from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:translateY(0)}}
    header{
      display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap
    }
    h1{
      font-weight:800; margin:0; font-size: clamp(26px, 3.4vw, 40px);
      text-shadow: 0 3px 8px rgba(0,0,0,.3);
      letter-spacing:.3px;
    }
    .status{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; font-weight:600;
      opacity:.95;
    }
    .pill{
      padding:4px 10px; border-radius:999px; background:rgba(255,255,255,.16);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.16);
      font-size:.95rem
    }
    .display{
      margin:24px 0 10px; display:grid; gap:10px;
    }
    #prefixDisplay{
      font-size: clamp(36px, 5vw, 64px);
      font-weight:900; letter-spacing:.18em; text-align:center;
      text-shadow: 0 3px 8px rgba(0,0,0,.28);
    }
    #definitionDisplay{
      font-size: clamp(18px, 2.2vw, 22px);
      line-height:1.6; text-align:center;
      background: rgba(0,0,0,.16);
      border-radius:14px; padding:16px 18px;
    }
    .controls{
      display:grid; grid-template-columns: repeat(6,1fr); gap:10px; margin:12px 0 6px;
    }
    button{
      padding:12px; font-size:1.1rem; font-weight:700; border-radius:14px; border:none;
      cursor:pointer; background:#fff; color:var(--brand);
      transition:.25s; box-shadow:0 4px 10px rgba(0,0,0,.1);
    }
    button:hover{ background:var(--brand); color:#fff; box-shadow:0 0 12px #ffffff99, 0 0 18px #2575fcaa }
    button:disabled{opacity:.55; cursor:not-allowed}
    input[type="text"]{
      font-size:1.2rem; padding:14px 16px; border-radius:12px; border:none; width:100%;
      margin:10px 0 14px; background:#fff; color:#222; outline:none; transition:.25s;
    }
    input[type="text"]:focus{ box-shadow:0 0 10px var(--brand); caret-color:var(--brand) }
    #message{ min-height:28px; font-size:1.1rem; font-weight:700; text-align:center; margin:6px 0 0 }
    .divider{ height:1px; background:rgba(255,255,255,.18); margin:18px 0 }
    .bank{
      display:flex; flex-wrap:wrap; gap:12px; justify-content:center;
    }
    .bank button{
      background:rgba(255,255,255,.12); color:#fff; font-weight:800; letter-spacing:.08em;
      border:1px solid rgba(255,255,255,.18);
    }
    .bank button.active{ background:#fff; color:var(--brand) }
    .footnote{
      margin-top:10px; text-align:center; opacity:.85; font-size:.95rem
    }
    .sr-only{ position:absolute; left:-10000px; top:auto; width:1px; height:1px; overflow:hidden; }
    
    /* Styles multijoueur */
    .multiplayer-panel {
      background: rgba(0,0,0,0.2);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 20px;
    }
    .player-list {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }
    .player {
      background: rgba(255,255,255,0.1);
      padding: 8px 12px;
      border-radius: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .player-score {
      background: var(--brand);
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 0.8rem;
    }
    .timer {
      font-size: 1.5rem;
      font-weight: bold;
      text-align: center;
      margin: 10px 0;
      color: #fff;
    }
    .session-code {
      font-size: 2rem;
      font-weight: bold;
      text-align: center;
      letter-spacing: 0.2em;
      margin: 10px 0;
      background: rgba(255,255,255,0.2);
      padding: 10px;
      border-radius: 10px;
    }
    .multiplayer-controls {
      display: flex;
      gap: 10px;
      margin: 10px 0;
    }
    .multiplayer-controls button {
      flex: 1;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Champs lexicaux ‚Äì Jeu Multijoueur</h1>
      <div class="status">
        <span class="pill" id="progressPill">0 / 0</span>
        <span class="pill" id="speedPill">Vitesse √ó1.00</span>
        <span class="pill" id="hintPill">Toutes les r√©ponses commencent par&nbsp;<b id="hintPrefix">‚Äì ‚Äì</b></span>
      </div>
    </header>

    <!-- Panneau multijoueur -->
    <div class="multiplayer-panel" id="multiplayerPanel" style="display: none;">
      <div class="session-code" id="sessionCodeDisplay">----</div>
      <div class="timer" id="timerDisplay">15s</div>
      <div class="player-list" id="playerList"></div>
      <div class="multiplayer-controls">
        <button id="btnCopyCode">üìã Copier code</button>
        <button id="btnLeaveGame">üö™ Quitter</button>
      </div>
    </div>

    <div class="display">
      <div id="prefixDisplay">‚Äì ‚Äì</div>
      <div id="definitionDisplay">Clique une initiale ci-dessous ou appuie sur ‚ñ∂Ô∏è Jouer.</div>
    </div>

    <input type="text" id="answer" placeholder="√âcris le mot correct (m√™me initiales) et appuie sur Entr√©e‚Ä¶" autocomplete="off" />

    <div class="controls" role="group" aria-label="Commandes">
      <button id="btnPlay">‚ñ∂Ô∏è Jouer</button>
      <button id="btnSlow">üê¢ Ralentir</button>
      <button id="btnFast">üêá Acc√©l√©rer</button>
      <button id="btnRepeat">üîÅ R√©p√©ter</button>
      <button id="btnSkip">‚è≠ Passer</button>
      <button id="btnBack">‚¨ÖÔ∏è Retour</button>
    </div>

    <div id="message" aria-live="polite"></div>

    <div class="divider"></div>

    <div class="bank" id="initialBank" aria-label="Liste d'initiales (s√©lection rapide)"></div>
    <div class="footnote">Astuce : tu peux changer la vitesse et r√©p√©ter la d√©finition √† volont√©.</div>
  </div>

  <!-- Modales pour le multijoueur -->
  <div id="multiplayerModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center;">
    <div style="background: var(--card); backdrop-filter: var(--glass); padding: 30px; border-radius: 20px; max-width: 500px; width: 90%;">
      <h2 style="margin-top: 0;">Mode Multijoueur</h2>
      <div style="display: flex; gap: 10px; margin: 20px 0;">
        <button id="btnCreateGame" style="flex: 1;">Cr√©er une partie</button>
        <button id="btnJoinGame" style="flex: 1;">Rejoindre une partie</button>
      </div>
      <div id="joinForm" style="display: none;">
        <input type="text" id="joinCode" placeholder="Code √† 4 lettres" maxlength="4" style="width: 100%; text-align: center; font-size: 1.5rem; letter-spacing: 0.2em;">
        <input type="text" id="playerName" placeholder="Ton nom" style="width: 100%; margin-top: 10px;">
        <button id="btnConfirmJoin" style="width: 100%; margin-top: 10px;">Rejoindre</button>
      </div>
      <button id="btnCloseModal" style="width: 100%; margin-top: 10px;">Fermer</button>
    </div>
  </div>

  <script>
    // --- Donn√©es : champs lexicaux nettoy√©s (entr√©es sans d√©finition ou bugg√©es retir√©es) ---
    // Rappel: Chaque item = { mot: "Mot", def: "D√©finition" } ; la r√©ponse attendue commence par les deux lettres du champ.
    const FIELDS = {
      "Pr": [
        {mot:"Pr√©cision", def:"Le fait de donner des d√©tails exacts et pr√©cis sur quelque chose."},
        {mot:"Profond", def:"Qui se rapporte √† la profondeur ou √† une intensit√© importante."},
        {mot:"Profession", def:"Domaine d'activit√© ou m√©tier dans lequel une personne travaille."},
        {mot:"Progr√®s", def:"Avancement ou am√©lioration dans une situation ou un domaine."},
        {mot:"Promesse", def:"Engagement ou parole donn√©e de faire quelque chose."},
        {mot:"Proverbe", def:"Expression populaire qui contient une sagesse ou un conseil."},
        {mot:"Pr√©cieux", def:"Qui a une grande valeur ou importance."},
        {mot:"Pr√©paration", def:"Action de se pr√©parer en vue d'une activit√©."},
        {mot:"Pr√©caution", def:"Mesure prise pour √©viter un danger ou un probl√®me."},
        {mot:"Privil√®ge", def:"Avantage ou droit sp√©cial accord√© √† certaines personnes."}
      ],
      "Se": [
        {mot:"Sensation", def:"Perception ou ressenti d'un stimulus par les sens."},
        {mot:"S√©duction", def:"Charme ou pouvoir d'attraction envers quelqu'un."},
        {mot:"S√©r√©nit√©", def:"√âtat de calme et de tranquillit√©."},
        {mot:"Secret", def:"Quelque chose qui est cach√© ou inconnu du public."},
        {mot:"S√©paration", def:"Acte de se s√©parer ou de se diviser."},
        {mot:"S√©rieux", def:"√âtat de responsabilit√© et de gravit√©."},
        {mot:"Sentiment", def:"√âmotion ou affection ressentie envers quelqu'un ou quelque chose."},
        {mot:"Service", def:"Action d'aider ou d'assister quelqu'un."},
        {mot:"Seconde", def:"Unit√© de temps ou rang apr√®s la premi√®re."},
        {mot:"Septi√®me", def:"Position dans une s√©rie apr√®s le sixi√®me."}
      ],
      "Tr": [
        {mot:"Transformation", def:"Changement ou m√©tamorphose d'une chose en une autre."},
        {mot:"Tristesse", def:"√âtat de chagrin ou de m√©lancolie."},
        {mot:"Travail", def:"Emploi ou activit√© professionnelle."},
        {mot:"Traitement", def:"Action de soigner ou de proc√©der √† une proc√©dure m√©dicale."},
        {mot:"Tradition", def:"Coutume transmise de g√©n√©ration en g√©n√©ration."},
        {mot:"Trag√©die", def:"Drame qui provoque de la tristesse ou du d√©sespoir."},
        {mot:"Trenti√®me", def:"Position dans une s√©rie apr√®s le vingt-neuvi√®me."},
        {mot:"Triomphe", def:"Victoire √©clatante √† l'issue d'une lutte."},
        {mot:"Transparence", def:"Clart√© d'une substance ou d'une situation."},
        {mot:"Tr√©sor", def:"Richesse ou bien pr√©cieux √† valeur sentimentale ou mat√©rielle."}
      ],
      "Ac": [
        {mot:"Accompagnement", def:"Soutien ou aide fournie √† quelqu'un."},
        {mot:"Acc√®s", def:"Possibilit√© d'entrer dans un lieu ou d'obtenir quelque chose."},
        {mot:"Action", def:"Acte de faire quelque chose."},
        {mot:"Activit√©", def:"Occupation ou exercice d'une action."},
        {mot:"Achat", def:"Acquisition d'un bien."},
        {mot:"Accident", def:"√âv√©nement impr√©vu, souvent tragique."},
        {mot:"Accord", def:"Entente ou consensus entre plusieurs personnes."},
        {mot:"Acquisition", def:"Obtention d'une chose."},
        {mot:"Acteur", def:"Personne qui joue un r√¥le au th√©√¢tre ou au cin√©ma."},
        {mot:"Acclamation", def:"Applaudissements ou √©loges enthousiastes."},
        {mot:"Acrimonie", def:"Mauvaise humeur qui s'exprime par des propos acerbes."}
      ],
      "Ca": [
        {mot:"Caract√®re", def:"Ensemble de traits distinctifs d'une personne ou d'une chose."},
        {mot:"Carte", def:"Document repr√©sentant une r√©gion ou un territoire."},
        {mot:"Cascade", def:"Chute d'eau sur une pente."},
        {mot:"Cadeau", def:"Objet offert pour une occasion ou par affection."},
        {mot:"Caisse", def:"Contenant destin√© au transport d'objets."},
        {mot:"Cam√©ra", def:"Appareil pour prendre des photos ou filmer."},
        {mot:"Campagne", def:"R√©gion rurale, √©loign√©e de la ville."},
        {mot:"Canal", def:"Voie d'eau artificielle pour le transport."},
        {mot:"Capacit√©", def:"Aptitude √† faire, comprendre ou apprendre."},
        {mot:"Capitale", def:"Ville principale d'un pays ou d'une r√©gion."}
      ],
      "Me": [
        {mot:"M√©moire", def:"Capacit√© de se souvenir et de rappeler des informations."},
        {mot:"M√©thode", def:"Mani√®re sp√©cifique d'effectuer une t√¢che."},
        {mot:"M√©lodie", def:"S√©quence agr√©able de notes musicales."},
        {mot:"Menu", def:"Liste de plats ou d'options dans un programme."},
        {mot:"M√©contentement", def:"Sentiment de ne pas √™tre satisfait."},
        {mot:"Mesure", def:"Quantit√© ou √©chelle pour √©valuer quelque chose."},
        {mot:"Merveille", def:"Chose tr√®s impressionnante ou √©tonnante."},
        {mot:"M√©ditation", def:"Pratique de relaxation et de concentration."},
        {mot:"Messagerie", def:"Syst√®me d'envoi et de r√©ception de messages."},
        {mot:"M√©morable", def:"Qui m√©rite d'√™tre rappel√©."},
        {mot:"M√©t√©o", def:"Conditions atmosph√©riques √† un moment pr√©cis."}
      ],
      "Di": [
        {mot:"Direction", def:"Position ou trajectoire d'un mouvement."},
        {mot:"Difficult√©", def:"Obstacle ou d√©fi qui complique quelque chose."},
        {mot:"Discipline", def:"Ob√©issance √† des r√®gles pour atteindre un objectif."},
        {mot:"Dialogue", def:"Conversation entre deux personnes ou plus."},
        {mot:"Diversit√©", def:"Vari√©t√© dans un groupe ou une soci√©t√©."},
        {mot:"Diplomatie", def:"Art de n√©gocier et r√©soudre les conflits."},
        {mot:"Dictionnaire", def:"Livre listant les mots et leurs d√©finitions."},
        {mot:"Disparition", def:"Fait de ne plus √™tre pr√©sent ou visible."},
        {mot:"Dimension", def:"Mesure de la taille ou de la port√©e d'un objet."},
        {mot:"Directionnel", def:"Relatif √† la direction ou l'orientation."},
        {mot:"Divertissement", def:"Ce qui procure du plaisir ou de l'amusement."},
        {mot:"Diam√®tre", def:"Segment passant par le centre d'un cercle entre deux points de la circonf√©rence."},
        {mot:"Discoth√®que", def:"Lieu o√π l'on danse au son d'une musique enregistr√©e."}
      ],
      "Em": [
        {mot:"Emotion", def:"R√©action affective intense."},
        {mot:"Empathie", def:"Capacit√© de comprendre et partager les sentiments d'autrui."},
        {mot:"Emploi", def:"Travail ou occupation r√©mun√©r√©."},
        {mot:"Empreinte", def:"Marque laiss√©e par un objet ou une personne."},
        {mot:"√âmotionnel", def:"Li√© aux √©motions."},
        {mot:"Empire", def:"Vaste territoire gouvern√© par un seul souverain."},
        {mot:"Embl√®me", def:"Symbole repr√©sentant une id√©e ou une organisation."},
        {mot:"Empoisonnement", def:"√âtat d'intoxication."},
        {mot:"√âm√©rite", def:"Qui a acquis une reconnaissance particuli√®re dans un domaine."},
        {mot:"Empressement", def:"Enthousiasme √† faire quelque chose rapidement."},
        {mot:"√âmergence", def:"Processus par lequel quelque chose devient visible."},
        {mot:"√âmancipation", def:"Fait de se lib√©rer de contraintes pour plus d'autonomie."}
      ],
      "No": [
        {mot:"Nourriture", def:"Substances consomm√©es pour se nourrir."},
        {mot:"Nouvelle", def:"Information sur des √©v√©nements r√©cents."},
        {mot:"Nostalgie", def:"D√©sir ou tristesse envers le pass√©."},
        {mot:"Normalit√©", def:"√âtat conforme aux normes."},
        {mot:"Notori√©t√©", def:"Renomm√©e d'une personne ou d'une chose."},
        {mot:"Notre", def:"Qui appartient √† ¬´ nous ¬ª."},
        {mot:"Nocif", def:"Qui peut causer des dommages."},
        {mot:"Novice", def:"Personne inexp√©riment√©e."},
        {mot:"Nourrir", def:"Donner √† manger."},
        {mot:"Nomade", def:"Qui se d√©place souvent sans domicile fixe."}
      ],
      "La": [
        {mot:"Langage", def:"Syst√®me de communication humaine."},
        {mot:"Labyrinthe", def:"D√©dale complexe de passages."},
        {mot:"Lampe", def:"Appareil d'√©clairage."},
        {mot:"Laconique", def:"Qui s'exprime de mani√®re br√®ve."},
        {mot:"Larme", def:"Goutte d'eau produite par les glandes lacrymales."},
        {mot:"Lavage", def:"Action de nettoyer avec de l'eau."},
        {mot:"Laconisme", def:"Style de discours succinct."},
        {mot:"Lancinant", def:"Douleur vive et persistante."},
        {mot:"Laconiquement", def:"De mani√®re concise."},
        {mot:"Languissant", def:"Faible ou manquant d'√©nergie."}
      ],
      "Ch": [
        {mot:"Chaleur", def:"Sensation de temp√©rature √©lev√©e."},
        {mot:"Chambre", def:"Pi√®ce o√π l'on dort."},
        {mot:"Chanson", def:"Composition musicale avec paroles."},
        {mot:"Chapeau", def:"Coiffure prot√©geant du soleil ou de la pluie."},
        {mot:"Charit√©", def:"Aide apport√©e aux personnes dans le besoin."},
        {mot:"Chat", def:"Animal domestique qui miaule."},
        {mot:"Ch√¢teau", def:"B√¢timent fortifi√©, r√©sidence noble."},
        {mot:"Chauffage", def:"Syst√®me pour chauffer une pi√®ce."},
        {mot:"Chaussure", def:"Accessoire qui recouvre le pied."},
        {mot:"Chiffre", def:"Symbole num√©rique."},
        {mot:"Chocolat", def:"Produit alimentaire √† base de cacao."},
        {mot:"Choix", def:"Action de choisir."},
        {mot:"Ch√¥mage", def:"Situation d'une personne sans travail."},
        {mot:"Chute", def:"Action de tomber."},
        {mot:"Ch√®vre", def:"Animal domestique √©lev√© pour son lait."},
        {mot:"Chimie", def:"Science de la composition des substances."},
        {mot:"Chirurgie", def:"Branche de la m√©decine utilisant des op√©rations."},
        {mot:"Chouette", def:"Oiseau nocturne associ√© √† la sagesse."}
      ],
      "Ci": [
        {mot:"Ciel", def:"Espace atmosph√©rique au-dessus de la Terre."},
        {mot:"Cire", def:"Substance solide pour bougies ou polir."},
        {mot:"Cigogne", def:"Grand oiseau migrateur aux longues pattes."},
        {mot:"Ciseaux", def:"Outil tranchant pour couper."},
        {mot:"Ciment", def:"Poudre liant des mat√©riaux de construction."},
        {mot:"Cit√©", def:"Zone urbaine avec b√¢timents et population."},
        {mot:"Citation", def:"Phrase ou extrait tir√© d'un texte."},
        {mot:"Circulation", def:"Mouvement des v√©hicules et pi√©tons."},
        {mot:"Citadelle", def:"Forteresse sur une hauteur."},
        {mot:"Cigarette", def:"Petit cylindre de tabac √† fumer."},
        {mot:"Cible", def:"Objet √† atteindre au tir ou lancer."},
        {mot:"Cin√©ma", def:"Art et projection des films."}
      ],
      "Jo": [
        {mot:"Jovial", def:"Enjou√©, gai, plein d'entrain."},
        {mot:"Joli", def:"Agr√©able √† regarder."},
        {mot:"Jouet", def:"Objet de divertissement."},
        {mot:"Journ√©e", def:"P√©riode de vingt-quatre heures."},
        {mot:"Joie", def:"√âtat de bonheur."},
        {mot:"Journal", def:"Document rapportant des informations."},
        {mot:"Joueur", def:"Personne qui participe √† un jeu ou sport."},
        {mot:"Jogging", def:"Course √† rythme lent."},
        {mot:"Joaillerie", def:"Art de fabriquer des bijoux."},
        {mot:"Jonquille", def:"Plante √† fleurs jaunes du printemps."},
        {mot:"Journaliste", def:"Personne qui recueille et publie des informations."}
      ],
      "In": [
        {mot:"Insecte", def:"Petit animal √† six pattes, souvent ail√©."},
        {mot:"Inconnu", def:"Qui n'est pas reconnu ou identifi√©."},
        {mot:"Innovant", def:"Qui apporte des id√©es ou m√©thodes nouvelles."},
        {mot:"Innovation", def:"Introduction de nouvelles id√©es ou produits."},
        {mot:"Injustice", def:"Absence d'√©quit√©."},
        {mot:"Information", def:"Faits ou connaissances sur un sujet."},
        {mot:"Inspection", def:"Action d'examiner attentivement."},
        {mot:"Int√©grit√©", def:"Respect de principes moraux."},
        {mot:"Inviter", def:"Demander √† quelqu'un de venir."},
        {mot:"Industrie", def:"Activit√©s de production de biens et services."},
        {mot:"Informatique", def:"Science du traitement automatique de l'information."},
        {mot:"Infirmerie", def:"Lieu de soins m√©dicaux l√©gers."},
        {mot:"Infini", def:"Qui n'a pas de limite."},
        {mot:"Invention", def:"Cr√©ation d'une chose nouvelle."},
        {mot:"Invitation", def:"Demande de participer √† quelque chose."},
        {mot:"In√©dit", def:"Jamais publi√© ou mont√©."},
        {mot:"Interlocuteur", def:"Personne avec qui l'on discute."},
        {mot:"Interdit", def:"Non autoris√©."},
        {mot:"Intervention", def:"Action d'intervenir pour aider."}
      ],
      "Ge": [
        {mot:"G√©ant", def:"Tr√®s grand ou imposant."},
        {mot:"G√©ographie", def:"√âtude de la Terre et de ses habitants."},
        {mot:"G√©rer", def:"S'occuper de, diriger une situation."},
        {mot:"G√©ologie", def:"√âtude des roches et de la structure de la Terre."},
        {mot:"Genre", def:"Cat√©gorie de choses similaires."},
        {mot:"G√©om√©trie", def:"Branche des math√©matiques des formes."},
        {mot:"G√©antisme", def:"Croissance corporelle excessive."},
        {mot:"G√©n√©rosit√©", def:"Qualit√© de donner sans attendre en retour."},
        {mot:"Gestion", def:"Action de diriger une organisation."},
        {mot:"G√©n√©tique", def:"√âtude des g√®nes et de l'h√©r√©dit√©."}
      ],
      "Fa": [
        {mot:"Famille", def:"Groupe de personnes li√©es par le sang ou l'adoption."},
        {mot:"Fabuleux", def:"Incroyablement merveilleux."},
        {mot:"Facteur", def:"Variable qui influence un r√©sultat."},
        {mot:"Fa√ßon", def:"Mani√®re dont quelque chose est fait."},
        {mot:"Face", def:"Partie ant√©rieure de la t√™te humaine."},
        {mot:"Fabrication", def:"Production de biens √† grande √©chelle."},
        {mot:"Facult√©", def:"Unit√© d'enseignement d'une universit√©."},
        {mot:"Fable", def:"Court r√©cit imaginaire avec une morale."},
        {mot:"Faim", def:"Sensation de besoin de nourriture."},
        {mot:"Faune", def:"Ensemble des animaux d'une r√©gion."}
      ],
      "Ce": [
        {mot:"C√©r√©ale", def:"Plante cultiv√©e pour ses graines comestibles."},
        {mot:"C√©r√©monie", def:"Rites solennels d'un √©v√©nement."},
        {mot:"C√©tac√©", def:"Animal marin √† nageoires, comme la baleine."},
        {mot:"C√©libataire", def:"Personne non mari√©e."},
        {mot:"Cercle", def:"Figure g√©om√©trique ferm√©e."},
        {mot:"C√©sar", def:"Titre des empereurs romains."},
        {mot:"C√©sium", def:"√âl√©ment chimique, symbole Cs, n¬∞55."},
        {mot:"C√©sure", def:"Pause dans le vers po√©tique."},
        {mot:"Cession", def:"Action de c√©der quelque chose."},
        {mot:"C√©notaphe", def:"Monument fun√©raire sans corps."},
        {mot:"Ceinture", def:"Bande autour de la taille pour maintenir un v√™tement."}
      ],
      "Cl": [
        {mot:"Classe", def:"Groupe partageant une fonction ou id√©ologie."},
        {mot:"Clavier", def:"Ensemble de touches d'un appareil."},
        {mot:"Climat", def:"Conditions atmosph√©riques d'une r√©gion."},
        {mot:"Clinique", def:"√âtablissement de soins m√©dicaux."},
        {mot:"Clonage", def:"Technique de reproduction de clones."},
        {mot:"Cloche", def:"Instrument produisant un son."},
        {mot:"Clou", def:"Petit objet pointu pour fixer."},
        {mot:"Club", def:"Association de personnes aux int√©r√™ts communs."},
        {mot:"Clown", def:"Personnage comique de cirque."},
        {mot:"Cl√¥ture", def:"Barri√®re d√©limitant une propri√©t√©."},
        {mot:"Cl√©mentine", def:"Fruit hybride entre mandarine et orange."}
      ],
      "Be": [
        {mot:"B√©b√©", def:"Enfant en tr√®s bas √¢ge."},
        {mot:"Beaut√©", def:"Qualit√© d'√™tre beau."},
        {mot:"B√©lier", def:"Signe astrologique; aussi l'animal."},
        {mot:"B√©guin", def:"Attirance amoureuse passag√®re."},
        {mot:"Berceau", def:"Lit pour b√©b√©."},
        {mot:"Besoin", def:"N√©cessit√© ou exigence."},
        {mot:"B√™te", def:"Animal; par extension, qui manque de jugement."},
        {mot:"Beurre", def:"Produit laitier de la cr√®me."},
        {mot:"B√©n√©fice", def:"Profit ou avantage tir√© d'une activit√©."},
        {mot:"B√©atitude", def:"Bonheur parfait et durable."}
      ],
      "Bl": [
        {mot:"Blague", def:"Histoire dr√¥le ou plaisanterie."},
        {mot:"Blanc", def:"Couleur somme de toutes les couleurs (lumi√®re)."},
        {mot:"Blazer", def:"Veste de costume sportive."},
        {mot:"Blessure", def:"L√©sion physique ou morale."},
        {mot:"Blocage", def:"Action de bloquer."},
        {mot:"Blog", def:"Site personnel de publications."},
        {mot:"Blondeur", def:"Qualit√© d'√™tre blond(e)."},
        {mot:"Blouse", def:"V√™tement de travail ample."},
        {mot:"Bluff", def:"Attitude pour impressionner sans moyens r√©els."},
        {mot:"Blancheur", def:"Qualit√© d'√™tre blanc."}
      ],
      "Bo": [
        {mot:"Bonbon", def:"Petite sucrerie."},
        {mot:"Bonheur", def:"√âtat de contentement."},
        {mot:"Bo√Æte", def:"R√©cipient rigide."},
        {mot:"Bouteille", def:"R√©cipient pour liquides."},
        {mot:"Boussole", def:"Instrument indiquant le nord magn√©tique."},
        {mot:"Bougie", def:"Objet en cire servant √† √©clairer."},
        {mot:"Boule", def:"Objet sph√©rique."},
        {mot:"Bouquet", def:"Ensemble de fleurs arrang√©es."},
        {mot:"Bouton", def:"Pi√®ce en relief pour fermer un v√™tement."},
        {mot:"Boxe", def:"Sport de combat aux poings."},
        {mot:"Bois", def:"Mat√©riau provenant des arbres."}
      ],
      "Bi": [
        {mot:"Biblioth√®que", def:"Lieu de conservation des livres."},
        {mot:"Bicyclette", def:"V√©hicule √† deux roues √† p√©dales."},
        {mot:"Biographie", def:"R√©cit de la vie d'une personne."},
        {mot:"Bijou", def:"Objet ornemental port√© sur le corps."},
        {mot:"Bilan", def:"√âtat des lieux ou compte rendu."},
        {mot:"Bilingue", def:"Qui parle deux langues."},
        {mot:"Biologie", def:"Science des √™tres vivants."},
        {mot:"Bisou", def:"Baiser amical ou affectueux."},
        {mot:"Biscuit", def:"Petit g√¢teau sec."},
        {mot:"Bistrot", def:"Petit restaurant ou caf√©."},
        {mot:"Bip√®de", def:"Animal qui marche sur deux pattes."}
      ],
      "Cr": [
        {mot:"Crayon", def:"Instrument d'√©criture ou de dessin."},
        {mot:"Cr√®me", def:"Substance onctueuse pour hydrater la peau."},
        {mot:"Croissant", def:"P√¢tisserie en forme de croissant."},
        {mot:"Cravate", def:"Accessoire vestimentaire pour le cou."},
        {mot:"Cr√©ativit√©", def:"Capacit√© √† imaginer et inventer."},
        {mot:"Cr√©dit", def:"Somme d'argent emprunt√©e."},
        {mot:"Crise", def:"P√©riode difficile ou de changement."},
        {mot:"Crier", def:"√âmettre un son fort."},
        {mot:"Cristal", def:"Mat√©riau transparent et brillant."},
        {mot:"Crocodile", def:"Grand reptile semi-aquatique."}
      ],

  "Cu": [
    {mot:"Cube", def:"Solide √† six faces carr√©es √©gales."},
    {mot:"Cuill√®re", def:"Ustensile pour manger/mesurer."},
    {mot:"Culture", def:"Pratiques et valeurs d'une soci√©t√©."},
    {mot:"Cuisson", def:"Action de cuire des aliments."},
    {mot:"Cuir", def:"Peau d'animal tann√©e."},
    {mot:"Cuisine", def:"Pi√®ce o√π l'on pr√©pare les repas."},
    {mot:"Cuisse", def:"Partie du corps entre hanche et genou."},
    {mot:"Cuivre", def:"M√©tal rouge√¢tre conducteur."},
    {mot:"Curiosit√©", def:"D√©sir d'apprendre ou de d√©couvrir."},
    {mot:"Curseur", def:"Contr√¥le graphique pour d√©placer un pointeur."},
    {mot:"Cuvette", def:"R√©cipient pour se laver."},
    {mot:"Cuv√©e", def:"Quantit√© de vin d'une m√™me r√©colte."}
  ],

  "Cy": [
    {mot:"Cycle", def:"Suite d'√©v√©nements se r√©p√©tant r√©guli√®rement."},
    {mot:"Cyclone", def:"Perturbation avec vents violents."},
    {mot:"Cylindre", def:"Solide √† base circulaire et surface courbe."},
    {mot:"Cynisme", def:"Attitude m√©prisante envers les valeurs morales."},
    {mot:"Cynique", def:"Qui manifeste du cynisme."},
    {mot:"Cygne", def:"Grand oiseau aquatique au long cou."},
    {mot:"Cypr√®s", def:"Arbre √† feuillage persistant."},
    {mot:"Cystite", def:"Inflammation de la vessie."},
    {mot:"Cybern√©tique", def:"Science des syst√®mes de contr√¥le/communication."},
    {mot:"Cyberespace", def:"Espace virtuel des r√©seaux informatiques."},
    {mot:"Cyclisme", def:"Sport consistant √† faire du v√©lo."},
    {mot:"Cycliste", def:"Personne pratiquant le cyclisme."},
    {mot:"Cyprinid√©", def:"Famille de poissons d'eau douce."},
    {mot:"Cytologie", def:"√âtude des cellules."},
    {mot:"Cytom√©trie", def:"Mesure des caract√©ristiques cellulaires."}
  ],

  "Bu": [
    {mot:"Budget", def:"Pr√©vision des recettes et d√©penses."},
    {mot:"Buffle", def:"Grand bovid√©s domestiques ou sauvages."},
    {mot:"Bureau", def:"Pi√®ce ou meuble pour travailler."},
    {mot:"Bus", def:"Transport en commun routier."},
    {mot:"Buse", def:"Rapace diurne."},
    {mot:"But", def:"Objectif √† atteindre."},
    {mot:"Butoir", def:"Dispositif qui arr√™te un mouvement."},
    {mot:"Bouton", def:"Petite protub√©rance; organe de commande."},
    {mot:"B√ªche", def:"Morceau de bois pour le feu."},
    {mot:"Buisson", def:"Groupe d'arbustes."},
    {mot:"Buvette", def:"Petit lieu de restauration/boissons."},
    {mot:"Buvard", def:"Papier absorbant pour encre."},
    {mot:"Bungalow", def:"Petite maison de plain-pied."},
    {mot:"Buanderie", def:"Pi√®ce destin√©e √† la lessive."}
  ],

  "Do": [
    {mot:"Domaine", def:"Ensemble de connaissances; champ d'activit√©."},
    {mot:"Docteur", def:"Titulaire du plus haut grade universitaire; m√©decin."},
    {mot:"Document", def:"Support d'information √©crit/visuel."},
    {mot:"Doctrine", def:"Ensemble de principes d'un syst√®me de pens√©e."},
    {mot:"Domicile", def:"Lieu de r√©sidence."},
    {mot:"Dose", def:"Quantit√© mesur√©e d'une substance."},
    {mot:"Dossier", def:"Ensemble de documents relatifs √† un sujet."},
    {mot:"Douane", def:"Service contr√¥lant marchandises aux fronti√®res."},
    {mot:"Doublage", def:"Substitution des voix dans un film."},
    {mot:"Douleur", def:"Sensation physique d√©sagr√©able."},
    {mot:"Doute", def:"Incertitude, h√©sitation."},
    {mot:"Doux", def:"Agr√©able au toucher/go√ªt; aimable."},
    {mot:"Donn√©es", def:"Informations structur√©es en informatique."},
    {mot:"Douloureux", def:"Qui cause de la douleur."}
  ],

  "Fl": [
    {mot:"Fleur", def:"Organe reproducteur des plantes √† fleurs."},
    {mot:"Flamme", def:"Partie lumineuse d'un feu."},
    {mot:"Flegme", def:"Calme, impassibilit√©."},
    {mot:"Flocon", def:"Cristal de neige."},
    {mot:"Fleurir", def:"Produire des fleurs."},
    {mot:"Fleurissement", def:"Action d'orner de fleurs."},
    {mot:"Fluide", def:"Qui s'√©coule facilement; liquide/gaz."},
    {mot:"Fluctuer", def:"Varier, √™tre instable."},
    {mot:"Flotte", def:"Ensemble de navires."},
    {mot:"Fluctuation", def:"Variation plus ou moins r√©guli√®re."},
    {mot:"Flegmatique", def:"D'un calme imperturbable."},
    {mot:"Flore", def:"Ensemble des v√©g√©taux d'une r√©gion."},
    {mot:"Fl√©au", def:"Grande calamit√©; instrument ancien de battage."},
    {mot:"Flop", def:"√âchec retentissant."},
    {mot:"Fl√©trir", def:"Se dess√©cher et faner; d√©shonorer (fig.)."}
  ],

  "J": [
    {mot:"Joker", def:"Carte sp√©ciale rempla√ßant une autre carte."},
    {mot:"Jubilation", def:"Grande joie, all√©gresse."},
    {mot:"Juxtaposition", def:"Disposition c√¥te √† c√¥te sans m√©lange."},
    {mot:"Juteux", def:"Plein de jus; tr√®s rentable."},
    {mot:"Jingle", def:"Courte m√©lodie publicitaire."},
    {mot:"Juxtaposer", def:"Mettre c√¥te √† c√¥te pour comparer."},
    {mot:"Jovial", def:"Gai, enjou√©."},
    {mot:"Jodhpurs", def:"Pantalon d'√©quitation √©vas√© aux cuisses."},
    {mot:"Jardinage", def:"Entretien et culture d'un jardin."},
    {mot:"Jument", def:"Femelle du cheval."},
    {mot:"Jumelage", def:"Coop√©ration entre deux villes/r√©gions."},
    {mot:"Jouissance", def:"Plaisir intense; b√©n√©fice juridique."},
    {mot:"Jungle", def:"For√™t dense tropicale."}
  ],

  "Ic": [
    {mot:"Ic√¥ne", def:"Image symbolique d'une personne/chose."},
    {mot:"Iceberg", def:"Masse de glace flottante."},
    {mot:"Ic√¥ne pop", def:"Figure majeure de la culture populaire."},
    {mot:"Icarien", def:"Relatif au mythe d'Icare."},
    {mot:"Ic√¥ne religieuse", def:"Image sacr√©e d'un saint ou d'une divinit√©."},
    {mot:"Brise-glace", def:"Navire ¬´ icebreaker ¬ª ouvrant les voies dans la glace."},
    {mot:"Cr√®me glac√©e", def:"Dessert froid √† base de lait/sucre (ice cream)."},
    {mot:"Postictal", def:"P√©riode suivant une crise d'√©pilepsie."},
    {mot:"Ic√¥ne de mode", def:"Personnalit√© influente en mode."},
    {mot:"Ic√¥ne num√©rique", def:"Symbole d'application/fonction sur √©cran."},
    {mot:"Th√© glac√©", def:"Boisson froide √† base de th√© (ice tea)."},
    {mot:"Ic√¥ne culturelle", def:"Symbole repr√©sentatif d'une culture."},
    {mot:"Hockey sur glace", def:"Sport collectif sur patinoire (ice hockey)."},
    {mot:"Ic√¥ne de cin√©ma", def:"Acteur/actrice aux r√¥les embl√©matiques."},
    {mot:"Iconographie", def:"√âtude/ensemble des repr√©sentations visuelles."},
    {mot:"Ichtyologie", def:"Branche de la zoologie sur les poissons."}
  ],

  "Ig": [
    {mot:"Ignorer", def:"Ne pas tenir compte de."},
    {mot:"Igloo", def:"Abri de neige en d√¥me."},
    {mot:"Ignoble", def:"Tr√®s m√©prisable, indigne."},
    {mot:"Igname", def:"Tubercule comestible tropical."},
    {mot:"Ignifuge", def:"Qui r√©siste au feu."},
    {mot:"Ing√©nieur", def:"Sp√©cialiste en ing√©nierie (corrige ¬´ Ig√©nieur ¬ª)."},
    {mot:"Ignition", def:"Mise √† feu d'un moteur/carburant."},
    {mot:"Ing√©niosit√©", def:"Aptitude √† inventer, astuce (corrige ¬´ Ig√©niosit√© ¬ª)."},
    {mot:"Ign√©", def:"Relatif au feu (roche ign√©e)."},
    {mot:"Ignifuger", def:"Rendre r√©sistant au feu."},
    {mot:"Igname sauvage", def:"Esp√®ce d'igname non cultiv√©e."},
    {mot:"Ignominie", def:"Honte publique, infamie."},
    {mot:"Ing√©nierie", def:"Discipline de conception technique (corrige ¬´ Ig√©nierie ¬ª)."}
  ],

  "Ne": [
    {mot:"Nectar", def:"Liquide sucr√© produit par les fleurs."},
    {mot:"N√©buleuse", def:"Nuage interstellaire de gaz et poussi√®res."},
    {mot:"N√©ologisme", def:"Mot ou expression nouvellement cr√©√©."},
    {mot:"N√©nuphar", def:"Plante aquatique √† larges feuilles flottantes."},
    {mot:"N√©crologie", def:"Rubrique listant les personnes d√©c√©d√©es."},
    {mot:"Nectarine", def:"Fruit proche de la p√™che, √† peau lisse."},
    {mot:"N√©ophyte", def:"Personne d√©butante dans un domaine."},
    {mot:"Nettoyer", def:"√îter la salet√©, purifier."},
    {mot:"N√©og√®ne", def:"P√©riode g√©ologique du C√©nozo√Øque."},
    {mot:"N√©erlandais", def:"Relatif aux Pays-Bas ou √† la langue."},
    {mot:"N√©onatal", def:"Relatif au nouveau-n√©."},
    {mot:"N√©ant", def:"Rien; absence d'existence."},
    {mot:"Nerveux", def:"Relatif aux nerfs; agit√©."},
    {mot:"N√©ophyte en informatique", def:"D√©butant en technologies num√©riques."},
    {mot:"N√©potisme", def:"Faveur accord√©e aux proches."},
    {mot:"N√©ologisme linguistique", def:"Mot nouveau introduit dans une langue."}
  ]
};

    // --- √âl√©ments DOM ---
    const prefixDisplay = document.getElementById("prefixDisplay");
    const definitionDisplay = document.getElementById("definitionDisplay");
    const answerInput = document.getElementById("answer");
    const message = document.getElementById("message");
    const btnPlay = document.getElementById("btnPlay");
    const btnSlow = document.getElementById("btnSlow");
    const btnFast = document.getElementById("btnFast");
    const btnRepeat = document.getElementById("btnRepeat");
    const btnSkip = document.getElementById("btnSkip");
    const btnBack = document.getElementById("btnBack");
    const initialBank = document.getElementById("initialBank");
    const progressPill = document.getElementById("progressPill");
    const speedPill = document.getElementById("speedPill");
    const hintPrefix = document.getElementById("hintPrefix");

    // --- √âl√©ments multijoueur ---
    const multiplayerPanel = document.getElementById("multiplayerPanel");
    const sessionCodeDisplay = document.getElementById("sessionCodeDisplay");
    const timerDisplay = document.getElementById("timerDisplay");
    const playerList = document.getElementById("playerList");
    const btnCopyCode = document.getElementById("btnCopyCode");
    const btnLeaveGame = document.getElementById("btnLeaveGame");
    const multiplayerModal = document.getElementById("multiplayerModal");
    const btnCreateGame = document.getElementById("btnCreateGame");
    const btnJoinGame = document.getElementById("btnJoinGame");
    const joinForm = document.getElementById("joinForm");
    const joinCode = document.getElementById("joinCode");
    const playerName = document.getElementById("playerName");
    const btnConfirmJoin = document.getElementById("btnConfirmJoin");
    const btnCloseModal = document.getElementById("btnCloseModal");

    // --- √âtat du jeu ---
    let currentPrefix = null;
    let currentIndex = 0;
    let speechRate = 1;
    
    // --- √âtat multijoueur ---
    let isMultiplayer = false;
    let sessionCode = null;
    let players = [];
    let timer = 15;
    let timerInterval = null;
    let currentQuestion = null;
    let playerId = null;
    let playerScores = {};

    // --- Simulation de serveur (√† remplacer par un vrai backend) ---
    const mockServer = {
      games: {},
      
      createGame() {
        const code = this.generateCode();
        this.games[code] = {
          players: [],
          currentQuestion: null,
          questionIndex: 0,
          isActive: false,
          scores: {}
        };
        return code;
      },
      
      joinGame(code, playerName) {
        if (!this.games[code]) return false;
        
        const playerId = Math.random().toString(36).substring(2, 9);
        this.games[code].players.push({
          id: playerId,
          name: playerName,
          score: 0
        });
        
        return playerId;
      },
      
      startGame(code) {
        if (!this.games[code]) return false;
        this.games[code].isActive = true;
        
        // S√©lectionner une question al√©atoire
        const prefixes = Object.keys(FIELDS);
        const randomPrefix = prefixes[Math.floor(Math.random() * prefixes.length)];
        const questions = FIELDS[randomPrefix];
        const randomQuestion = questions[Math.floor(Math.random() * questions.length)];
        
        this.games[code].currentQuestion = {
          prefix: randomPrefix,
          definition: randomQuestion.def,
          answer: randomQuestion.mot
        };
        
        return this.games[code].currentQuestion;
      },
      
      submitAnswer(code, playerId, answer) {
        if (!this.games[code] || !this.games[code].currentQuestion) return false;
        
        const game = this.games[code];
        const isCorrect = this.normalize(answer) === this.normalize(game.currentQuestion.answer);
        
        if (isCorrect) {
          if (!game.scores[playerId]) game.scores[playerId] = 0;
          game.scores[playerId] += 10;
          
          // Mettre √† jour le score du joueur dans la liste des joueurs
          const player = game.players.find(p => p.id === playerId);
          if (player) player.score = game.scores[playerId];
        }
        
        return isCorrect;
      },
      
      nextQuestion(code) {
        if (!this.games[code]) return false;
        
        // S√©lectionner une nouvelle question al√©atoire
        const prefixes = Object.keys(FIELDS);
        const randomPrefix = prefixes[Math.floor(Math.random() * prefixes.length)];
        const questions = FIELDS[randomPrefix];
        const randomQuestion = questions[Math.floor(Math.random() * questions.length)];
        
        this.games[code].currentQuestion = {
          prefix: randomPrefix,
          definition: randomQuestion.def,
          answer: randomQuestion.mot
        };
        
        return this.games[code].currentQuestion;
      },
      
      getGameState(code) {
        return this.games[code];
      },
      
      generateCode() {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        let result = '';
        for (let i = 0; i < 4; i++) {
          result += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return result;
      },
      
      normalize(s) {
        return s
          .toLowerCase()
          .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
          .replace(/[^a-z\-' ]/g,'')
          .trim();
      }
    };

    // --- Utilitaires ---
    const normalize = s => s
      .toLowerCase()
      .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
      .replace(/[^a-z\-' ]/g,'')
      .trim();

    function updatePills(){
      const total = currentPrefix ? FIELDS[currentPrefix].length : 0;
      progressPill.textContent = total ? `${currentIndex+1} / ${total}` : `0 / 0`;
      speedPill.textContent = `Vitesse √ó${speechRate.toFixed(2)}`;
      hintPrefix.textContent = currentPrefix || "‚Äì ‚Äì";
    }

    function ttsCancel(){ if ('speechSynthesis' in window) speechSynthesis.cancel(); }
    function speak(text, rate=speechRate){
      if(!('speechSynthesis' in window)) { return; }
      ttsCancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'fr-FR';
      u.rate = rate;
      speechSynthesis.speak(u);
    }

    function announce(){
      if(!currentPrefix) return;
      const item = FIELDS[currentPrefix][currentIndex];
      const intro = `Toutes les bonnes r√©ponses commencent par les lettres : ${currentPrefix}.`;
      const def  = item.def;
      speak(`${intro} D√©finition : ${def}`);
    }

    function renderCard(){
      if(!currentPrefix){
        prefixDisplay.textContent = "‚Äì ‚Äì";
        definitionDisplay.textContent = "Choisis un champ lexical ci-dessous pour commencer, ou appuie sur ‚ñ∂Ô∏è Jouer pour d√©marrer au premier.";
        updatePills();
        return;
      }
      const item = FIELDS[currentPrefix][currentIndex];
      prefixDisplay.textContent = currentPrefix;
      definitionDisplay.textContent = item.def;
      message.textContent = "√âcris le mot correspondant. (Il doit commencer par " + currentPrefix + ")";
      message.style.color = "#fff";
      answerInput.value = "";
      answerInput.placeholder = `Un mot qui commence par ¬´ ${currentPrefix} ¬ª‚Ä¶`;
      answerInput.disabled = false;
      updatePills();
    }

    function setPrefix(prefix){
      if(!FIELDS[prefix]) return;
      currentPrefix = prefix;
      currentIndex = 0;
      highlightBank(prefix);
      renderCard();
      announce();
      answerInput.focus();
    }

    function next(){
      if(!currentPrefix) return;
      currentIndex++;
      const list = FIELDS[currentPrefix];
      if(currentIndex >= list.length){
        // Fin du champ courant -> message de bravo
        currentIndex = list.length-1;
        message.textContent = `üéâ Bravo ! Tu as termin√© le champ lexical ${currentPrefix}. Choisis une autre initiale ci-dessous.`;
        message.style.color = "#00e676";
        answerInput.disabled = true;
        ttsCancel();
        speak(`Bravo ! Tu as termin√© le champ lexical ${currentPrefix}.`);
        return;
      }
      renderCard();
      announce();
      answerInput.focus();
    }

    function back(){
      if(!currentPrefix) return;
      if(currentIndex > 0){
        currentIndex--;
        renderCard();
        announce();
        answerInput.focus();
      }
    }

    function repeat(){ announce(); }

    function slower(){
      speechRate = Math.max(0.5, speechRate - 0.25);
      updatePills();
      announce();
    }
    function faster(){
      speechRate = Math.min(2, speechRate + 0.25);
      updatePills();
      announce();
    }

    function check(){
      if(!currentPrefix) return;
      const item = FIELDS[currentPrefix][currentIndex];
      const user = normalize(answerInput.value);
      const target = normalize(item.mot);

      // Doit commencer par le pr√©fixe ET correspondre √† la d√©finition vis√©e
      if(user && user.startsWith(normalize(currentPrefix)) && user === target){
        message.textContent = "‚úÖ Correct ! Bien jou√©.";
        message.style.color = "#00e676";
        speak("Correct ! Bien jou√©.");
        setTimeout(next, 900);
      }else{
        message.textContent = `‚ùå Incorrect. Il fallait penser √† : ${item.mot}.`;
        message.style.color = "#ff5252";
        speak(`Incorrect. Il fallait penser √† : ${item.mot}.`);
      }
    }

    // --- Banque d'initiales cliquables ---
    function buildBank(){
      const keys = Object.keys(FIELDS);
      keys.sort((a,b)=>a.localeCompare(b,'fr'));
      initialBank.innerHTML = "";
      for(const k of keys){
        const btn = document.createElement("button");
        btn.textContent = k.toUpperCase();
        btn.setAttribute("aria-label", `Choisir le champ lexical ${k}`);
        btn.addEventListener("click", ()=> setPrefix(k));
        initialBank.appendChild(btn);
      }
    }
    function highlightBank(k){
      [...initialBank.children].forEach(b=>{
        b.classList.toggle('active', b.textContent === k.toUpperCase());
      });
    }

    // --- Fonctions multijoueur ---
    function showMultiplayerModal() {
      multiplayerModal.style.display = "flex";
    }
    
    function hideMultiplayerModal() {
      multiplayerModal.style.display = "none";
    }
    
    function createGame() {
      sessionCode = mockServer.createGame();
      playerName.value = "Joueur " + Math.floor(Math.random() * 1000);
      playerId = mockServer.joinGame(sessionCode, playerName.value);
      
      if (playerId) {
        sessionCodeDisplay.textContent = sessionCode;
        multiplayerPanel.style.display = "block";
        isMultiplayer = true;
        hideMultiplayerModal();
        updatePlayerList();
        
        // D√©marrer la partie apr√®s 3 secondes
        setTimeout(startMultiplayerGame, 3000);
      }
    }
    
    function joinGame() {
      const code = joinCode.value.toUpperCase();
      const name = playerName.value || "Joueur " + Math.floor(Math.random() * 1000);
      
      if (code.length !== 4) {
        alert("Le code doit contenir 4 lettres");
        return;
      }
      
      playerId = mockServer.joinGame(code, name);
      
      if (playerId) {
        sessionCode = code;
        sessionCodeDisplay.textContent = sessionCode;
        multiplayerPanel.style.display = "block";
        isMultiplayer = true;
        hideMultiplayerModal();
        updatePlayerList();
        
        // Synchroniser avec la partie existante
        syncWithGame();
      } else {
        alert("Code de partie invalide ou partie introuvable");
      }
    }
    
    function startMultiplayerGame() {
      currentQuestion = mockServer.startGame(sessionCode);
      if (currentQuestion) {
        displayMultiplayerQuestion();
        startTimer();
      }
    }
    
    function displayMultiplayerQuestion() {
      if (!currentQuestion) return;
      
      prefixDisplay.textContent = currentQuestion.prefix;
      definitionDisplay.textContent = currentQuestion.definition;
      message.textContent = "Trouve le mot qui correspond √† cette d√©finition (commence par " + currentQuestion.prefix + ")";
      message.style.color = "#fff";
      answerInput.value = "";
      answerInput.placeholder = `Un mot qui commence par ¬´ ${currentQuestion.prefix} ¬ª‚Ä¶`;
      answerInput.disabled = false;
      
      // Mettre √† jour les indices
      hintPrefix.textContent = currentQuestion.prefix;
      progressPill.textContent = "Multijoueur";
      speedPill.textContent = "En ligne";
      
      // Annoncer la question
      const intro = `Toutes les bonnes r√©ponses commencent par les lettres : ${currentQuestion.prefix}.`;
      speak(`${intro} D√©finition : ${currentQuestion.definition}`);
    }
    
    function startTimer() {
      timer = 15;
      timerDisplay.textContent = timer + "s";
      
      if (timerInterval) clearInterval(timerInterval);
      
      timerInterval = setInterval(() => {
        timer--;
        timerDisplay.textContent = timer + "s";
        
        if (timer <= 0) {
          clearInterval(timerInterval);
          nextMultiplayerQuestion();
        }
      }, 1000);
    }
    
    function checkMultiplayer() {
      if (!currentQuestion || !isMultiplayer) return;
      
      const isCorrect = mockServer.submitAnswer(sessionCode, playerId, answerInput.value);
      
      if (isCorrect) {
        message.textContent = "‚úÖ Correct ! +10 points";
        message.style.color = "#00e676";
        speak("Correct ! Bien jou√©.");
        updatePlayerList();
        
        // Passer √† la question suivante apr√®s un d√©lai
        setTimeout(nextMultiplayerQuestion, 2000);
      } else {
        message.textContent = "‚ùå Incorrect. Essaie encore !";
        message.style.color = "#ff5252";
      }
    }
    
    function nextMultiplayerQuestion() {
      currentQuestion = mockServer.nextQuestion(sessionCode);
      if (currentQuestion) {
        displayMultiplayerQuestion();
        startTimer();
      }
    }
    
    function updatePlayerList() {
      const gameState = mockServer.getGameState(sessionCode);
      if (!gameState) return;
      
      playerList.innerHTML = "";
      
      // Trier les joueurs par score (d√©croissant)
      const sortedPlayers = [...gameState.players].sort((a, b) => b.score - a.score);
      
      sortedPlayers.forEach(player => {
        const playerEl = document.createElement("div");
        playerEl.className = "player";
        
        const scoreEl = document.createElement("div");
        scoreEl.className = "player-score";
        scoreEl.textContent = player.score;
        
        const nameEl = document.createElement("span");
        nameEl.textContent = player.name;
        
        playerEl.appendChild(scoreEl);
        playerEl.appendChild(nameEl);
        
        // Mettre en √©vidence le joueur actuel
        if (player.id === playerId) {
          playerEl.style.background = "rgba(37, 117, 252, 0.3)";
        }
        
        playerList.appendChild(playerEl);
      });
    }
    
    function syncWithGame() {
      const gameState = mockServer.getGameState(sessionCode);
      if (!gameState) return;
      
      players = gameState.players;
      currentQuestion = gameState.currentQuestion;
      playerScores = gameState.scores;
      
      if (gameState.isActive && currentQuestion) {
        displayMultiplayerQuestion();
        startTimer();
      }
      
      updatePlayerList();
    }
    
    function leaveGame() {
      isMultiplayer = false;
      multiplayerPanel.style.display = "none";
      
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      
      // Revenir au mode solo
      currentPrefix = null;
      currentIndex = 0;
      renderCard();
    }

    // --- √âcouteurs ---
    btnPlay.addEventListener("click", ()=>{
      if (isMultiplayer) {
        // En mode multijoueur, le bouton Jouer sert √† r√©p√©ter la question
        if (currentQuestion) {
          const intro = `Toutes les bonnes r√©ponses commencent par les lettres : ${currentQuestion.prefix}.`;
          speak(`${intro} D√©finition : ${currentQuestion.definition}`);
        }
      } else {
        // Mode solo
        if(!currentPrefix){
          // D√©marrage: premier champ par ordre alphab√©tique
          const first = Object.keys(FIELDS).sort((a,b)=>a.localeCompare(b,'fr'))[0];
          setPrefix(first);
        }else{
          announce();
        }
      }
    });
    
    btnSlow.addEventListener("click", slower);
    btnFast.addEventListener("click", faster);
    btnRepeat.addEventListener("click", repeat);
    btnSkip.addEventListener("click", ()=>{
      if (isMultiplayer) {
        nextMultiplayerQuestion();
      } else {
        next();
      }
    });
    btnBack.addEventListener("click", back);

    answerInput.addEventListener("keydown", (e)=>{
      if(e.key === "Enter") {
        if (isMultiplayer) {
          checkMultiplayer();
        } else {
          check();
        }
      }
    });

    // √âcouteurs multijoueur
    btnCreateGame.addEventListener("click", createGame);
    btnJoinGame.addEventListener("click", () => {
      joinForm.style.display = "block";
    });
    btnConfirmJoin.addEventListener("click", joinGame);
    btnCloseModal.addEventListener("click", hideMultiplayerModal);
    btnCopyCode.addEventListener("click", () => {
      navigator.clipboard.writeText(sessionCode);
      alert("Code copi√© dans le presse-papier !");
    });
    btnLeaveGame.addEventListener("click", leaveGame);

    // Ajouter un bouton pour acc√©der au mode multijoueur
    const multiplayerButton = document.createElement("button");
    multiplayerButton.textContent = "üéÆ Multijoueur";
    multiplayerButton.style.marginTop = "10px";
    multiplayerButton.style.width = "100%";
    multiplayerButton.addEventListener("click", showMultiplayerModal);
    document.querySelector(".controls").parentNode.insertBefore(multiplayerButton, document.querySelector(".controls"));

    // --- D√©marrage ---
    window.addEventListener("load", ()=>{
      buildBank();
      renderCard();
      // Message d'accessibilit√© si pas de TTS
      if(!('speechSynthesis' in window)){
        message.innerHTML = "‚ÑπÔ∏è La synth√®se vocale n'est pas disponible sur ce navigateur.";
      }
    });
  </script>
</body>
</html>