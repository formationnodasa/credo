<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Étagère du Génie de l’Épellation</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <canvas id="shelfCanvas"></canvas>
  <div id="cardViewer" class="hidden">
    <button id="closeCard">✖</button>
    <h2 id="cardTitle"></h2>
    <p id="cardContent"></p>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r148/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.148.0/examples/js/loaders/GLTFLoader.js"></script>
  <script src="main.js"></script>
</body>
</html>

body, html {
  margin: 0;
  overflow: hidden;
  font-family: 'Arial', sans-serif;
  background-color: #f0f8ff;
}

canvas {
  width: 100%;
  height: 100vh;
  display: block;
}

#cardViewer {
  position: absolute;
  top: 10%;
  left: 20%;
  width: 60%;
  background: white;
  border: 2px solid #007acc;
  padding: 20px;
  border-radius: 10px;
  z-index: 10;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
}

#cardViewer.hidden {
  display: none;
}

#closeCard {
  float: right;
  background: none;
  border: none;
  font-size: 1.5em;
  cursor: pointer;
}


import * as THREE from 'three';
import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';

let scene, camera, renderer, shelf;
let raycaster = new THREE.Raycaster();
let mouse = new THREE.Vector2();
const cardViewer = document.getElementById('cardViewer');
const cardTitle = document.getElementById('cardTitle');
const cardContent = document.getElementById('cardContent');
document.getElementById('closeCard').onclick = () => cardViewer.classList.add('hidden');

init();
animate();

function init() {
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0xf0f8ff);

  camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
  camera.position.set(0, 1.5, 5);

  renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('shelfCanvas'), antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // Lumière
  const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
  scene.add(ambientLight);

  const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
  directionalLight.position.set(5, 10, 7.5);
  scene.add(directionalLight);

  // Charger l'étagère 3D
  const loader = new GLTFLoader();
  loader.load('shelf.glb', function (gltf) {
    shelf = gltf.scene;
    scene.add(shelf);

    // Ajouter les zones cliquables pour les 6 mois
    for (let i = 0; i < 6; i++) {
      const box = new THREE.Mesh(
        new THREE.BoxGeometry(0.8, 0.4, 0.2),
        new THREE.MeshBasicMaterial({ color: 0x007acc, transparent: true, opacity: 0.3 })
      );
      box.position.set(-1.2 + i * 0.5, 1.4 - (i * 0.4), 0.3);
      box.name = `month${i + 1}`;
      scene.add(box);
    }
  });

  window.addEventListener('resize', onWindowResize, false);
  window.addEventListener('click', onClick, false);
}

function onWindowResize() {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}

function animate() {
  requestAnimationFrame(animate);
  renderer.render(scene, camera);
}

function onClick(event) {
  mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
  mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

  raycaster.setFromCamera(mouse, camera);
  const intersects = raycaster.intersectObjects(scene.children, true);

  if (intersects.length > 0) {
    const clicked = intersects[0].object;
    if (clicked.name.startsWith('month')) {
      const month = clicked.name;
      fetch(`assets/cards/${month}.json`)
        .then(response => response.json())
        .then(data => {
          cardTitle.textContent = data.title;
          cardContent.textContent = data.content;
          cardViewer.classList.remove('hidden');
        });
    }
  }
}
